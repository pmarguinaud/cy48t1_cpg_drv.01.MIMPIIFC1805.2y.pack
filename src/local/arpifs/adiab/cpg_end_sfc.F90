SUBROUTINE CPG_END_SFC (YDMODEL, YDCPG_OPTS, YDMF_PHYS_SURF)


USE TYPE_MODEL         , ONLY : MODEL
USE CPG_OPTS_TYPE_MOD, ONLY : CPG_OPTS_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD, ONLY : MF_PHYS_SURF_TYPE


IMPLICIT NONE

TYPE(MODEL)            ,INTENT(INOUT) :: YDMODEL
TYPE(CPG_OPTS_TYPE),    INTENT(IN)    :: YDCPG_OPTS
TYPE(MF_PHYS_SURF_TYPE),INTENT(INOUT) :: YDMF_PHYS_SURF

! NO TIME-STEPPING FOR SURFACE FIELDS IF ADIABATIC CALL OR NHS ITERATION.
IF (YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER == 0) THEN
  IF ((.NOT.YDCPG_OPTS%LCONFX).AND.YDCPG_OPTS%LDIAB) THEN  
    IF (YDCPG_OPTS%LTWOTL) THEN
      CALL YDMF_PHYS_SURF%SET0TO1 ()
    ELSE
      CALL YDMF_PHYS_SURF%PHTFILT (YDMODEL%YRML_DYN%YRDYN)
    ENDIF
  ENDIF
ENDIF

END SUBROUTINE
