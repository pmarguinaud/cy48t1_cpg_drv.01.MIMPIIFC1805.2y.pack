SUBROUTINE CPUTQY_AROME_EXPL(YDMF_PHYS_NEXT_STATE, YDVARS, YDMODEL, YDDIMV, YDCPG_BNDS, YDCPG_OPTS, &
& PDT, PTENDQ, PTENDL, PTENDR, PTENDI, PTENDS, PTENDG, PTENDH, PTENDTKE, PTENDT, PTENDU, PTENDV,    &
& PTENDD)
 !  Variables 2D In/Out

!     --------------------------------------------
!**** *CPUTQY_AROME_EXPL*  EVOLUTION DE T,  et des  QI et de la TKE
!     --------------------------------------------

!     ARGUMENTS D'ENTREE
!     ------------------
!       KPROMA : DIMENSION HORIZONTALE
!       KSTART : DEBUT DE LA BOUCLE HORIZONTALE
!       KPROF : BORNE HORIZONTALE DES CALCULS
!       KFLEV : DIMENSION ET BORNE VERTICALE
!       KFLDN, KFLDX : SECONDE DIMENSION de PEXT1 (/= selon SL ou pas)
!       PDT : PAS DE TEMPS EFFECTIF

!       PTTS (KPROMA,KFLEV) : TENDANCE DE TEMPERATURE 
!       PRS ( KPROMA,KFLEV,NRR ) : TENDANCE DES Qi

!     ARGUMENTS IMPLICITES
!     --------------------

!     SORTIES
!     -------
!       PTT1(NPROMA,KFLEV): VARIABLES A FAIRE EVOLUER
!       PNEBH (NVCLIN_AROME): tableau contenant les Qi a faire evoluer
!       PQV1 : Qv au temps 1
!       PQL1 : Ql au temps 1
!       PQI1 : Qi au temps 1

!     Modifications
!     -------------
!   03/03/03 Creation par Y. Seity et S. Malardel
!   04/07/27 Modif par G. Hello (to run Hydrostatic case)
!   05/09/28 Modif par Y. Seity (Add PTENDEXT)
!   25-Jan-08 K. Yessad: bug correction for EXT.
!   N. Wedi and K. Yessad (Jan 2008): different dev for NH model and PC scheme
!      07/12/18 Modif par Y. Seity (Add Hail PQH1)
!   26-Apr-2010 Modif par Y.Bouteloup (Only one call to cputqy_arome in mf_phys)
!   29-Apr-2019 R. El Khatib Use PTENDGFLR + pointer adresses KPTR to avoid a big array copy
!   18-Feb-2020 Y. Seity bf for non advected prognostic GFL (IF ordering)
! ----------------------------------------------------------------------------

USE YOMDIMV   , ONLY : TDIMV
USE YOMGMV    , ONLY : TGMV
USE PARKIND1  , ONLY : JPIM, JPRB
USE YOMHOOK   , ONLY : LHOOK, DR_HOOK
USE YOMCT0    , ONLY : LNHDYN, LSLAG
USE TYPE_MODEL, ONLY : MODEL
USE CPG_OPTS_TYPE_MOD &
              , ONLY : CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MF_PHYS_NEXT_STATE_TYPE_MOD &
              , ONLY : MF_PHYS_NEXT_STATE_TYPE
USE FIELD_VARIABLES_MOD, ONLY : FIELD_VARIABLES

IMPLICIT NONE

TYPE (MF_PHYS_NEXT_STATE_TYPE) ,INTENT(INOUT) :: YDMF_PHYS_NEXT_STATE
TYPE(FIELD_VARIABLES)          ,INTENT(IN)    :: YDVARS
TYPE(MODEL)                    ,INTENT(IN)    :: YDMODEL
TYPE(TDIMV)                    ,INTENT(IN)    :: YDDIMV
TYPE(CPG_BNDS_TYPE)            ,INTENT(IN)    :: YDCPG_BNDS
TYPE(CPG_OPTS_TYPE)            ,INTENT(IN)    :: YDCPG_OPTS
REAL(KIND=JPRB)                ,INTENT(IN)    :: PDT 
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDQ   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG)  
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDL   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG)  
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDR   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG)  
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDI   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG)  
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDS   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG)  
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDG   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG)  
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDTKE (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG)  
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDH   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG)  
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDT   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG) 
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDU   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG) 
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDV   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG) 
REAL(KIND=JPRB)                ,INTENT(IN)    :: PTENDD   (YDCPG_OPTS%KLON,YDCPG_OPTS%KFLEVG) 

#include "cputqy0.intfb.h"

REAL(KIND=JPRB) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK('CPUTQY_AROME_EXPL', 0, ZHOOK_HANDLE)

CALL CPUTQY0 (.TRUE.,         YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%U,   PDT, YDMF_PHYS_NEXT_STATE%U,   PTENDU)
CALL CPUTQY0 (.TRUE.,         YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%V,   PDT, YDMF_PHYS_NEXT_STATE%V,   PTENDV)
CALL CPUTQY0 (.TRUE.,         YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%T,   PDT, YDMF_PHYS_NEXT_STATE%T,   PTENDT)
CALL CPUTQY0 (LNHDYN,         YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%SVD, PDT, YDMF_PHYS_NEXT_STATE%SVD, PTENDD)
CALL CPUTQY0 (YDVARS%L%LT1,   YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%L,   PDT, YDMF_PHYS_NEXT_STATE%L,   PTENDL)
CALL CPUTQY0 (YDVARS%I%LT1,   YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%I,   PDT, YDMF_PHYS_NEXT_STATE%I,   PTENDI)
CALL CPUTQY0 (YDVARS%S%LT1,   YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%S,   PDT, YDMF_PHYS_NEXT_STATE%S,   PTENDS)
CALL CPUTQY0 (YDVARS%R%LT1,   YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%R,   PDT, YDMF_PHYS_NEXT_STATE%R,   PTENDR)
CALL CPUTQY0 (YDVARS%G%LT1,   YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%G,   PDT, YDMF_PHYS_NEXT_STATE%G,   PTENDG)
CALL CPUTQY0 (YDVARS%H%LT1,   YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%H,   PDT, YDMF_PHYS_NEXT_STATE%H,   PTENDH)
CALL CPUTQY0 (YDVARS%TKE%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%TKE, PDT, YDMF_PHYS_NEXT_STATE%TKE, PTENDTKE)
CALL CPUTQY0 (YDVARS%Q%LT1,   YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS%YRVARS_DIMS%Q,   PDT, YDMF_PHYS_NEXT_STATE%Q,   PTENDQ)


IF (LHOOK) CALL DR_HOOK('CPUTQY_AROME_EXPL', 1, ZHOOK_HANDLE)
END SUBROUTINE CPUTQY_AROME_EXPL
