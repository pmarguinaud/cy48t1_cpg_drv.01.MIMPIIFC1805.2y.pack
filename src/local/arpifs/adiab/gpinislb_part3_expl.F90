SUBROUTINE GPINISLB_PART3_EXPL (LDGWADV, LDNHDYN, LDVERTFE, LDVFE_GW, YDGEOMETRY, KST, KEN, &
                              & PVVEL0, PZPRE0F, PB2VVEL, PB2GWF, PB2GDW, PB2GWS, PGWFT0, PGDW0, PGWS0)

USE PARKIND1, ONLY : JPIM, JPRB

USE GEOMETRY_MOD , ONLY : GEOMETRY


IMPLICIT NONE

LOGICAL, INTENT (IN) :: LDGWADV
LOGICAL, INTENT (IN) :: LDNHDYN
LOGICAL, INTENT (IN) :: LDVERTFE
LOGICAL, INTENT (IN) :: LDVFE_GW
TYPE(GEOMETRY)    ,INTENT(IN)    :: YDGEOMETRY
INTEGER(KIND=JPIM),INTENT(IN)    :: KST
INTEGER(KIND=JPIM),INTENT(IN)    :: KEN
REAL(KIND=JPRB)   ,INTENT(IN)    :: PVVEL0(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)   ,INTENT(INOUT) :: PB2VVEL(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)   ,INTENT(INOUT) :: PB2GWF(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)   ,INTENT(INOUT) :: PB2GDW(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)   ,INTENT(INOUT) :: PB2GWS(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PZPRE0F(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),OPTIONAL,INTENT(IN) :: PGWFT0(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),OPTIONAL,INTENT(IN) :: PGDW0(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),OPTIONAL,INTENT(IN) :: PGWS0(YDGEOMETRY%YRDIM%NPROMA)

#include "abor1.intfb.h"

INTEGER (KIND=JPIM) :: JLEV


!*          2.     PB2[X] for other purposes.
!                  -------------------------- 

!*          2.1    PB2VVEL.

!cf this do loop is furiously non linear, but useless in tl model
  ! Non linear: TL code is in CPG_GP_TL.
DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
  PB2VVEL(KST:KEN,JLEV)=PVVEL0(KST:KEN,JLEV)*PZPRE0F(KST:KEN,JLEV)
ENDDO

!*          2.2    (gw), (g w_surf) and (g dw).

IF (LDNHDYN.AND.LDGWADV.AND.LDVERTFE.AND.LDVFE_GW) THEN
  ! Not yet coded in the TL code.
  ! Makes sence only for LTWOTL=T and LSLAG=T
  IF (.NOT.(PRESENT(PGWFT0).AND.PRESENT(PGDW0).AND.PRESENT(PGWS0)))&
   & CALL ABOR1(' GPINISLB 2a: missing optional input arguments!')
  DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
    PB2GWF(KST:KEN,JLEV)=PGWFT0(KST:KEN,JLEV)
    PB2GDW(KST:KEN,JLEV)=PGDW0(KST:KEN,JLEV)
  ENDDO
  PB2GWS(KST:KEN)=PGWS0(KST:KEN)
ENDIF

END SUBROUTINE
