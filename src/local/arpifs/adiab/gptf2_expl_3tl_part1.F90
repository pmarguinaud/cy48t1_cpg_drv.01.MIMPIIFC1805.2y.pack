SUBROUTINE GPTF2_EXPL_3TL_PART1 (YDGEOMETRY, YDML_GCONF, YDDYN, KST, KEN, LDFSTEP, LDNHDYN, KVDVAR, &
 & P0SP  , P0SPL , P0SPM , P9SP  , P9SPL , P9SPM, &
 & P0DIV , P0NHX , P0SPD , P0SPDL, P0SPDM, P0SVD , P0SVDL, &
 & P0SVDM, P0T   , P0TL  , P0TM  , P0U   , P0V   , P9DIV,  &
 & P9NHX , P9SPD , P9SPDL, P9SPDM, P9SVD , P9SVDL, P9SVDM, &
 & P9T   , P9TL  , P9TM  , P9U   , P9V)

USE PARKIND1, ONLY : JPIM, JPRB

USE GEOMETRY_MOD , ONLY : GEOMETRY
USE MODEL_GENERAL_CONF_MOD , ONLY : MODEL_GENERAL_CONF_TYPE
USE YOMDYN       , ONLY : TDYN


IMPLICIT NONE

TYPE(GEOMETRY)    ,INTENT(IN)    :: YDGEOMETRY
TYPE(MODEL_GENERAL_CONF_TYPE),INTENT(IN):: YDML_GCONF
TYPE(TDYN)        ,INTENT(IN)    :: YDDYN
INTEGER(KIND=JPIM),INTENT(IN)    :: KST
INTEGER(KIND=JPIM),INTENT(IN)    :: KEN
LOGICAL           ,INTENT(IN)    :: LDFSTEP
LOGICAL, INTENT(IN) :: LDNHDYN
INTEGER(KIND=JPIM), INTENT(IN) :: KVDVAR
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA)   :: P0SP
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA)   :: P0SPL
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA)   :: P0SPM
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA)   :: P9SP
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA)   :: P9SPL
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA)   :: P9SPM
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0DIV
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0NHX
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0SPD
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0SPDL
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0SPDM
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0SVD
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0SVDL
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0SVDM
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0T
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0TL
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0TM
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0U
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P0V
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9DIV
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9NHX
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9SPD
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9SPDL
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9SPDM
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9SVD
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9SVDL
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9SVDM
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9T
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9TL
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9TM
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9U
REAL(KIND=JPRB),OPTIONAL, INTENT(INOUT),DIMENSION(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG) :: P9V


INTEGER (KIND=JPIM) :: JK
INTEGER (KIND=JPIM) :: JL



!*        1.2   THREE TIME LEVEL

IF(LDFSTEP) THEN
  DO JK=1,YDGEOMETRY%YRDIMV%NFLEVG
    DO JL=KST,KEN
      P9U(JL,JK)   = P0U(JL,JK)
      P9V(JL,JK)   = P0V(JL,JK)
      P9DIV(JL,JK) = P0DIV(JL,JK)
    ENDDO
    IF(YDML_GCONF%YRDIMF%NFTHER >= 1) THEN
      DO JL=KST,KEN
        P9T(JL,JK)  = P0T(JL,JK)
        P9TL(JL,JK) = P0TL(JL,JK)
        P9TM(JL,JK) = P0TM(JL,JK)
      ENDDO
    ENDIF
  ENDDO

  IF(LDNHDYN) THEN
    DO JK=1,YDGEOMETRY%YRDIMV%NFLEVG
      DO JL=KST,KEN
        P9SPD(JL,JK) = P0SPD(JL,JK)
        P9SVD(JL,JK) = P0SVD(JL,JK)
        P9SPDL(JL,JK) = P0SPDL(JL,JK)
        P9SVDL(JL,JK) = P0SVDL(JL,JK)
        P9SPDM(JL,JK) = P0SPDM(JL,JK)
        P9SVDM(JL,JK) = P0SVDM(JL,JK)
      ENDDO
    ENDDO

    IF( KVDVAR==4 .OR. KVDVAR==5 ) THEN
      DO JK=1,YDGEOMETRY%YRDIMV%NFLEVG
        DO JL=KST,KEN
          P9NHX(JL,JK) = P0NHX(JL,JK)
        ENDDO
      ENDDO
    ENDIF

  ENDIF

  DO JL=KST,KEN
    P9SP(JL)  = P0SP(JL)
    P9SPL(JL) = P0SPL(JL)
    P9SPM(JL) = P0SPM(JL)
  ENDDO

ELSE

  DO JK=1,YDGEOMETRY%YRDIMV%NFLEVG
    DO JL=KST,KEN
      P9U(JL,JK)   = P9U(JL,JK)  +YDDYN%REPS2*P0U(JL,JK)
      P9V(JL,JK)   = P9V(JL,JK)  +YDDYN%REPS2*P0V(JL,JK)
      P9DIV(JL,JK) = P9DIV(JL,JK)+YDDYN%REPS2*P0DIV(JL,JK)
    ENDDO
    IF(YDML_GCONF%YRDIMF%NFTHER >= 1) THEN
      DO JL=KST,KEN
        P9T(JL,JK)  = P9T(JL,JK)  +YDDYN%REPS2*P0T(JL,JK)
        P9TL(JL,JK) = P9TL(JL,JK) +YDDYN%REPS2*P0TL(JL,JK)
        P9TM(JL,JK) = P9TM(JL,JK) +YDDYN%REPS2*P0TM(JL,JK)
      ENDDO
    ENDIF
  ENDDO

  IF(LDNHDYN) THEN
    DO JK=1,YDGEOMETRY%YRDIMV%NFLEVG
      DO JL=KST,KEN
        P9SPD(JL,JK)  =&
         & P9SPD(JL,JK)+YDDYN%REPS2*P0SPD(JL,JK)
        P9SVD(JL,JK)  =&
         & P9SVD(JL,JK)+YDDYN%REPS2*P0SVD(JL,JK)
        P9SPDL(JL,JK) =&
         & P9SPDL(JL,JK)+YDDYN%REPS2*P0SPDL(JL,JK)
        P9SVDL(JL,JK) =&
         & P9SVDL(JL,JK)+YDDYN%REPS2*P0SVDL(JL,JK)
        P9SPDM(JL,JK) =&
         & P9SPDM(JL,JK)+YDDYN%REPS2*P0SPDM(JL,JK)
        P9SVDM(JL,JK) =&
         & P9SVDM(JL,JK)+YDDYN%REPS2*P0SVDM(JL,JK)
      ENDDO
    ENDDO
  ENDIF

  DO JL=KST,KEN
    P9SP(JL)  = P9SP(JL) +YDDYN%REPS2*P0SP(JL)
    P9SPL(JL) = P9SPL(JL)+YDDYN%REPS2*P0SPL(JL)
    P9SPM(JL) = P9SPM(JL)+YDDYN%REPS2*P0SPM(JL)
  ENDDO

ENDIF

END SUBROUTINE
