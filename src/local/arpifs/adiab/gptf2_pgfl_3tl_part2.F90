SUBROUTINE GPTF2_PGFL_3TL_PART2 (YDGEOMETRY, YDML_GCONF, YDDYN, KST, KEN, LDFSTEP, PGFL)

USE PARKIND1, ONLY : JPIM, JPRB

USE GEOMETRY_MOD , ONLY : GEOMETRY
USE MODEL_GENERAL_CONF_MOD , ONLY : MODEL_GENERAL_CONF_TYPE
USE YOMDYN       , ONLY : TDYN


IMPLICIT NONE

TYPE(GEOMETRY)    ,INTENT(IN)    :: YDGEOMETRY
TYPE(MODEL_GENERAL_CONF_TYPE),INTENT(IN):: YDML_GCONF
TYPE(TDYN)        ,INTENT(IN)    :: YDDYN
INTEGER(KIND=JPIM),INTENT(IN)    :: KST
INTEGER(KIND=JPIM),INTENT(IN)    :: KEN
LOGICAL           ,INTENT(IN)    :: LDFSTEP
REAL(KIND=JPRB)   ,INTENT(INOUT) :: PGFL(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG,YDML_GCONF%YGFL%NDIM)


INTEGER (KIND=JPIM) :: JGFL
INTEGER (KIND=JPIM) :: JK
INTEGER (KIND=JPIM) :: JL


IF (LDFSTEP) THEN

  DO JGFL=1,YDML_GCONF%YGFL%NUMFLDS
    IF(YDML_GCONF%YGFL%YCOMP(JGFL)%LT9) THEN
      DO JK=1,YDGEOMETRY%YRDIMV%NFLEVG
        DO JL=KST,KEN
          PGFL(JL,JK,YDML_GCONF%YGFL%YCOMP(JGFL)%MP9) = PGFL(JL,JK,YDML_GCONF%YGFL%YCOMP(JGFL)%MP)
        ENDDO
      ENDDO
    ENDIF
  ENDDO

ELSE

  DO JGFL=1,YDML_GCONF%YGFL%NUMFLDS
    IF(YDML_GCONF%YGFL%YCOMP(JGFL)%LT9) THEN
      DO JK=1,YDGEOMETRY%YRDIMV%NFLEVG
        DO JL=KST,KEN
          PGFL(JL,JK,YDML_GCONF%YGFL%YCOMP(JGFL)%MP9) = PGFL(JL,JK,YDML_GCONF%YGFL%YCOMP(JGFL)%MP9)+&
           & YDDYN%REPSM2*PGFL(JL,JK,YDML_GCONF%YGFL%YCOMP(JGFL)%MP)  
        ENDDO
      ENDDO
    ENDIF
  ENDDO

ENDIF

END SUBROUTINE
