SUBROUTINE LATTEX_GFL_2TL (YDGEOMETRY, YDCPG_BNDS, YDML_GCONF, YDML_DYN, PGFL, YDCPG_SL1, YDVARS, LDCT, LDCTC)

USE PARKIND1, ONLY : JPIM, JPRB
USE YOMHOOK, ONLY : LHOOK, DR_HOOK

USE GEOMETRY_MOD           , ONLY : GEOMETRY
USE CPG_OPTS_TYPE_MOD, ONLY : CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MODEL_GENERAL_CONF_MOD , ONLY : MODEL_GENERAL_CONF_TYPE
USE MODEL_DYNAMICS_MOD     , ONLY : MODEL_DYNAMICS_TYPE
USE CPG_TYPE_MOD           , ONLY : CPG_SL1_TYPE
USE FIELD_VARIABLES_MOD,ONLY : FIELD_VARIABLES


IMPLICIT NONE

TYPE(GEOMETRY)    ,INTENT(IN)    :: YDGEOMETRY
TYPE(CPG_BNDS_TYPE)   ,INTENT(IN)   :: YDCPG_BNDS
TYPE(MODEL_GENERAL_CONF_TYPE),INTENT(IN):: YDML_GCONF
TYPE(MODEL_DYNAMICS_TYPE),INTENT(IN):: YDML_DYN
REAL(KIND=JPRB)   ,INTENT(IN)    :: PGFL(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG,YDML_GCONF%YGFL%NDIM)
TYPE(CPG_SL1_TYPE),INTENT(INOUT) :: YDCPG_SL1
TYPE(FIELD_VARIABLES),INTENT(INOUT) :: YDVARS
LOGICAL, INTENT (IN) :: LDCT
LOGICAL, INTENT (IN) :: LDCTC

LOGICAL :: LLTDIABLIN
INTEGER(KIND=JPIM) :: IPQ
INTEGER (KIND=JPIM) :: IPX
INTEGER (KIND=JPIM) :: JGFL
INTEGER (KIND=JPIM) :: JLEV
INTEGER (KIND=JPIM) :: JROF

REAL(KIND=JPRB) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK('LATTEX_GFL_2TL',0,ZHOOK_HANDLE)

IF(LDCT.AND.(.NOT.LDCTC))THEN
  DO JGFL=1,YDML_GCONF%YGFL%NUMFLDS
    IF(YDML_GCONF%YGFL%YCOMP(JGFL)%LADV) THEN
      IPX=(YDML_GCONF%YGFL%YCOMP(JGFL)%MP_SL1-1)*(YDGEOMETRY%YRDIMV%NFLEN-YDGEOMETRY%YRDIMV%NFLSA+1)
      LLTDIABLIN=YDML_GCONF%YGFL%YCOMP(JGFL)%LTDIABLIN
      IF (YDML_DYN%YRDYN%LSPLTHOIGFL.AND.(YDML_DYN%YRDYN%NSPLTHOI==0).AND.(.NOT.LLTDIABLIN)) THEN
        DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
          DO JROF=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
            YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)=YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)&
             & +YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFLF9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)+PGFL(JROF,JLEV,YDML_GCONF%YGFL%YCOMP(JGFL)%MP9)
          ENDDO
        ENDDO
      ELSE
        DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
          DO JROF=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
            YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)=YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)&
             & +PGFL(JROF,JLEV,YDML_GCONF%YGFL%YCOMP(JGFL)%MP9)
          ENDDO
        ENDDO
      ENDIF
    ENDIF
  ENDDO
ELSEIF (.NOT.LDCT) THEN
  DO JGFL=1,YDML_GCONF%YGFL%NUMFLDS
    IF(YDML_GCONF%YGFL%YCOMP(JGFL)%LADV) THEN
      IPX=(YDML_GCONF%YGFL%YCOMP(JGFL)%MP_SL1-1)*(YDGEOMETRY%YRDIMV%NFLEN-YDGEOMETRY%YRDIMV%NFLSA+1)
      LLTDIABLIN=YDML_GCONF%YGFL%YCOMP(JGFL)%LTDIABLIN
      IF (YDML_DYN%YRDYN%LSPLTHOIGFL.AND.(YDML_DYN%YRDYN%NSPLTHOI==0).AND.(.NOT.LLTDIABLIN)) THEN
        DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
          DO JROF=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
            YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)=YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)&
             & +YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFLF9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)+PGFL(JROF,JLEV,YDML_GCONF%YGFL%YCOMP(JGFL)%MP)
          ENDDO
        ENDDO
      ELSE
        DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
          DO JROF=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
            YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)=YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)&
             & +PGFL(JROF,JLEV,YDML_GCONF%YGFL%YCOMP(JGFL)%MP)
          ENDDO
        ENDDO
      ENDIF
    ENDIF
  ENDDO
ENDIF


!  Qv in YCVGQ for computation of SL Moisture Convergence for French physics

IF (YDML_GCONF%YGFL%YCVGQ%LGP .AND. (.NOT.LDCTC)) THEN  
  IPX=(YDML_GCONF%YGFL%YCVGQ%MP_SL1-1)*(YDGEOMETRY%YRDIMV%NFLEN-YDGEOMETRY%YRDIMV%NFLSA+1)
  IPQ=(YDML_GCONF%YGFL%YQ%MP_SL1-1)*(YDGEOMETRY%YRDIMV%NFLEN-YDGEOMETRY%YRDIMV%NFLSA+1)
  LLTDIABLIN=YDML_GCONF%YGFL%YCVGQ%LTDIABLIN
  IF ((YDML_DYN%YRDYN%NSPLTHOI /= 0).OR.LLTDIABLIN) THEN
    DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
      DO JROF=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
        YDCPG_SL1%CVGQ_F(JROF,JLEV)=YDCPG_SL1%Q_F(JROF,JLEV)
!       YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFLF9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)=&
!       YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFLF9+IPQ+JLEV-YDGEOMETRY%YRDIMV%NFLSA)
      ENDDO
    ENDDO
  ENDIF
  DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
    DO JROF=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
      YDCPG_SL1%CVGQ(JROF,JLEV)=YDCPG_SL1%Q(JROF,JLEV)
!     YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)=&
!     YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPQ+JLEV-YDGEOMETRY%YRDIMV%NFLSA)
    ENDDO
  ENDDO
  LLTDIABLIN=YDML_GCONF%YGFL%YCVGQ%LTDIABLIN.AND.YDML_GCONF%YGFL%YQ%LTDIABLIN
  IF ((YDML_DYN%YRDYN%NSPLTHOI == 0).AND.LLTDIABLIN) THEN
    DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
      DO JROF=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
        YDCPG_SL1%CVGQ(JROF,JLEV)=YDCPG_SL1%CVGQ(JROF,JLEV)+YDCPG_SL1%Q_F(JROF,JLEV)
!       YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)=&
!    &  YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)&
!    & +YDCPG_SL1%ZVIEW(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFLF9+IPQ+JLEV-YDGEOMETRY%YRDIMV%NFLSA)
      ENDDO
    ENDDO
  ENDIF
ENDIF   

IF (LHOOK) CALL DR_HOOK('LATTEX_GFL_2TL',1,ZHOOK_HANDLE)

END SUBROUTINE
