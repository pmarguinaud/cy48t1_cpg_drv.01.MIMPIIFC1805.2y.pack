SUBROUTINE LATTEX_GFL_3TL (YDGEOMETRY, YDCPG_BNDS, YDML_GCONF, YDML_DYN, PGFL, PB1, LDTDIABLIN)

USE PARKIND1, ONLY : JPIM, JPRB

USE GEOMETRY_MOD           , ONLY : GEOMETRY
USE CPG_OPTS_TYPE_MOD, ONLY : CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MODEL_GENERAL_CONF_MOD , ONLY : MODEL_GENERAL_CONF_TYPE
USE MODEL_DYNAMICS_MOD     , ONLY : MODEL_DYNAMICS_TYPE


IMPLICIT NONE

TYPE(GEOMETRY)    ,INTENT(IN)    :: YDGEOMETRY
TYPE(CPG_BNDS_TYPE)   ,INTENT(IN)   :: YDCPG_BNDS
TYPE(MODEL_GENERAL_CONF_TYPE),INTENT(IN):: YDML_GCONF
TYPE(MODEL_DYNAMICS_TYPE),INTENT(IN):: YDML_DYN
REAL(KIND=JPRB)   ,INTENT(IN)    :: PGFL(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG,YDML_GCONF%YGFL%NDIM)
REAL(KIND=JPRB)   ,INTENT(INOUT) :: PB1(YDGEOMETRY%YRDIM%NPROMA,YDML_DYN%YRPTRSLB1%NFLDSLB1)
LOGICAL :: LDTDIABLIN


INTEGER (KIND=JPIM) :: IPX
INTEGER (KIND=JPIM) :: JGFL
INTEGER (KIND=JPIM) :: JLEV
INTEGER (KIND=JPIM) :: JROF


DO JGFL=1,YDML_GCONF%YGFL%NUMFLDS
  IF(YDML_GCONF%YGFL%YCOMP(JGFL)%LADV) THEN
    IPX=(YDML_GCONF%YGFL%YCOMP(JGFL)%MP_SL1-1)*(YDGEOMETRY%YRDIMV%NFLEN-YDGEOMETRY%YRDIMV%NFLSA+1)
    DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
      DO JROF=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
        PB1(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)=PB1(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)&
         & +PGFL(JROF,JLEV,YDML_GCONF%YGFL%YCOMP(JGFL)%MP9)
      ENDDO
    ENDDO
    LDTDIABLIN=YDML_GCONF%YGFL%YCOMP(JGFL)%LTDIABLIN
    IF (YDML_DYN%YRDYN%LSPLTHOIGFL.AND.(YDML_DYN%YRDYN%NSPLTHOI==0).AND.(.NOT.LDTDIABLIN)) THEN
      DO JLEV=1,YDGEOMETRY%YRDIMV%NFLEVG
        DO JROF=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
          PB1(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)=PB1(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFL9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)&
           & +PB1(JROF,YDML_DYN%YRPTRSLB1%MSLB1GFLF9+IPX+JLEV-YDGEOMETRY%YRDIMV%NFLSA)
        ENDDO
      ENDDO
    ENDIF
  ENDIF
ENDDO

END SUBROUTINE
