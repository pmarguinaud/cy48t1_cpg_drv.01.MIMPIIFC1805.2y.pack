MODULE CPG_DIM_TYPE_MOD

USE PARKIND1, ONLY : JPIM, JPRB
USE GEOMETRY_MOD, ONLY : GEOMETRY

IMPLICIT NONE

TYPE CPG_DIM_TYPE
  INTEGER(KIND=JPIM) :: KIDIA,KFDIA,KBL,KLON,KLEVG,KSTGLO,KGPTOT,KGPCOMP,KFDIE,KIDIE

CONTAINS
  PROCEDURE :: INIT => CPG_DIM_TYPE_INIT
  PROCEDURE :: UPDATE => CPG_DIM_TYPE_UPDATE
END TYPE CPG_DIM_TYPE

CONTAINS

  SUBROUTINE CPG_DIM_TYPE_INIT(SELF, YDGEOMETRY)
    CLASS(CPG_DIM_TYPE) :: SELF
    TYPE(GEOMETRY), INTENT(IN) :: YDGEOMETRY

    SELF%KBL     = 1
    SELF%KLON    = YDGEOMETRY%YRDIM%NPROMA
    SELF%KIDIA   = 1
    SELF%KIDIE   = 1
    SELF%KFDIA   = YDGEOMETRY%YRDIM%NPROMA
    SELF%KFDIE   = YDGEOMETRY%YRDIM%NPROMA
    SELF%KLEVG   = YDGEOMETRY%YRDIMV%NFLEVG
    SELF%KGPTOT  = YDGEOMETRY%YRGEM%NGPTOT
    SELF%KGPCOMP = YDGEOMETRY%YRGEM%NGPTOT_CAP
  END SUBROUTINE CPG_DIM_TYPE_INIT

  SUBROUTINE CPG_DIM_TYPE_UPDATE(SELF, IBL)
    CLASS(CPG_DIM_TYPE) :: SELF
    INTEGER(KIND=JPIM), INTENT(IN) :: IBL

    SELF%KBL    = IBL
    SELF%KSTGLO = 1 + (IBL - 1) * SELF%KLON
    SELF%KFDIA  = MIN (SELF%KLON, SELF%KGPCOMP - SELF%KSTGLO + 1)
    SELF%KFDIE  = MIN (SELF%KLON, SELF%KGPTOT  - SELF%KSTGLO + 1)

  END SUBROUTINE CPG_DIM_TYPE_UPDATE

END MODULE CPG_DIM_TYPE_MOD
