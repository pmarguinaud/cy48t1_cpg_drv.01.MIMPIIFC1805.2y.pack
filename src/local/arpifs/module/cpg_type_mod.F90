MODULE CPG_TYPE_MOD

USE FIELD_MODULE
USE FIELD_REGISTRY_MOD
USE PARKIND1, ONLY : JPRB, JPIM

IMPLICIT NONE

TYPE CPG_XYB_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER :: ZDATA (:,:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER :: ZVIEW (:,:,:) => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DELP (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_DELP => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RDELP (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_RDELP => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LNPR (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_LNPR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPH (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_ALPH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RTGR (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_RTGR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RPRE (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_RPRE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RPP (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_RPP => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_XYB_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_XYB_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_XYB_TYPE_FINAL
END TYPE CPG_XYB_TYPE

TYPE CPG_HWIND_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER :: ZDATA (:,:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER :: ZVIEW (:,:,:) => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: UH (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_UH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VH (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_VH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WWI (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_WWI => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_HWIND_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_HWIND_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_HWIND_TYPE_FINAL
END TYPE CPG_HWIND_TYPE

TYPE CPG_RCP_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER :: ZDATA (:,:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER :: ZVIEW (:,:,:) => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: CP (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_CP => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: R (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_R => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KAP (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_KAP => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_RCP_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_RCP_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_RCP_TYPE_FINAL
END TYPE CPG_RCP_TYPE

TYPE CPG_CTY_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER :: ZDATA (:,:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER :: ZVIEW (:,:,:) => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: EVEL (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_EVEL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VVEL (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_VVEL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PSDIV (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PSDIV => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PSDVBC (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PSDVBC => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DIVDP (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_DIVDP => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_CTY_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_CTY_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_CTY_TYPE_FINAL
END TYPE CPG_CTY_TYPE

TYPE CPG_TND_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER :: ZDATA (:,:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER :: ZVIEW (:,:,:) => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDU (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_TNDU => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDV (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_TNDV => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDU_NOC (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_TNDU_NOC => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDV_NOC (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_TNDV_NOC => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDT (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_TNDT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDPD (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_TNDPD => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDVD (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_TNDVD => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDGW (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_TNDGW => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_TND_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_TND_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_TND_TYPE_FINAL
END TYPE CPG_TND_TYPE

TYPE CPG_DYN_TYPE

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGL (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_OROGL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGM (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_OROGM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGLL (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_OROGLL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGMM (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_OROGMM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGLM (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_OROGLM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GDW (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_GDW => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWHT (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_GWHT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHI (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PHI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PRE (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PRE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHIF (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PHIF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREF (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PREF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WRL (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_WRL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREL (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_PREL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREM (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_PREM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHY (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_NHY => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWFT (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_GWFT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KENE (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_KENE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHX (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_NHX => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHIFL (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PHIFL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHIFM (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PHIFM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RTL (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_RTL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RTM (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_RTM => NULL ()
  TYPE (CPG_RCP_TYPE) :: RCP
  TYPE (CPG_CTY_TYPE) :: CTY
  TYPE (CPG_HWIND_TYPE) :: UVH
  TYPE (CPG_XYB_TYPE) :: XYB
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DBBC (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_DBBC => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWS (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_GWS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWFL (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_GWFL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWFM (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_GWFM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWT (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_GWT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHPREF (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_NHPREF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHPREH (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_NHPREH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QCHAL (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_QCHAL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QCHAM (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_QCHAM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RDPHI (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_RDPHI => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_DYN_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_DYN_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_DYN_TYPE_FINAL
END TYPE CPG_DYN_TYPE

TYPE CPG_PHY_TYPE

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PRE (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PRE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREF (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PREF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREHYD (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PREHYD => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREHYDF (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_PREHYDF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WL (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_WL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WM (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_WM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: W (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_W => NULL ()
  TYPE (CPG_XYB_TYPE) :: XYB

CONTAINS
  PROCEDURE :: INIT => CPG_PHY_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_PHY_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_PHY_TYPE_FINAL
END TYPE CPG_PHY_TYPE

TYPE CPG_MISC_TYPE

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NEB (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_NEB => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QLI (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_QLI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QICE (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_QICE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QRAIN (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_QRAIN => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QSNOW (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_QSNOW => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RH (:, :) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_RH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QS (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_QS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QSOL (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_QSOL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DHSF (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_DHSF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: CLCT (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_CLCT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LSM (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_LSM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TSOL (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_TSOL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: FTCNS (:, :, :) => NULL ()
  TYPE (FIELD_4D), POINTER :: F_FTCNS => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_MISC_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_MISC_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_MISC_TYPE_FINAL
END TYPE CPG_MISC_TYPE

REAL(KIND=JPRB), PRIVATE, SAVE, TARGET :: ZDUM1 (1), ZDUM2 (1, 1), ZDUM3 (1,1,1)

CONTAINS

SUBROUTINE CPG_XYB_TYPE_INIT (SELF, REGISTRY, NLEV, YDTXYB, PERSISTENT, PXYB)

USE INTDYN_MOD, ONLY : TXYB

CLASS (CPG_XYB_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TXYB),                   INTENT (IN)    :: YDTXYB
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PXYB (:, :, :, :)

IF (PRESENT (PXYB)) THEN
  SELF%ZDATA => PXYB
  SELF%LOWNED = .FALSE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%NPROMA, NLEV, YDTXYB%NDIM, REGISTRY%NBLOCKS))
  SELF%LOWNED = .TRUE.
ENDIF

 IF (YDTXYB%M_DELP > 0) THEN
   SELF%F_DELP => CREATE_FIELD_WRAP ('DELP', SELF%ZDATA (:, :, YDTXYB%M_DELP, :))
 ENDIF
 IF (YDTXYB%M_RDELP > 0) THEN
   SELF%F_RDELP => CREATE_FIELD_WRAP ('RDELP', SELF%ZDATA (:, :, YDTXYB%M_RDELP, :))
 ENDIF
 IF (YDTXYB%M_LNPR > 0) THEN
   SELF%F_LNPR => CREATE_FIELD_WRAP ('LNPR', SELF%ZDATA (:, :, YDTXYB%M_LNPR, :))
 ENDIF
 IF (YDTXYB%M_ALPH > 0) THEN
   SELF%F_ALPH => CREATE_FIELD_WRAP ('ALPH', SELF%ZDATA (:, :, YDTXYB%M_ALPH, :))
 ENDIF
 IF (YDTXYB%M_RTGR > 0) THEN
   SELF%F_RTGR => CREATE_FIELD_WRAP ('RTGR', SELF%ZDATA (:, :, YDTXYB%M_RTGR, :))
 ENDIF
 IF (YDTXYB%M_RPRE > 0) THEN
   SELF%F_RPRE => CREATE_FIELD_WRAP ('RPRE', SELF%ZDATA (:, :, YDTXYB%M_RPRE, :))
 ENDIF
 IF (YDTXYB%M_RPP > 0) THEN
   SELF%F_RPP => CREATE_FIELD_WRAP ('RPP', SELF%ZDATA (:, :, YDTXYB%M_RPP, :))
 ENDIF


END SUBROUTINE CPG_XYB_TYPE_INIT

SUBROUTINE CPG_XYB_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_XYB_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

SELF%ZVIEW => SELF%ZDATA (:,:,:,BLOCK_INDEX)

IF (ASSOCIATED (SELF%F_DELP)) THEN  
  SELF%DELP  => SELF%F_DELP%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%DELP  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RDELP)) THEN  
  SELF%RDELP  => SELF%F_RDELP%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%RDELP  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_LNPR)) THEN  
  SELF%LNPR  => SELF%F_LNPR%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%LNPR  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_ALPH)) THEN  
  SELF%ALPH  => SELF%F_ALPH%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%ALPH  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RTGR)) THEN  
  SELF%RTGR  => SELF%F_RTGR%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%RTGR  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RPRE)) THEN  
  SELF%RPRE  => SELF%F_RPRE%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%RPRE  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RPP)) THEN  
  SELF%RPP  => SELF%F_RPP%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%RPP  => ZDUM2
ENDIF

END SUBROUTINE CPG_XYB_TYPE_UPDATE_VIEW

SUBROUTINE CPG_XYB_TYPE_FINAL (SELF)
CLASS (CPG_XYB_TYPE)          :: SELF

IF (SELF%LOWNED) DEALLOCATE (SELF%ZDATA)
SELF%ZDATA => NULL ()

IF (ASSOCIATED (SELF%F_DELP)) CALL DELETE_TEMPORARY (SELF%F_DELP) 
IF (ASSOCIATED (SELF%F_RDELP)) CALL DELETE_TEMPORARY (SELF%F_RDELP) 
IF (ASSOCIATED (SELF%F_LNPR)) CALL DELETE_TEMPORARY (SELF%F_LNPR) 
IF (ASSOCIATED (SELF%F_ALPH)) CALL DELETE_TEMPORARY (SELF%F_ALPH) 
IF (ASSOCIATED (SELF%F_RTGR)) CALL DELETE_TEMPORARY (SELF%F_RTGR) 
IF (ASSOCIATED (SELF%F_RPRE)) CALL DELETE_TEMPORARY (SELF%F_RPRE) 
IF (ASSOCIATED (SELF%F_RPP)) CALL DELETE_TEMPORARY (SELF%F_RPP) 

END SUBROUTINE CPG_XYB_TYPE_FINAL

SUBROUTINE CPG_HWIND_TYPE_INIT (SELF, REGISTRY, NLEV, YDTHWIND, PERSISTENT, PHWIND)

USE INTDYN_MOD, ONLY : THWIND

CLASS (CPG_HWIND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (THWIND),                   INTENT (IN)    :: YDTHWIND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PHWIND (:, :, :, :)

IF (PRESENT (PHWIND)) THEN
  SELF%ZDATA => PHWIND
  SELF%LOWNED = .FALSE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%NPROMA, NLEV+1, YDTHWIND%NDIM, REGISTRY%NBLOCKS))
  SELF%LOWNED = .TRUE.
ENDIF

 IF (YDTHWIND%M_UH > 0) THEN
   SELF%F_UH => CREATE_FIELD_WRAP ('UH', SELF%ZDATA (:, :, YDTHWIND%M_UH, :))
 ENDIF
 IF (YDTHWIND%M_VH > 0) THEN
   SELF%F_VH => CREATE_FIELD_WRAP ('VH', SELF%ZDATA (:, :, YDTHWIND%M_VH, :))
 ENDIF
 IF (YDTHWIND%M_WWI > 0) THEN
   SELF%F_WWI => CREATE_FIELD_WRAP ('WWI', SELF%ZDATA (:, :, YDTHWIND%M_WWI, :))
 ENDIF


END SUBROUTINE CPG_HWIND_TYPE_INIT

SUBROUTINE CPG_HWIND_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_HWIND_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

SELF%ZVIEW => SELF%ZDATA (:,:,:,BLOCK_INDEX)

IF (ASSOCIATED (SELF%F_UH)) THEN  
  SELF%UH (1:,0:) => SELF%F_UH%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%UH (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_VH)) THEN  
  SELF%VH (1:,0:) => SELF%F_VH%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%VH (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_WWI)) THEN  
  SELF%WWI (1:,0:) => SELF%F_WWI%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%WWI (1:,0:) => ZDUM2
ENDIF

END SUBROUTINE CPG_HWIND_TYPE_UPDATE_VIEW

SUBROUTINE CPG_HWIND_TYPE_FINAL (SELF)
CLASS (CPG_HWIND_TYPE)          :: SELF

IF (SELF%LOWNED) DEALLOCATE (SELF%ZDATA)
SELF%ZDATA => NULL ()

IF (ASSOCIATED (SELF%F_UH)) CALL DELETE_TEMPORARY (SELF%F_UH) 
IF (ASSOCIATED (SELF%F_VH)) CALL DELETE_TEMPORARY (SELF%F_VH) 
IF (ASSOCIATED (SELF%F_WWI)) CALL DELETE_TEMPORARY (SELF%F_WWI) 

END SUBROUTINE CPG_HWIND_TYPE_FINAL

SUBROUTINE CPG_RCP_TYPE_INIT (SELF, REGISTRY, NLEV, YDTRCP, PERSISTENT, PRCP)

USE INTDYN_MOD, ONLY : TRCP

CLASS (CPG_RCP_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TRCP),                   INTENT (IN)    :: YDTRCP
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PRCP (:, :, :, :)

IF (PRESENT (PRCP)) THEN
  SELF%ZDATA => PRCP
  SELF%LOWNED = .FALSE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%NPROMA, NLEV, YDTRCP%NDIM, REGISTRY%NBLOCKS))
  SELF%LOWNED = .TRUE.
ENDIF

 IF (YDTRCP%M_CP > 0) THEN
   SELF%F_CP => CREATE_FIELD_WRAP ('CP', SELF%ZDATA (:, :, YDTRCP%M_CP, :))
 ENDIF
 IF (YDTRCP%M_R > 0) THEN
   SELF%F_R => CREATE_FIELD_WRAP ('R', SELF%ZDATA (:, :, YDTRCP%M_R, :))
 ENDIF
 IF (YDTRCP%M_KAP > 0) THEN
   SELF%F_KAP => CREATE_FIELD_WRAP ('KAP', SELF%ZDATA (:, :, YDTRCP%M_KAP, :))
 ENDIF


END SUBROUTINE CPG_RCP_TYPE_INIT

SUBROUTINE CPG_RCP_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_RCP_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

SELF%ZVIEW => SELF%ZDATA (:,:,:,BLOCK_INDEX)

IF (ASSOCIATED (SELF%F_CP)) THEN  
  SELF%CP  => SELF%F_CP%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%CP  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_R)) THEN  
  SELF%R  => SELF%F_R%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%R  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_KAP)) THEN  
  SELF%KAP  => SELF%F_KAP%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%KAP  => ZDUM2
ENDIF

END SUBROUTINE CPG_RCP_TYPE_UPDATE_VIEW

SUBROUTINE CPG_RCP_TYPE_FINAL (SELF)
CLASS (CPG_RCP_TYPE)          :: SELF

IF (SELF%LOWNED) DEALLOCATE (SELF%ZDATA)
SELF%ZDATA => NULL ()

IF (ASSOCIATED (SELF%F_CP)) CALL DELETE_TEMPORARY (SELF%F_CP) 
IF (ASSOCIATED (SELF%F_R)) CALL DELETE_TEMPORARY (SELF%F_R) 
IF (ASSOCIATED (SELF%F_KAP)) CALL DELETE_TEMPORARY (SELF%F_KAP) 

END SUBROUTINE CPG_RCP_TYPE_FINAL

SUBROUTINE CPG_CTY_TYPE_INIT (SELF, REGISTRY, NLEV, YDTCTY, PERSISTENT, PCTY)

USE INTDYN_MOD, ONLY : TCTY

CLASS (CPG_CTY_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TCTY),                   INTENT (IN)    :: YDTCTY
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PCTY (:, :, :, :)

IF (PRESENT (PCTY)) THEN
  SELF%ZDATA => PCTY
  SELF%LOWNED = .FALSE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%NPROMA, NLEV+1, YDTCTY%NDIM, REGISTRY%NBLOCKS))
  SELF%LOWNED = .TRUE.
ENDIF

 IF (YDTCTY%M_EVEL > 0) THEN
   SELF%F_EVEL => CREATE_FIELD_WRAP ('EVEL', SELF%ZDATA (:, :, YDTCTY%M_EVEL, :))
 ENDIF
 IF (YDTCTY%M_VVEL > 0) THEN
   SELF%F_VVEL => CREATE_FIELD_WRAP ('VVEL', SELF%ZDATA (:, :, YDTCTY%M_VVEL, :))
 ENDIF
 IF (YDTCTY%M_PSDIV > 0) THEN
   SELF%F_PSDIV => CREATE_FIELD_WRAP ('PSDIV', SELF%ZDATA (:, :, YDTCTY%M_PSDIV, :))
 ENDIF
 IF (YDTCTY%M_PSDVBC > 0) THEN
   SELF%F_PSDVBC => CREATE_FIELD_WRAP ('PSDVBC', SELF%ZDATA (:, :, YDTCTY%M_PSDVBC, :))
 ENDIF
 IF (YDTCTY%M_DIVDP > 0) THEN
   SELF%F_DIVDP => CREATE_FIELD_WRAP ('DIVDP', SELF%ZDATA (:, :, YDTCTY%M_DIVDP, :))
 ENDIF


END SUBROUTINE CPG_CTY_TYPE_INIT

SUBROUTINE CPG_CTY_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_CTY_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

SELF%ZVIEW => SELF%ZDATA (:,:,:,BLOCK_INDEX)

IF (ASSOCIATED (SELF%F_EVEL)) THEN  
  SELF%EVEL (1:,0:) => SELF%F_EVEL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%EVEL (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_VVEL)) THEN  
  SELF%VVEL (1:,0:) => SELF%F_VVEL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%VVEL (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PSDIV)) THEN  
  SELF%PSDIV (1:,0:) => SELF%F_PSDIV%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PSDIV (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PSDVBC)) THEN  
  SELF%PSDVBC (1:,0:) => SELF%F_PSDVBC%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PSDVBC (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_DIVDP)) THEN  
  SELF%DIVDP (1:,0:) => SELF%F_DIVDP%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%DIVDP (1:,0:) => ZDUM2
ENDIF

END SUBROUTINE CPG_CTY_TYPE_UPDATE_VIEW

SUBROUTINE CPG_CTY_TYPE_FINAL (SELF)
CLASS (CPG_CTY_TYPE)          :: SELF

IF (SELF%LOWNED) DEALLOCATE (SELF%ZDATA)
SELF%ZDATA => NULL ()

IF (ASSOCIATED (SELF%F_EVEL)) CALL DELETE_TEMPORARY (SELF%F_EVEL) 
IF (ASSOCIATED (SELF%F_VVEL)) CALL DELETE_TEMPORARY (SELF%F_VVEL) 
IF (ASSOCIATED (SELF%F_PSDIV)) CALL DELETE_TEMPORARY (SELF%F_PSDIV) 
IF (ASSOCIATED (SELF%F_PSDVBC)) CALL DELETE_TEMPORARY (SELF%F_PSDVBC) 
IF (ASSOCIATED (SELF%F_DIVDP)) CALL DELETE_TEMPORARY (SELF%F_DIVDP) 

END SUBROUTINE CPG_CTY_TYPE_FINAL

SUBROUTINE CPG_TND_TYPE_INIT (SELF, REGISTRY, NLEV, YDTTND, PERSISTENT, PTND)

USE INTDYN_MOD, ONLY : TTND

CLASS (CPG_TND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TTND),                   INTENT (IN)    :: YDTTND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTND (:, :, :, :)

IF (PRESENT (PTND)) THEN
  SELF%ZDATA => PTND
  SELF%LOWNED = .FALSE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%NPROMA, NLEV, YDTTND%NDIM, REGISTRY%NBLOCKS))
  SELF%LOWNED = .TRUE.
ENDIF

 IF (YDTTND%M_TNDU > 0) THEN
   SELF%F_TNDU => CREATE_FIELD_WRAP ('TNDU', SELF%ZDATA (:, :, YDTTND%M_TNDU, :))
 ENDIF
 IF (YDTTND%M_TNDV > 0) THEN
   SELF%F_TNDV => CREATE_FIELD_WRAP ('TNDV', SELF%ZDATA (:, :, YDTTND%M_TNDV, :))
 ENDIF
 IF (YDTTND%M_TNDU_NOC > 0) THEN
   SELF%F_TNDU_NOC => CREATE_FIELD_WRAP ('TNDU_NOC', SELF%ZDATA (:, :, YDTTND%M_TNDU_NOC, :))
 ENDIF
 IF (YDTTND%M_TNDV_NOC > 0) THEN
   SELF%F_TNDV_NOC => CREATE_FIELD_WRAP ('TNDV_NOC', SELF%ZDATA (:, :, YDTTND%M_TNDV_NOC, :))
 ENDIF
 IF (YDTTND%M_TNDT > 0) THEN
   SELF%F_TNDT => CREATE_FIELD_WRAP ('TNDT', SELF%ZDATA (:, :, YDTTND%M_TNDT, :))
 ENDIF
 IF (YDTTND%M_TNDPD > 0) THEN
   SELF%F_TNDPD => CREATE_FIELD_WRAP ('TNDPD', SELF%ZDATA (:, :, YDTTND%M_TNDPD, :))
 ENDIF
 IF (YDTTND%M_TNDVD > 0) THEN
   SELF%F_TNDVD => CREATE_FIELD_WRAP ('TNDVD', SELF%ZDATA (:, :, YDTTND%M_TNDVD, :))
 ENDIF
 IF (YDTTND%M_TNDGW > 0) THEN
   SELF%F_TNDGW => CREATE_FIELD_WRAP ('TNDGW', SELF%ZDATA (:, :, YDTTND%M_TNDGW, :))
 ENDIF


END SUBROUTINE CPG_TND_TYPE_INIT

SUBROUTINE CPG_TND_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_TND_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

SELF%ZVIEW => SELF%ZDATA (:,:,:,BLOCK_INDEX)

IF (ASSOCIATED (SELF%F_TNDU)) THEN  
  SELF%TNDU  => SELF%F_TNDU%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%TNDU  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_TNDV)) THEN  
  SELF%TNDV  => SELF%F_TNDV%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%TNDV  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_TNDU_NOC)) THEN  
  SELF%TNDU_NOC  => SELF%F_TNDU_NOC%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%TNDU_NOC  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_TNDV_NOC)) THEN  
  SELF%TNDV_NOC  => SELF%F_TNDV_NOC%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%TNDV_NOC  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_TNDT)) THEN  
  SELF%TNDT  => SELF%F_TNDT%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%TNDT  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_TNDPD)) THEN  
  SELF%TNDPD  => SELF%F_TNDPD%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%TNDPD  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_TNDVD)) THEN  
  SELF%TNDVD  => SELF%F_TNDVD%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%TNDVD  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_TNDGW)) THEN  
  SELF%TNDGW  => SELF%F_TNDGW%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%TNDGW  => ZDUM2
ENDIF

END SUBROUTINE CPG_TND_TYPE_UPDATE_VIEW

SUBROUTINE CPG_TND_TYPE_FINAL (SELF)
CLASS (CPG_TND_TYPE)          :: SELF

IF (SELF%LOWNED) DEALLOCATE (SELF%ZDATA)
SELF%ZDATA => NULL ()

IF (ASSOCIATED (SELF%F_TNDU)) CALL DELETE_TEMPORARY (SELF%F_TNDU) 
IF (ASSOCIATED (SELF%F_TNDV)) CALL DELETE_TEMPORARY (SELF%F_TNDV) 
IF (ASSOCIATED (SELF%F_TNDU_NOC)) CALL DELETE_TEMPORARY (SELF%F_TNDU_NOC) 
IF (ASSOCIATED (SELF%F_TNDV_NOC)) CALL DELETE_TEMPORARY (SELF%F_TNDV_NOC) 
IF (ASSOCIATED (SELF%F_TNDT)) CALL DELETE_TEMPORARY (SELF%F_TNDT) 
IF (ASSOCIATED (SELF%F_TNDPD)) CALL DELETE_TEMPORARY (SELF%F_TNDPD) 
IF (ASSOCIATED (SELF%F_TNDVD)) CALL DELETE_TEMPORARY (SELF%F_TNDVD) 
IF (ASSOCIATED (SELF%F_TNDGW)) CALL DELETE_TEMPORARY (SELF%F_TNDGW) 

END SUBROUTINE CPG_TND_TYPE_FINAL




SUBROUTINE CPG_DYN_TYPE_INIT (SELF &
                                & , KT  &
                                & , REGISTRY &
                                & , NLEV &
                                & , PERSISTENT &
                           &, PHIF &
                           &, PREF &
                           &, PWRL &
                           &, PRCP &
                           &, PCTY &
                           &)

USE INTDYN_MOD, ONLY : YYTCTY0, YYTRCP0, YYTHW0, YYTXYB0, YYTXYB0_PHY
USE INTDYN_MOD, ONLY :          YYTRCP9, YYTHW9, YYTXYB9, YYTXYB9_PHY
USE INTDYN_MOD, ONLY : TRCP, TCTY, THWIND, TXYB

USE YOMCT0    , ONLY : LNHDYN

CLASS (CPG_DYN_TYPE)                    :: SELF
INTEGER(KIND=JPIM),           INTENT (IN)    :: KT
TYPE (FIELD_REGISTRY),        INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),          INTENT (IN)    :: NLEV
LOGICAL, OPTIONAL,            INTENT (IN)    :: PERSISTENT

REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PHIF(:, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PREF(:, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PWRL(:, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PRCP(:, :, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PCTY(:, :, :, :)

LOGICAL :: LLT0

TYPE (TRCP)   , POINTER :: YLTRCP     
TYPE (TCTY)   , POINTER :: YLTCTY     
TYPE (THWIND) , POINTER :: YLTHW     
TYPE (TXYB)   , POINTER :: YLTXYB     
TYPE (TXYB)   , POINTER :: YLTXYB_PHY

TYPE (TCTY),   TARGET :: YLTCTY0 
TYPE (THWIND), TARGET :: YLTHW0, YLTHW9 
TYPE (TRCP),   TARGET :: YLTRCP0, YLTRCP9 
TYPE (TXYB),   TARGET :: YLTXYB0, YLTXYB0_PHY, YLTXYB9, YLTXYB9_PHY

YLTCTY0     = YYTCTY0 
YLTHW0      = YYTHW0 
YLTHW9      = YYTHW9 
YLTRCP0     = YYTRCP0 
YLTRCP9     = YYTRCP9 
YLTXYB0     = YYTXYB0 
YLTXYB0_PHY = YYTXYB0_PHY 
YLTXYB9     = YYTXYB9 
YLTXYB9_PHY = YYTXYB9_PHY

LLT0 = KT == 0

YLTRCP     => NULL ()
YLTCTY     => NULL ()
YLTHW      => NULL ()
YLTXYB     => NULL ()
YLTXYB_PHY => NULL ()

IF (KT == 0) THEN
  YLTRCP     => YLTRCP0
  YLTCTY     => YLTCTY0
  YLTHW      => YLTHW0
  YLTXYB     => YLTXYB0
  YLTXYB_PHY => YLTXYB0_PHY
ELSEIF (KT == 9) THEN
  YLTRCP     => YLTRCP9
  YLTCTY     => NULL ()
  YLTHW      => YLTHW9
  YLTXYB     => YLTXYB9
  YLTXYB_PHY => YLTXYB9_PHY
ENDIF


IF (LLT0) THEN
  SELF%F_OROGL => CREATE_TEMPORARY ("OROGL", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
  SELF%F_OROGM => CREATE_TEMPORARY ("OROGM", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_OROGLL => CREATE_TEMPORARY ("OROGLL", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_OROGMM => CREATE_TEMPORARY ("OROGMM", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_OROGLM => CREATE_TEMPORARY ("OROGLM", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN) THEN
  SELF%F_GDW => CREATE_TEMPORARY ("GDW", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

SELF%F_GWHT => CREATE_TEMPORARY ("GWHT", GEOM=REGISTRY%GEOM, NLEV=NLEV+1, PERSISTENT=PERSISTENT)

SELF%F_PHI => CREATE_TEMPORARY ("PHI", GEOM=REGISTRY%GEOM, NLEV=NLEV+1, PERSISTENT=PERSISTENT)

SELF%F_PRE => CREATE_TEMPORARY ("PRE", GEOM=REGISTRY%GEOM, NLEV=NLEV+1, PERSISTENT=PERSISTENT)

IF (PRESENT (PHIF)) THEN
  SELF%F_PHIF => CREATE_FIELD_WRAP ('PHIF', PHIF)
ELSE
  SELF%F_PHIF => CREATE_TEMPORARY ("PHIF", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (PRESENT (PREF)) THEN
  SELF%F_PREF => CREATE_FIELD_WRAP ('PREF', PREF)
ELSE
  SELF%F_PREF => CREATE_TEMPORARY ("PREF", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (PRESENT (PWRL)) THEN
  SELF%F_WRL => CREATE_FIELD_WRAP ('WRL', PWRL)
ENDIF

SELF%F_PREL => CREATE_TEMPORARY ("PREL", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_PREM => CREATE_TEMPORARY ("PREM", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_NHY => CREATE_TEMPORARY ("NHY", GEOM=REGISTRY%GEOM, NLEV=NLEV+1, PERSISTENT=PERSISTENT)

SELF%F_GWFT => CREATE_TEMPORARY ("GWFT", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)

IF (LLT0) THEN
  SELF%F_KENE => CREATE_TEMPORARY ("KENE", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

SELF%F_NHX => CREATE_TEMPORARY ("NHX", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)

IF (LLT0) THEN
  SELF%F_PHIFL => CREATE_TEMPORARY ("PHIFL", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
  SELF%F_PHIFM => CREATE_TEMPORARY ("PHIFM", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
  SELF%F_RTL => CREATE_TEMPORARY ("RTL", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
  SELF%F_RTM => CREATE_TEMPORARY ("RTM", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

CALL SELF%RCP%INIT (REGISTRY, NLEV, YLTRCP, PERSISTENT, PRCP)

IF (LLT0) THEN
  CALL SELF%CTY%INIT (REGISTRY, NLEV, YLTCTY, PERSISTENT, PCTY)
ENDIF

IF (LLT0) THEN
  CALL SELF%UVH%INIT (REGISTRY, NLEV, YLTHW, PERSISTENT)
ENDIF

CALL SELF%XYB%INIT (REGISTRY, NLEV, YLTXYB, PERSISTENT)

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_DBBC => CREATE_TEMPORARY ("DBBC", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_GWS => CREATE_TEMPORARY ("GWS", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_GWFL => CREATE_TEMPORARY ("GWFL", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_GWFM => CREATE_TEMPORARY ("GWFM", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN) THEN
  SELF%F_GWT => CREATE_TEMPORARY ("GWT", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN) THEN
  SELF%F_NHPREF => CREATE_TEMPORARY ("NHPREF", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN) THEN
  SELF%F_NHPREH => CREATE_TEMPORARY ("NHPREH", GEOM=REGISTRY%GEOM, NLEV=NLEV+1, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_QCHAL => CREATE_TEMPORARY ("QCHAL", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_QCHAM => CREATE_TEMPORARY ("QCHAM", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_RDPHI => CREATE_TEMPORARY ("RDPHI", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF


END SUBROUTINE CPG_DYN_TYPE_INIT

SUBROUTINE CPG_DYN_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_DYN_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_OROGL)) THEN
  SELF%OROGL  => SELF%F_OROGL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%OROGL  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_OROGM)) THEN
  SELF%OROGM  => SELF%F_OROGM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%OROGM  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_OROGLL)) THEN
  SELF%OROGLL  => SELF%F_OROGLL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%OROGLL  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_OROGMM)) THEN
  SELF%OROGMM  => SELF%F_OROGMM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%OROGMM  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_OROGLM)) THEN
  SELF%OROGLM  => SELF%F_OROGLM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%OROGLM  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_GDW)) THEN
  SELF%GDW  => SELF%F_GDW%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%GDW  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWHT)) THEN
  SELF%GWHT (1:,0:) => SELF%F_GWHT%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%GWHT (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHI)) THEN
  SELF%PHI (1:,0:) => SELF%F_PHI%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PHI (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PRE)) THEN
  SELF%PRE (1:,0:) => SELF%F_PRE%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PRE (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHIF)) THEN
  SELF%PHIF  => SELF%F_PHIF%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PHIF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREF)) THEN
  SELF%PREF  => SELF%F_PREF%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PREF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_WRL)) THEN
  SELF%WRL  => SELF%F_WRL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%WRL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREL)) THEN
  SELF%PREL  => SELF%F_PREL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PREL  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_PREM)) THEN
  SELF%PREM  => SELF%F_PREM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PREM  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_NHY)) THEN
  SELF%NHY (1:,0:) => SELF%F_NHY%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%NHY (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWFT)) THEN
  SELF%GWFT  => SELF%F_GWFT%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%GWFT  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_KENE)) THEN
  SELF%KENE  => SELF%F_KENE%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%KENE  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_NHX)) THEN
  SELF%NHX  => SELF%F_NHX%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%NHX  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHIFL)) THEN
  SELF%PHIFL  => SELF%F_PHIFL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PHIFL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHIFM)) THEN
  SELF%PHIFM  => SELF%F_PHIFM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PHIFM  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RTL)) THEN
  SELF%RTL  => SELF%F_RTL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%RTL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RTM)) THEN
  SELF%RTM  => SELF%F_RTM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%RTM  => ZDUM2
ENDIF
CALL SELF%RCP%UPDATE_VIEW (BLOCK_INDEX)
CALL SELF%CTY%UPDATE_VIEW (BLOCK_INDEX)
CALL SELF%UVH%UPDATE_VIEW (BLOCK_INDEX)
CALL SELF%XYB%UPDATE_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_DBBC)) THEN
  SELF%DBBC  => SELF%F_DBBC%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%DBBC  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_GWS)) THEN
  SELF%GWS  => SELF%F_GWS%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%GWS  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_GWFL)) THEN
  SELF%GWFL  => SELF%F_GWFL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%GWFL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWFM)) THEN
  SELF%GWFM  => SELF%F_GWFM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%GWFM  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWT)) THEN
  SELF%GWT  => SELF%F_GWT%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%GWT  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_NHPREF)) THEN
  SELF%NHPREF  => SELF%F_NHPREF%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%NHPREF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_NHPREH)) THEN
  SELF%NHPREH (1:,0:) => SELF%F_NHPREH%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%NHPREH (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QCHAL)) THEN
  SELF%QCHAL  => SELF%F_QCHAL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%QCHAL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QCHAM)) THEN
  SELF%QCHAM  => SELF%F_QCHAM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%QCHAM  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RDPHI)) THEN
  SELF%RDPHI  => SELF%F_RDPHI%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%RDPHI  => ZDUM2
ENDIF

END SUBROUTINE CPG_DYN_TYPE_UPDATE_VIEW

SUBROUTINE CPG_DYN_TYPE_FINAL (SELF)
CLASS (CPG_DYN_TYPE)         :: SELF

IF (ASSOCIATED (SELF%F_OROGL)) CALL DELETE_TEMPORARY (SELF%F_OROGL) 
IF (ASSOCIATED (SELF%F_OROGM)) CALL DELETE_TEMPORARY (SELF%F_OROGM) 
IF (ASSOCIATED (SELF%F_OROGLL)) CALL DELETE_TEMPORARY (SELF%F_OROGLL) 
IF (ASSOCIATED (SELF%F_OROGMM)) CALL DELETE_TEMPORARY (SELF%F_OROGMM) 
IF (ASSOCIATED (SELF%F_OROGLM)) CALL DELETE_TEMPORARY (SELF%F_OROGLM) 
IF (ASSOCIATED (SELF%F_GDW)) CALL DELETE_TEMPORARY (SELF%F_GDW) 
IF (ASSOCIATED (SELF%F_GWHT)) CALL DELETE_TEMPORARY (SELF%F_GWHT) 
IF (ASSOCIATED (SELF%F_PHI)) CALL DELETE_TEMPORARY (SELF%F_PHI) 
IF (ASSOCIATED (SELF%F_PRE)) CALL DELETE_TEMPORARY (SELF%F_PRE) 
IF (ASSOCIATED (SELF%F_PHIF)) CALL DELETE_TEMPORARY (SELF%F_PHIF) 
IF (ASSOCIATED (SELF%F_PREF)) CALL DELETE_TEMPORARY (SELF%F_PREF) 
IF (ASSOCIATED (SELF%F_WRL)) CALL DELETE_TEMPORARY (SELF%F_WRL) 
IF (ASSOCIATED (SELF%F_PREL)) CALL DELETE_TEMPORARY (SELF%F_PREL) 
IF (ASSOCIATED (SELF%F_PREM)) CALL DELETE_TEMPORARY (SELF%F_PREM) 
IF (ASSOCIATED (SELF%F_NHY)) CALL DELETE_TEMPORARY (SELF%F_NHY) 
IF (ASSOCIATED (SELF%F_GWFT)) CALL DELETE_TEMPORARY (SELF%F_GWFT) 
IF (ASSOCIATED (SELF%F_KENE)) CALL DELETE_TEMPORARY (SELF%F_KENE) 
IF (ASSOCIATED (SELF%F_NHX)) CALL DELETE_TEMPORARY (SELF%F_NHX) 
IF (ASSOCIATED (SELF%F_PHIFL)) CALL DELETE_TEMPORARY (SELF%F_PHIFL) 
IF (ASSOCIATED (SELF%F_PHIFM)) CALL DELETE_TEMPORARY (SELF%F_PHIFM) 
IF (ASSOCIATED (SELF%F_RTL)) CALL DELETE_TEMPORARY (SELF%F_RTL) 
IF (ASSOCIATED (SELF%F_RTM)) CALL DELETE_TEMPORARY (SELF%F_RTM) 
CALL SELF%RCP%FINAL ()
CALL SELF%CTY%FINAL ()
CALL SELF%UVH%FINAL ()
CALL SELF%XYB%FINAL ()
IF (ASSOCIATED (SELF%F_DBBC)) CALL DELETE_TEMPORARY (SELF%F_DBBC) 
IF (ASSOCIATED (SELF%F_GWS)) CALL DELETE_TEMPORARY (SELF%F_GWS) 
IF (ASSOCIATED (SELF%F_GWFL)) CALL DELETE_TEMPORARY (SELF%F_GWFL) 
IF (ASSOCIATED (SELF%F_GWFM)) CALL DELETE_TEMPORARY (SELF%F_GWFM) 
IF (ASSOCIATED (SELF%F_GWT)) CALL DELETE_TEMPORARY (SELF%F_GWT) 
IF (ASSOCIATED (SELF%F_NHPREF)) CALL DELETE_TEMPORARY (SELF%F_NHPREF) 
IF (ASSOCIATED (SELF%F_NHPREH)) CALL DELETE_TEMPORARY (SELF%F_NHPREH) 
IF (ASSOCIATED (SELF%F_QCHAL)) CALL DELETE_TEMPORARY (SELF%F_QCHAL) 
IF (ASSOCIATED (SELF%F_QCHAM)) CALL DELETE_TEMPORARY (SELF%F_QCHAM) 
IF (ASSOCIATED (SELF%F_RDPHI)) CALL DELETE_TEMPORARY (SELF%F_RDPHI) 

END SUBROUTINE CPG_DYN_TYPE_FINAL




SUBROUTINE CPG_PHY_TYPE_INIT (SELF &
                                & , KT  &
                                & , REGISTRY &
                                & , NLEV &
                                & , PERSISTENT &
                                & , LDMF_PHYS &
                           &)

USE INTDYN_MOD, ONLY : YYTCTY0, YYTRCP0, YYTHW0, YYTXYB0, YYTXYB0_PHY
USE INTDYN_MOD, ONLY :          YYTRCP9, YYTHW9, YYTXYB9, YYTXYB9_PHY
USE INTDYN_MOD, ONLY : TRCP, TCTY, THWIND, TXYB


CLASS (CPG_PHY_TYPE)                    :: SELF
INTEGER(KIND=JPIM),           INTENT (IN)    :: KT
TYPE (FIELD_REGISTRY),        INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),          INTENT (IN)    :: NLEV
LOGICAL, OPTIONAL,            INTENT (IN)    :: PERSISTENT
LOGICAL, OPTIONAL,            INTENT (IN)    :: LDMF_PHYS


LOGICAL :: LLT0
LOGICAL :: LLMF_PHYS

TYPE (TRCP)   , POINTER :: YLTRCP     
TYPE (TCTY)   , POINTER :: YLTCTY     
TYPE (THWIND) , POINTER :: YLTHW     
TYPE (TXYB)   , POINTER :: YLTXYB     
TYPE (TXYB)   , POINTER :: YLTXYB_PHY

TYPE (TCTY),   TARGET :: YLTCTY0 
TYPE (THWIND), TARGET :: YLTHW0, YLTHW9 
TYPE (TRCP),   TARGET :: YLTRCP0, YLTRCP9 
TYPE (TXYB),   TARGET :: YLTXYB0, YLTXYB0_PHY, YLTXYB9, YLTXYB9_PHY

YLTCTY0     = YYTCTY0 
YLTHW0      = YYTHW0 
YLTHW9      = YYTHW9 
YLTRCP0     = YYTRCP0 
YLTRCP9     = YYTRCP9 
YLTXYB0     = YYTXYB0 
YLTXYB0_PHY = YYTXYB0_PHY 
YLTXYB9     = YYTXYB9 
YLTXYB9_PHY = YYTXYB9_PHY

LLT0 = KT == 0

YLTRCP     => NULL ()
YLTCTY     => NULL ()
YLTHW      => NULL ()
YLTXYB     => NULL ()
YLTXYB_PHY => NULL ()

IF (KT == 0) THEN
  YLTRCP     => YLTRCP0
  YLTCTY     => YLTCTY0
  YLTHW      => YLTHW0
  YLTXYB     => YLTXYB0
  YLTXYB_PHY => YLTXYB0_PHY
ELSEIF (KT == 9) THEN
  YLTRCP     => YLTRCP9
  YLTCTY     => NULL ()
  YLTHW      => YLTHW9
  YLTXYB     => YLTXYB9
  YLTXYB_PHY => YLTXYB9_PHY
ENDIF

LLMF_PHYS = .FALSE.
IF (PRESENT (LDMF_PHYS)) THEN
  LLMF_PHYS = LDMF_PHYS
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_PRE => CREATE_TEMPORARY ("PRE", GEOM=REGISTRY%GEOM, NLEV=NLEV+1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_PREF => CREATE_TEMPORARY ("PREF", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_PREHYD => CREATE_TEMPORARY ("PREHYD", GEOM=REGISTRY%GEOM, NLEV=NLEV+1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_PREHYDF => CREATE_TEMPORARY ("PREHYDF", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_WL => CREATE_TEMPORARY ("WL", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_WM => CREATE_TEMPORARY ("WM", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_W => CREATE_TEMPORARY ("W", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  CALL SELF%XYB%INIT (REGISTRY, NLEV, YLTXYB_PHY, PERSISTENT)
ENDIF


END SUBROUTINE CPG_PHY_TYPE_INIT

SUBROUTINE CPG_PHY_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_PHY_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_PRE)) THEN
  SELF%PRE (1:,0:) => SELF%F_PRE%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PRE (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREF)) THEN
  SELF%PREF  => SELF%F_PREF%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PREF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREHYD)) THEN
  SELF%PREHYD (1:,0:) => SELF%F_PREHYD%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PREHYD (1:,0:) => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREHYDF)) THEN
  SELF%PREHYDF  => SELF%F_PREHYDF%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%PREHYDF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_WL)) THEN
  SELF%WL  => SELF%F_WL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%WL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_WM)) THEN
  SELF%WM  => SELF%F_WM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%WM  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_W)) THEN
  SELF%W  => SELF%F_W%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%W  => ZDUM2
ENDIF
CALL SELF%XYB%UPDATE_VIEW (BLOCK_INDEX)

END SUBROUTINE CPG_PHY_TYPE_UPDATE_VIEW

SUBROUTINE CPG_PHY_TYPE_FINAL (SELF)
CLASS (CPG_PHY_TYPE)         :: SELF

IF (ASSOCIATED (SELF%F_PRE)) CALL DELETE_TEMPORARY (SELF%F_PRE) 
IF (ASSOCIATED (SELF%F_PREF)) CALL DELETE_TEMPORARY (SELF%F_PREF) 
IF (ASSOCIATED (SELF%F_PREHYD)) CALL DELETE_TEMPORARY (SELF%F_PREHYD) 
IF (ASSOCIATED (SELF%F_PREHYDF)) CALL DELETE_TEMPORARY (SELF%F_PREHYDF) 
IF (ASSOCIATED (SELF%F_WL)) CALL DELETE_TEMPORARY (SELF%F_WL) 
IF (ASSOCIATED (SELF%F_WM)) CALL DELETE_TEMPORARY (SELF%F_WM) 
IF (ASSOCIATED (SELF%F_W)) CALL DELETE_TEMPORARY (SELF%F_W) 
CALL SELF%XYB%FINAL ()

END SUBROUTINE CPG_PHY_TYPE_FINAL




SUBROUTINE CPG_MISC_TYPE_INIT (SELF &
                                & , REGISTRY &
                                & , NLEV &
                                & , PERSISTENT &
                           &)



CLASS (CPG_MISC_TYPE)                    :: SELF
TYPE (FIELD_REGISTRY),        INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),          INTENT (IN)    :: NLEV
LOGICAL, OPTIONAL,            INTENT (IN)    :: PERSISTENT







SELF%F_NEB => CREATE_TEMPORARY ("NEB", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)

SELF%F_QLI => CREATE_TEMPORARY ("QLI", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)

SELF%F_QICE => CREATE_TEMPORARY ("QICE", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)

SELF%F_QRAIN => CREATE_TEMPORARY ("QRAIN", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)

SELF%F_QSNOW => CREATE_TEMPORARY ("QSNOW", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)

SELF%F_RH => CREATE_TEMPORARY ("RH", GEOM=REGISTRY%GEOM, NLEV=NLEV, PERSISTENT=PERSISTENT)

SELF%F_QS => CREATE_TEMPORARY ("QS", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_QSOL => CREATE_TEMPORARY ("QSOL", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_DHSF => CREATE_TEMPORARY ("DHSF", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_CLCT => CREATE_TEMPORARY ("CLCT", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_LSM => CREATE_TEMPORARY ("LSM", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_TSOL => CREATE_TEMPORARY ("TSOL", GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_FTCNS => CREATE_TEMPORARY ("FTCNS", GEOM=REGISTRY%GEOM, NLEV=NLEV, NDIM=6, PERSISTENT=PERSISTENT)


END SUBROUTINE CPG_MISC_TYPE_INIT

SUBROUTINE CPG_MISC_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_MISC_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_NEB)) THEN
  SELF%NEB  => SELF%F_NEB%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%NEB  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QLI)) THEN
  SELF%QLI  => SELF%F_QLI%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%QLI  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QICE)) THEN
  SELF%QICE  => SELF%F_QICE%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%QICE  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QRAIN)) THEN
  SELF%QRAIN  => SELF%F_QRAIN%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%QRAIN  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QSNOW)) THEN
  SELF%QSNOW  => SELF%F_QSNOW%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%QSNOW  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RH)) THEN
  SELF%RH  => SELF%F_RH%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%RH  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QS)) THEN
  SELF%QS  => SELF%F_QS%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%QS  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_QSOL)) THEN
  SELF%QSOL  => SELF%F_QSOL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%QSOL  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_DHSF)) THEN
  SELF%DHSF  => SELF%F_DHSF%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%DHSF  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_CLCT)) THEN
  SELF%CLCT  => SELF%F_CLCT%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%CLCT  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_LSM)) THEN
  SELF%LSM  => SELF%F_LSM%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%LSM  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_TSOL)) THEN
  SELF%TSOL  => SELF%F_TSOL%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%TSOL  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_FTCNS)) THEN
  SELF%FTCNS  => SELF%F_FTCNS%GET_VIEW (BLOCK_INDEX)
ELSE
  SELF%FTCNS  => ZDUM3
ENDIF

END SUBROUTINE CPG_MISC_TYPE_UPDATE_VIEW

SUBROUTINE CPG_MISC_TYPE_FINAL (SELF)
CLASS (CPG_MISC_TYPE)         :: SELF

IF (ASSOCIATED (SELF%F_NEB)) CALL DELETE_TEMPORARY (SELF%F_NEB) 
IF (ASSOCIATED (SELF%F_QLI)) CALL DELETE_TEMPORARY (SELF%F_QLI) 
IF (ASSOCIATED (SELF%F_QICE)) CALL DELETE_TEMPORARY (SELF%F_QICE) 
IF (ASSOCIATED (SELF%F_QRAIN)) CALL DELETE_TEMPORARY (SELF%F_QRAIN) 
IF (ASSOCIATED (SELF%F_QSNOW)) CALL DELETE_TEMPORARY (SELF%F_QSNOW) 
IF (ASSOCIATED (SELF%F_RH)) CALL DELETE_TEMPORARY (SELF%F_RH) 
IF (ASSOCIATED (SELF%F_QS)) CALL DELETE_TEMPORARY (SELF%F_QS) 
IF (ASSOCIATED (SELF%F_QSOL)) CALL DELETE_TEMPORARY (SELF%F_QSOL) 
IF (ASSOCIATED (SELF%F_DHSF)) CALL DELETE_TEMPORARY (SELF%F_DHSF) 
IF (ASSOCIATED (SELF%F_CLCT)) CALL DELETE_TEMPORARY (SELF%F_CLCT) 
IF (ASSOCIATED (SELF%F_LSM)) CALL DELETE_TEMPORARY (SELF%F_LSM) 
IF (ASSOCIATED (SELF%F_TSOL)) CALL DELETE_TEMPORARY (SELF%F_TSOL) 
IF (ASSOCIATED (SELF%F_FTCNS)) CALL DELETE_TEMPORARY (SELF%F_FTCNS) 

END SUBROUTINE CPG_MISC_TYPE_FINAL

END MODULE CPG_TYPE_MOD

