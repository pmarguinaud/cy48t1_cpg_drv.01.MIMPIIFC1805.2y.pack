

MODULE FIELD_REGISTRY_MOD

USE PARKIND1, ONLY : JPIM, JPRB
USE FIELD_MODULE, ONLY: FIELD_2D, FIELD_INT2D, FIELD_LOG2D, FIELD_3D, FIELD_INT3D, FIELD_4D, FIELD_5D, &
 &                      FIELD_2D_EMPTY, FIELD_3D_EMPTY, FIELD_4D_EMPTY
USE GEOMETRY_MOD, ONLY: GEOMETRY
USE VARIABLE_MODULE, ONLY: VARIABLE_2D, VARIABLE_3D, VARIABLE_4D
USE FIELD_VARIABLES_MOD, ONLY: FIELD_VARIABLES
USE SURFACE_VARIABLES_MOD, ONLY: SURFACE_VARIABLES
USE YOMGMV, ONLY: TGMV
USE YOM_YGFL, ONLY: TYPE_GFL_COMP, TYPE_GFLD
USE YOMGFL, ONLY: TGFL
USE SURFACE_FIELDS_MIX, ONLY: TSURF, TYPE_SURF_MTL_2D, TYPE_SURF_MTL_3D, TYPE_SURF_GEN
USE EC_PHYS_FIELDS_MOD, ONLY: TEC_PHYS_FIELDS
USE MODEL_PHYSICS_RADIATION_MOD, ONLY : MODEL_PHYSICS_RADIATION_TYPE

IMPLICIT NONE

TYPE :: FIELD_REGISTRY
  TYPE(GEOMETRY), POINTER :: GEOM => NULL()
  INTEGER(KIND=JPIM) :: NPROMA, NBLOCKS

CONTAINS
  PROCEDURE :: INIT => FIELD_REGISTRY_INIT
  PROCEDURE :: FINAL => FIELD_REGISTRY_FINAL

  PROCEDURE :: FIELD_REGISTRY_CREATE_VARIABLE_2D_GMV, FIELD_REGISTRY_CREATE_VARIABLE_3D_GMV
  PROCEDURE :: FIELD_REGISTRY_CREATE_VARIABLE_GFL, FIELD_REGISTRY_CREATE_VARIABLE_ARRAY_GFL
  PROCEDURE :: FIELD_REGISTRY_CREATE_VARIABLE_WRAP_2D, FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_2D
  PROCEDURE :: FIELD_REGISTRY_CREATE_VARIABLE_WRAP_3D, FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_3D
  PROCEDURE :: FIELD_REGISTRY_CREATE_VARIABLE_WRAP_4D, FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_4D
  GENERIC   :: CREATE_VARIABLE => &
   & FIELD_REGISTRY_CREATE_VARIABLE_2D_GMV, FIELD_REGISTRY_CREATE_VARIABLE_3D_GMV, &
   & FIELD_REGISTRY_CREATE_VARIABLE_GFL, FIELD_REGISTRY_CREATE_VARIABLE_ARRAY_GFL, &
   & FIELD_REGISTRY_CREATE_VARIABLE_WRAP_2D, FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_2D, &
   & FIELD_REGISTRY_CREATE_VARIABLE_WRAP_3D, FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_3D, &
   & FIELD_REGISTRY_CREATE_VARIABLE_WRAP_4D, FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_4D
  PROCEDURE :: CREATE_SURFACE_VARIABLE_2D => FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_2D
  PROCEDURE :: CREATE_SURFACE_VARIABLE_ARRAY_2D => FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY_2D
  PROCEDURE :: CREATE_SURFACE_VARIABLE_ARRAY2_2D => FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY2_2D
  PROCEDURE :: CREATE_SURFACE_VARIABLE_3D => FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_3D
  PROCEDURE :: CREATE_SURFACE_VARIABLE_ARRAY_3D => FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY_3D
  PROCEDURE :: CREATE_SURFACE_VARIABLE_ARRAY2_3D => FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY2_3D
  PROCEDURE :: REGISTER_GEOMETRY => FIELD_REGISTRY_REGISTER_GEOMETRY
  PROCEDURE :: REGISTER_GMV_FIELDS => FIELD_REGISTRY_REGISTER_GMV_FIELDS
  PROCEDURE :: REGISTER_GFL_FIELDS => FIELD_REGISTRY_REGISTER_GFL_FIELDS
  PROCEDURE :: REGISTER_SURFACE_FIELDS => FIELD_REGISTRY_REGISTER_SURFACE_FIELDS
  PROCEDURE :: REGISTER_EC_PHYS_FIELDS => FIELD_REGISTRY_REGISTER_EC_PHYS_FIELDS
  PROCEDURE :: REGISTER_PHYSICS_RADIATION_FIELDS => FIELD_REGISTRY_REGISTER_PHYSICS_RADIATION_FIELDS

END TYPE FIELD_REGISTRY

INTERFACE CREATE_FIELD_WRAP
  MODULE PROCEDURE CREATE_FIELD_WRAP_2D, CREATE_FIELD_WRAP_3D, CREATE_FIELD_WRAP_4D
  MODULE PROCEDURE CREATE_FIELD_WRAP_PACKED_2D, CREATE_FIELD_WRAP_PACKED_3D, CREATE_FIELD_WRAP_PACKED_4D
END INTERFACE CREATE_FIELD_WRAP

INTERFACE CREATE_TEMPORARY
  MODULE PROCEDURE CREATE_TEMPORARY_2D, CREATE_TEMPORARY_3D, CREATE_TEMPORARY_4D, CREATE_TEMPORARY_5D
END INTERFACE CREATE_TEMPORARY

INTERFACE CREATE_TEMPORARY_INT
  MODULE PROCEDURE CREATE_TEMPORARY_INT2D, CREATE_TEMPORARY_INT3D
END INTERFACE CREATE_TEMPORARY_INT

INTERFACE DELETE_TEMPORARY
  MODULE PROCEDURE DELETE_TEMPORARY_2D, DELETE_TEMPORARY_INT2D, DELETE_TEMPORARY_LOG2D
  MODULE PROCEDURE DELETE_TEMPORARY_3D, DELETE_TEMPORARY_INT3D, DELETE_TEMPORARY_4D, DELETE_TEMPORARY_5D
END INTERFACE DELETE_TEMPORARY

CONTAINS

  FUNCTION CREATE_FIELD_WRAP_2D(DATA, PERSISTENT, LBOUNDS) RESULT(FIELD_PTR)
    ! Create a single 2D field with implicit blocking dimension by wrapping existing data
    TYPE(FIELD_2D), POINTER :: FIELD_PTR
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:)
    LOGICAL, OPTIONAL, INTENT (IN) :: PERSISTENT
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: LBOUNDS (2)

    ALLOCATE(FIELD_PTR)
    FIELD_PTR = FIELD_2D(DATA=DATA, PERSISTENT=PERSISTENT, LBOUNDS=LBOUNDS)
  END FUNCTION CREATE_FIELD_WRAP_2D

  FUNCTION CREATE_FIELD_WRAP_3D(DATA, PERSISTENT, LBOUNDS) RESULT(FIELD_PTR)
    ! Create a single 1D field with implicit blocking dimension by wrapping existing data
    TYPE(FIELD_3D), POINTER :: FIELD_PTR
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:)
    LOGICAL, OPTIONAL, INTENT (IN) :: PERSISTENT
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: LBOUNDS (3)

    ALLOCATE(FIELD_PTR)
    FIELD_PTR = FIELD_3D(DATA=DATA, PERSISTENT=PERSISTENT, LBOUNDS=LBOUNDS)
  END FUNCTION CREATE_FIELD_WRAP_3D

  FUNCTION CREATE_FIELD_WRAP_4D(DATA, PERSISTENT, LBOUNDS) RESULT(FIELD_PTR)
    ! Create a single 1D field with implicit blocking dimension by wrapping existing data
    TYPE(FIELD_4D), POINTER :: FIELD_PTR
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:,:)
    LOGICAL, OPTIONAL, INTENT (IN) :: PERSISTENT
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: LBOUNDS (4)

    ALLOCATE(FIELD_PTR)
    FIELD_PTR = FIELD_4D(DATA=DATA, PERSISTENT=PERSISTENT, LBOUNDS=LBOUNDS)
  END FUNCTION CREATE_FIELD_WRAP_4D

  FUNCTION CREATE_FIELD_WRAP_PACKED_2D(DATA, IDX, LBOUNDS) RESULT(FIELD_PTR)
    ! Create a single 2D field with implicit blocking dimension by wrapping existing data
    TYPE(FIELD_2D), POINTER :: FIELD_PTR
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:)
    INTEGER(KIND=JPIM), INTENT(IN) :: IDX
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: LBOUNDS (2)

    ALLOCATE(FIELD_PTR)
    FIELD_PTR = FIELD_2D(DATA=DATA, IDX=IDX, LBOUNDS=LBOUNDS)
  END FUNCTION CREATE_FIELD_WRAP_PACKED_2D

  FUNCTION CREATE_FIELD_WRAP_PACKED_3D(DATA, IDX, LBOUNDS) RESULT(FIELD_PTR)
    ! Create a single 1D field with implicit blocking dimension by wrapping existing data
    TYPE(FIELD_3D), POINTER :: FIELD_PTR
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:,:)
    INTEGER(KIND=JPIM), INTENT(IN) :: IDX
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: LBOUNDS (3)

    ALLOCATE(FIELD_PTR)
    FIELD_PTR = FIELD_3D(DATA=DATA, IDX=IDX, LBOUNDS=LBOUNDS)
  END FUNCTION CREATE_FIELD_WRAP_PACKED_3D

  FUNCTION CREATE_FIELD_WRAP_PACKED_4D(DATA, IDX, LBOUNDS) RESULT(FIELD_PTR)
    ! Create a single 1D field with implicit blocking dimension by wrapping existing data
    TYPE(FIELD_4D), POINTER :: FIELD_PTR
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:,:,:)
    INTEGER(KIND=JPIM), INTENT(IN) :: IDX
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: LBOUNDS (4)

    ALLOCATE(FIELD_PTR)
    FIELD_PTR = FIELD_4D(DATA=DATA, IDX=IDX, LBOUNDS=LBOUNDS)
  END FUNCTION CREATE_FIELD_WRAP_PACKED_4D

  FUNCTION CREATE_FIELD_EMPTY_2D(SHAPE) RESULT(FIELD_PTR)
    ! Create an empty 2D field object with NULL data pointers
    TYPE(FIELD_2D), POINTER :: FIELD_PTR
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: SHAPE(1)

    ALLOCATE(FIELD_PTR)
    FIELD_PTR = FIELD_2D_EMPTY(SHAPE=SHAPE)
  END FUNCTION CREATE_FIELD_EMPTY_2D

  FUNCTION CREATE_FIELD_EMPTY_3D(SHAPE) RESULT(FIELD_PTR)
    ! Create an empty 3D field object with NULL data pointers
    TYPE(FIELD_3D), POINTER :: FIELD_PTR
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: SHAPE(2)

    ALLOCATE(FIELD_PTR)
    FIELD_PTR = FIELD_3D_EMPTY(SHAPE=SHAPE)
  END FUNCTION CREATE_FIELD_EMPTY_3D

  FUNCTION CREATE_FIELD_EMPTY_4D(SHAPE) RESULT(FIELD_PTR)
    ! Create an empty 4D field object with NULL data pointers
    TYPE(FIELD_4D), POINTER :: FIELD_PTR
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: SHAPE(3)

    ALLOCATE(FIELD_PTR)
    FIELD_PTR = FIELD_4D_EMPTY(SHAPE=SHAPE)
  END FUNCTION CREATE_FIELD_EMPTY_4D

  FUNCTION CREATE_TEMPORARY_2D(GEOM, PERSISTENT) RESULT(FIELD_PTR)
    ! Create a single 2D field for temporary use with an implicit blocking dimension.
    TYPE(FIELD_2D), POINTER :: FIELD_PTR
    TYPE(GEOMETRY), INTENT(IN) :: GEOM
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM) :: NPROMA, NBLOCKS

    ALLOCATE(FIELD_PTR)
    NBLOCKS = GEOM%YRDIM%NGPBLKS
    NPROMA = GEOM%YRDIM%NPROMA
    FIELD_PTR = FIELD_2D(SHAPE=[NPROMA], NBLOCKS=NBLOCKS, PERSISTENT=PERSISTENT)
    ! Due to Fortran's reallocation-on-assignment behaviour, the
    ! FIELD_PTR%PTR pointer needs updating here for owned objects.
    IF (FIELD_PTR%OWNED) FIELD_PTR%PTR => FIELD_PTR%DATA
  END FUNCTION CREATE_TEMPORARY_2D

  FUNCTION CREATE_TEMPORARY_INT2D(GEOM, PERSISTENT) RESULT(FIELD_PTR)
    ! Create a single 2D field for temporary use with an implicit blocking dimension.
    TYPE(FIELD_INT2D), POINTER :: FIELD_PTR
    TYPE(GEOMETRY), INTENT(IN) :: GEOM
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM) :: NPROMA, NBLOCKS

    ALLOCATE(FIELD_PTR)
    NBLOCKS = GEOM%YRDIM%NGPBLKS
    NPROMA = GEOM%YRDIM%NPROMA
    FIELD_PTR = FIELD_INT2D(SHAPE=[NPROMA], NBLOCKS=NBLOCKS, PERSISTENT=PERSISTENT)
    ! Due to Fortran's reallocation-on-assignment behaviour, the
    ! FIELD_PTR%PTR pointer needs updating here for owned objects.
    IF (FIELD_PTR%OWNED) FIELD_PTR%PTR => FIELD_PTR%DATA
  END FUNCTION CREATE_TEMPORARY_INT2D

  FUNCTION CREATE_TEMPORARY_INT3D(GEOM, NLEV, PERSISTENT, NLEV0) RESULT(FIELD_PTR)
    ! Create a single 3D field for temporary use with an implicit blocking dimension.
    TYPE(FIELD_INT3D), POINTER :: FIELD_PTR
    TYPE(GEOMETRY), INTENT(IN) :: GEOM
    INTEGER(KIND=JPIM), INTENT(IN) :: NLEV
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: NLEV0
    INTEGER(KIND=JPIM) :: NPROMA, NBLOCKS
    INTEGER(KIND=JPIM) :: IBOUNDS(3)

    IBOUNDS = 1
    IF (PRESENT (NLEV0)) IBOUNDS (2) = NLEV0

    ALLOCATE(FIELD_PTR)
    NBLOCKS = GEOM%YRDIM%NGPBLKS
    NPROMA = GEOM%YRDIM%NPROMA
    FIELD_PTR = FIELD_INT3D(SHAPE=[NPROMA, NLEV], NBLOCKS=NBLOCKS, PERSISTENT=PERSISTENT, LBOUNDS=IBOUNDS)
    ! Due to Fortran's reallocation-on-assignment behaviour, the
    ! FIELD_PTR%PTR pointer needs updating here for owned objects.
    IF (FIELD_PTR%OWNED) FIELD_PTR%PTR => FIELD_PTR%DATA
  END FUNCTION CREATE_TEMPORARY_INT3D

  FUNCTION CREATE_TEMPORARY_LOG2D(GEOM, PERSISTENT) RESULT(FIELD_PTR)
    ! Create a single 2D field for temporary use with an implicit blocking dimension.
    TYPE(FIELD_LOG2D), POINTER :: FIELD_PTR
    TYPE(GEOMETRY), INTENT(IN) :: GEOM
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM) :: NPROMA, NBLOCKS

    ALLOCATE(FIELD_PTR)
    NBLOCKS = GEOM%YRDIM%NGPBLKS
    NPROMA = GEOM%YRDIM%NPROMA
    FIELD_PTR = FIELD_LOG2D(SHAPE=[NPROMA], NBLOCKS=NBLOCKS, PERSISTENT=PERSISTENT)
    ! Due to Fortran's reallocation-on-assignment behaviour, the
    ! FIELD_PTR%PTR pointer needs updating here for owned objects.
    IF (FIELD_PTR%OWNED) FIELD_PTR%PTR => FIELD_PTR%DATA
  END FUNCTION CREATE_TEMPORARY_LOG2D

  FUNCTION CREATE_TEMPORARY_3D(GEOM, NLEV, PERSISTENT, NLEV0) RESULT(FIELD_PTR)
    ! Create a single 3D field for temporary use with an implicit blocking dimension.
    TYPE(FIELD_3D), POINTER :: FIELD_PTR
    TYPE(GEOMETRY), INTENT(IN) :: GEOM
    INTEGER(KIND=JPIM), INTENT(IN) :: NLEV
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: NLEV0
    INTEGER(KIND=JPIM) :: NPROMA, NBLOCKS
    INTEGER(KIND=JPIM) :: IBOUNDS(3)

    IBOUNDS = 1
    IF (PRESENT (NLEV0)) IBOUNDS (2) = NLEV0

    ALLOCATE(FIELD_PTR)
    NBLOCKS = GEOM%YRDIM%NGPBLKS
    NPROMA = GEOM%YRDIM%NPROMA
    FIELD_PTR = FIELD_3D(SHAPE=[NPROMA, NLEV], NBLOCKS=NBLOCKS, PERSISTENT=PERSISTENT, LBOUNDS=IBOUNDS)
    ! Due to Fortran's reallocation-on-assignment behaviour, the
    ! FIELD_PTR%PTR pointer needs updating here for owned objects.
    IF (FIELD_PTR%OWNED) FIELD_PTR%PTR => FIELD_PTR%DATA
  END FUNCTION CREATE_TEMPORARY_3D

  FUNCTION CREATE_TEMPORARY_4D(GEOM, NLEV, NDIM, PERSISTENT, NLEV0, NDIM0) RESULT(FIELD_PTR)
    ! Create a single 4D field for temporary use with an implicit blocking dimension.
    TYPE(FIELD_4D), POINTER :: FIELD_PTR
    TYPE(GEOMETRY), INTENT(IN) :: GEOM
    INTEGER(KIND=JPIM), INTENT(IN) :: NLEV, NDIM
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: NLEV0, NDIM0
    INTEGER(KIND=JPIM) :: NPROMA, NBLOCKS
    INTEGER(KIND=JPIM) :: IBOUNDS(4)

    IBOUNDS = 1
    IF (PRESENT (NLEV0)) IBOUNDS (2) = NLEV0
    IF (PRESENT (NDIM0)) IBOUNDS (3) = NDIM0

    ALLOCATE(FIELD_PTR)
    NBLOCKS = GEOM%YRDIM%NGPBLKS
    NPROMA = GEOM%YRDIM%NPROMA
    FIELD_PTR = FIELD_4D(SHAPE=[NPROMA, NLEV, NDIM], NBLOCKS=NBLOCKS, PERSISTENT=PERSISTENT, LBOUNDS=IBOUNDS)
    ! Due to Fortran's reallocation-on-assignment behaviour, the
    ! FIELD_PTR%PTR pointer needs updating here for owned objects.
    IF (FIELD_PTR%OWNED) FIELD_PTR%PTR => FIELD_PTR%DATA
  END FUNCTION CREATE_TEMPORARY_4D

  FUNCTION CREATE_TEMPORARY_5D(GEOM, NLEV, NDIM, NDIM2, PERSISTENT, NLEV0, NDIM0, NDIM20) RESULT(FIELD_PTR)
    ! Create a single 4D field for temporary use with an implicit blocking dimension.
    TYPE(FIELD_5D), POINTER :: FIELD_PTR
    TYPE(GEOMETRY), INTENT(IN) :: GEOM
    INTEGER(KIND=JPIM), INTENT(IN) :: NLEV, NDIM, NDIM2
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: NLEV0, NDIM0, NDIM20
    INTEGER(KIND=JPIM) :: NPROMA, NBLOCKS
    INTEGER(KIND=JPIM) :: IBOUNDS(5)

    IBOUNDS = 1
    IF (PRESENT (NLEV0 )) IBOUNDS (2) = NLEV0
    IF (PRESENT (NDIM0 )) IBOUNDS (3) = NDIM0
    IF (PRESENT (NDIM20)) IBOUNDS (4) = NDIM20

    ALLOCATE(FIELD_PTR)
    NBLOCKS = GEOM%YRDIM%NGPBLKS
    NPROMA = GEOM%YRDIM%NPROMA
    FIELD_PTR = FIELD_5D(SHAPE=[NPROMA, NLEV, NDIM, NDIM2], NBLOCKS=NBLOCKS, PERSISTENT=PERSISTENT, LBOUNDS=IBOUNDS)
    ! Due to Fortran's reallocation-on-assignment behaviour, the
    ! FIELD_PTR%PTR pointer needs updating here for owned objects.
    IF (FIELD_PTR%OWNED) FIELD_PTR%PTR => FIELD_PTR%DATA
  END FUNCTION CREATE_TEMPORARY_5D

  SUBROUTINE DELETE_TEMPORARY_2D(FIELD_PTR)
    ! Finalize a temporary field and deallocate the pointer
    TYPE(FIELD_2D), POINTER, INTENT(INOUT) :: FIELD_PTR

    CALL FIELD_PTR%FINAL()
    DEALLOCATE(FIELD_PTR)
  END SUBROUTINE DELETE_TEMPORARY_2D

  SUBROUTINE DELETE_TEMPORARY_INT2D(FIELD_PTR)
    ! Finalize a temporary field and deallocate the pointer
    TYPE(FIELD_INT2D), POINTER, INTENT(INOUT) :: FIELD_PTR

    CALL FIELD_PTR%FINAL()
    DEALLOCATE(FIELD_PTR)
  END SUBROUTINE DELETE_TEMPORARY_INT2D

  SUBROUTINE DELETE_TEMPORARY_INT3D(FIELD_PTR)
    ! Finalize a temporary field and deallocate the pointer
    TYPE(FIELD_INT3D), POINTER, INTENT(INOUT) :: FIELD_PTR

    CALL FIELD_PTR%FINAL()
    DEALLOCATE(FIELD_PTR)
  END SUBROUTINE DELETE_TEMPORARY_INT3D

  SUBROUTINE DELETE_TEMPORARY_LOG2D(FIELD_PTR)
    ! Finalize a temporary field and deallocate the pointer
    TYPE(FIELD_LOG2D), POINTER, INTENT(INOUT) :: FIELD_PTR

    CALL FIELD_PTR%FINAL()
    DEALLOCATE(FIELD_PTR)
  END SUBROUTINE DELETE_TEMPORARY_LOG2D

  SUBROUTINE DELETE_TEMPORARY_3D(FIELD_PTR)
    ! Finalize a temporary field and deallocate the pointer
    TYPE(FIELD_3D), POINTER, INTENT(INOUT) :: FIELD_PTR

    CALL FIELD_PTR%FINAL()
    DEALLOCATE(FIELD_PTR)
  END SUBROUTINE DELETE_TEMPORARY_3D

  SUBROUTINE DELETE_TEMPORARY_4D(FIELD_PTR)
    ! Finalize a temporary field and deallocate the pointer
    TYPE(FIELD_4D), POINTER, INTENT(INOUT) :: FIELD_PTR

    CALL FIELD_PTR%FINAL()
    DEALLOCATE(FIELD_PTR)
  END SUBROUTINE DELETE_TEMPORARY_4D

  SUBROUTINE DELETE_TEMPORARY_5D(FIELD_PTR)
    ! Finalize a temporary field and deallocate the pointer
    TYPE(FIELD_5D), POINTER, INTENT(INOUT) :: FIELD_PTR

    CALL FIELD_PTR%FINAL()
    DEALLOCATE(FIELD_PTR)
  END SUBROUTINE DELETE_TEMPORARY_5D


  SUBROUTINE FIELD_REGISTRY_INIT(SELF, GEOM)
    ! Constructor for global field registry
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(GEOMETRY), TARGET, INTENT(IN) :: GEOM

    SELF%GEOM => GEOM
    SELF%NBLOCKS = GEOM%YRDIM%NGPBLKS
    SELF%NPROMA = GEOM%YRDIM%NPROMA
  END SUBROUTINE FIELD_REGISTRY_INIT

  SUBROUTINE FIELD_REGISTRY_FINAL(SELF)
    ! Finalize and tear down the global field registry
    CLASS(FIELD_REGISTRY) :: SELF
    INTEGER(KIND=JPIM) :: I

  END SUBROUTINE FIELD_REGISTRY_FINAL


  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_2D(SELF, NAME, DATA) RESULT(VARIABLE)
    ! Create the VARIABLE and FIELD metadata type and associate it with existing data.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_2D) :: VARIABLE
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:)

    VARIABLE = VARIABLE_2D(NAME, LACTIVE=.TRUE.)
    VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=DATA)
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_2D

  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_3D(SELF, NAME, DATA) RESULT(VARIABLE)
    ! Create the VARIABLE and FIELD metadata type and associate it with existing data.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_3D) :: VARIABLE
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:)

    VARIABLE = VARIABLE_3D(NAME, LACTIVE=.TRUE.)
    VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=DATA)
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_3D

  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_4D(SELF, NAME, DATA) RESULT(VARIABLE)
    ! Create the VARIABLE and FIELD metadata type and associate it with existing data.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_4D) :: VARIABLE
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:,:)

    VARIABLE = VARIABLE_4D(NAME, LACTIVE=.TRUE.)
    VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=DATA)
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_4D

  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_2D(SELF, NAME, DATA, IDX) RESULT(VARIABLE)
    ! Create the VARIABLE and FIELD metadata type and associate it with existing data.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_2D) :: VARIABLE
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:)
    INTEGER(KIND=JPIM), INTENT(IN) :: IDX

    VARIABLE = VARIABLE_2D(NAME, LACTIVE=.TRUE.)
    VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=DATA, IDX=IDX)
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_2D

  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_3D(SELF, NAME, DATA, IDX) RESULT(VARIABLE)
    ! Create the VARIABLE and FIELD metadata type and associate it with existing data.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_3D) :: VARIABLE
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:,:)
    INTEGER(KIND=JPIM), INTENT(IN) :: IDX

    VARIABLE = VARIABLE_3D(NAME, LACTIVE=.TRUE.)
    VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=DATA, IDX=IDX)
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_3D

  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_4D(SELF, NAME, DATA, IDX) RESULT(VARIABLE)
    ! Create the VARIABLE and FIELD metadata type and associate it with existing data.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_4D) :: VARIABLE
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: DATA(:,:,:,:,:)
    INTEGER(KIND=JPIM), INTENT(IN) :: IDX

    VARIABLE = VARIABLE_4D(NAME, LACTIVE=.TRUE.)
    VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=DATA, IDX=IDX)
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_WRAP_PACKED_4D

  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_2D_GMV(SELF, NAME, GMV, GMVT1, PT0, PT1, PT9, PPH9, PDL, PDM, &
   &                                             PDL9, PDM9, PERSISTENT) RESULT(VARIABLE)
    ! Create the VARIABLE metadata type and associate it with fields and data.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_2D) :: VARIABLE
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: GMV(:,:,:)
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: GMVT1(:,:,:)
    INTEGER(KIND=JPIM), INTENT(IN) :: PT0
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: PT1, PT9, PPH9, PDL, PDM, PDL9, PDM9
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    LOGICAL :: LT0, LT1, LT9, LPH9, LDL, LDM, LDL9, LDM9

    LT0 = PRESENT_AND_ACTIVE(PT0)
    LT1 = PRESENT_AND_ACTIVE(PT1)
    LT9 = PRESENT_AND_ACTIVE(PT9)
    LPH9 = PRESENT_AND_ACTIVE(PPH9)
    LDL = PRESENT_AND_ACTIVE(PDL)
    LDM = PRESENT_AND_ACTIVE(PDM)
    LDL9 = PRESENT_AND_ACTIVE(PDL9)
    LDM9 = PRESENT_AND_ACTIVE(PDM9)
    VARIABLE = VARIABLE_2D(NAME, LACTIVE=.TRUE., LADV=.TRUE., LT1=LT1, LT9=LT9, LPH9=LPH9, LDL=LDL, LDM=LDM, &
                         & LDL9=LDL9, LDM9=LDM9)

    ! Associate FIELD objects with VARIABLE according to provided pointers
    IF (LT0) THEN
      VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:), IDX=PT0)
    ELSE
      VARIABLE%FT0 => NULL ()
    ENDIF
    IF (LT1) THEN
      VARIABLE%FT1 => CREATE_FIELD_WRAP(DATA=GMVT1(:,:,:), IDX=PT1)
    ELSE
      VARIABLE%FT1 => NULL()
    END IF
    IF (LT9) THEN
      VARIABLE%FT9 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:), IDX=PT9)
    ELSE
      VARIABLE%FT9 => NULL()
    END IF
    IF (LPH9) THEN
      VARIABLE%FPH9 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:), IDX=PPH9)
    ELSE
      VARIABLE%FPH9 => NULL()
    END IF
    IF (LDL) THEN
      VARIABLE%FDL => CREATE_FIELD_WRAP(DATA=GMV(:,:,:), IDX=PDL)
    ELSE
      VARIABLE%FDL => NULL()
    END IF
    IF (LDM) THEN
      VARIABLE%FDM => CREATE_FIELD_WRAP(DATA=GMV(:,:,:), IDX=PDM)
    ELSE
      VARIABLE%FDM => NULL()
    END IF
    IF (LDL9) THEN
      VARIABLE%FDL9 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:), IDX=PDL9)
    ELSE
      VARIABLE%FDL9 => NULL()
    END IF
    IF (LDM9) THEN
      VARIABLE%FDM9 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:), IDX=PDM9)
    ELSE
      VARIABLE%FDM9 => NULL()
    END IF

  CONTAINS

    FUNCTION PRESENT_AND_ACTIVE(PTR)
      INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: PTR
      LOGICAL PRESENT_AND_ACTIVE
      IF (PRESENT(PTR)) THEN
        PRESENT_AND_ACTIVE = PTR >= 0
      ELSE
        PRESENT_AND_ACTIVE = .FALSE.
      END IF
    END FUNCTION PRESENT_AND_ACTIVE
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_2D_GMV

  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_3D_GMV(SELF, NAME, GMV, GMVT1, PT0, PT1, PT9, PPH9, PDL, PDM, &
   &                                             PDL9, PDM9, PERSISTENT) RESULT(VARIABLE)
    ! Create the VARIABLE metadata type and associate it with fields and data.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_3D) :: VARIABLE
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: GMV(:,:,:,:)
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: GMVT1(:,:,:,:)
    INTEGER(KIND=JPIM), INTENT(IN) :: PT0
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: PT1, PT9, PPH9, PDL, PDM, PDL9, PDM9
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    LOGICAL :: LT0, LT1, LT9, LPH9, LDL, LDM, LDL9, LDM9

    LT0 = PRESENT_AND_ACTIVE(PT0)
    LT1 = PRESENT_AND_ACTIVE(PT1)
    LT9 = PRESENT_AND_ACTIVE(PT9)
    LPH9 = PRESENT_AND_ACTIVE(PPH9)
    LDL = PRESENT_AND_ACTIVE(PDL)
    LDM = PRESENT_AND_ACTIVE(PDM)
    LDL9 = PRESENT_AND_ACTIVE(PDL9)
    LDM9 = PRESENT_AND_ACTIVE(PDM9)
    VARIABLE = VARIABLE_3D(NAME, LACTIVE=.TRUE., LADV=.TRUE., LT1=LT1, LT9=LT9, LPH9=LPH9, &
                         & LDL=LDL, LDM=LDM, LDL9=LDL9, LDM9=LDM9)

    ! Associate FIELD objects with VARIABLE according to provided pointers
    IF (LT0) THEN
      VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:,:), IDX=PT0)
    ELSE
      VARIABLE%FT0 => NULL ()
    ENDIF

    IF (LT1) THEN
      VARIABLE%FT1 => CREATE_FIELD_WRAP(DATA=GMVT1(:,:,:,:), IDX=PT1)
    ELSE
      VARIABLE%FT1 => NULL()
    END IF
    IF (LT9) THEN
      VARIABLE%FT9 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:,:), IDX=PT9)
    ELSE
      VARIABLE%FT9 => NULL()
    END IF
    IF (LPH9) THEN
      VARIABLE%FPH9 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:,:), IDX=PPH9)
    ELSE
      VARIABLE%FPH9 => NULL()
    END IF
    IF (LDL) THEN
      VARIABLE%FDL => CREATE_FIELD_WRAP(DATA=GMV(:,:,:,:), IDX=PDL)
    ELSE
      VARIABLE%FDL => NULL()
    END IF
    IF (LDM) THEN
      VARIABLE%FDM => CREATE_FIELD_WRAP(DATA=GMV(:,:,:,:), IDX=PDM)
    ELSE
      VARIABLE%FDM => NULL()
    END IF
    IF (LDL9) THEN
      VARIABLE%FDL9 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:,:), IDX=PDL9)
    ELSE
      VARIABLE%FDL9 => NULL()
    END IF
    IF (LDM9) THEN
      VARIABLE%FDM9 => CREATE_FIELD_WRAP(DATA=GMV(:,:,:,:), IDX=PDM9)
    ELSE
      VARIABLE%FDM9 => NULL()
    END IF

  CONTAINS

    FUNCTION PRESENT_AND_ACTIVE(PTR)
      INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN) :: PTR
      LOGICAL PRESENT_AND_ACTIVE
      IF (PRESENT(PTR)) THEN
        PRESENT_AND_ACTIVE = PTR >= 0
      ELSE
        PRESENT_AND_ACTIVE = .FALSE.
      END IF
    END FUNCTION PRESENT_AND_ACTIVE
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_3D_GMV

  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_GFL(SELF, NAME, YDCOMP, GFL, PERSISTENT) RESULT(VARIABLE)
    ! Create a single field from a set of defaults and internalized field options
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_3D) :: VARIABLE
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    TYPE(TYPE_GFL_COMP), INTENT(IN) :: YDCOMP
    TYPE(TGFL), TARGET, INTENT(INOUT) :: GFL
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT

    VARIABLE = VARIABLE_3D(NAME, CNAME=YDCOMP%CNAME, IGRBCODE=YDCOMP%IGRBCODE, LACTIVE=YDCOMP%LACTIVE, &
     &                     LADV=YDCOMP%LADV, LT1=YDCOMP%LT1, LT9=YDCOMP%LT9, LPH9=YDCOMP%LPHY, LWATER=YDCOMP%LWATER,&
     &                     RCP=YDCOMP%RCP)

    ! Associate FIELD objects with VARIABLE according to provided pointers
    IF (YDCOMP%LACTIVE .AND. YDCOMP%MP > 0) THEN
      VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=GFL%GFL(:,:,:,:), IDX=YDCOMP%MP)
    ELSE
      VARIABLE%FT0 => NULL()
    END IF
    IF (YDCOMP%LACTIVE .AND. YDCOMP%MP1 > 0) THEN
      VARIABLE%FT1 => CREATE_FIELD_WRAP(DATA=GFL%GFLT1(:,:,:,:), IDX=YDCOMP%MP1)
    ELSE
      VARIABLE%FT1 => NULL()
    END IF
    IF (YDCOMP%LACTIVE .AND. YDCOMP%MP9 > 0) THEN
      VARIABLE%FT9 => CREATE_FIELD_WRAP(DATA=GFL%GFL(:,:,:,:), IDX=YDCOMP%MP9)
    ELSE
      VARIABLE%FT9 => NULL()
    END IF
    IF (YDCOMP%LACTIVE .AND. YDCOMP%MP9_PH > 0) THEN
      VARIABLE%FPH9 => CREATE_FIELD_WRAP(DATA=GFL%GFL(:,:,:,:), IDX=YDCOMP%MP9_PH)
    ELSE
      VARIABLE%FPH9 => NULL()
    END IF
    IF (YDCOMP%LACTIVE .AND. YDCOMP%MPL > 0) THEN
      VARIABLE%FDL => CREATE_FIELD_WRAP(DATA=GFL%GFL(:,:,:,:), IDX=YDCOMP%MPL)
    ELSE
      VARIABLE%FDL => NULL()
    END IF
    IF (YDCOMP%LACTIVE .AND. YDCOMP%MPM > 0) THEN
      VARIABLE%FDM => CREATE_FIELD_WRAP(DATA=GFL%GFL(:,:,:,:), IDX=YDCOMP%MPM)
    ELSE
      VARIABLE%FDM => NULL()
    END IF

  CONTAINS

    FUNCTION ACTIVE_AND_TRUE(LFLAG)
      LOGICAL ACTIVE_AND_TRUE
      LOGICAL, INTENT(IN) :: LFLAG
      IF (YDCOMP%LACTIVE) THEN
        ACTIVE_AND_TRUE = LFLAG
      ELSE
        ACTIVE_AND_TRUE = .FALSE.
      END IF
    END FUNCTION ACTIVE_AND_TRUE
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_GFL

  FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_ARRAY_GFL(SELF, NAME, YDCOMP, GFL, PERSISTENT) RESULT(VARIABLES)
    ! Create a single field from a set of defaults and internalized field options
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(VARIABLE_3D), ALLOCATABLE :: VARIABLES(:)
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    TYPE(TYPE_GFL_COMP), POINTER, INTENT(IN) :: YDCOMP(:)
    TYPE(TGFL), TARGET, INTENT(INOUT) :: GFL
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM) :: I
    CHARACTER(:), ALLOCATABLE :: VNAME

    IF (ASSOCIATED(YDCOMP)) THEN
      ALLOCATE(VARIABLES(SIZE(YDCOMP)))
      DO I=1, SIZE(YDCOMP)
        VNAME = NAME//"_"//CHAR(I)
        VARIABLES(I) = SELF%CREATE_VARIABLE(VNAME, YDCOMP(I), GFL, PERSISTENT=PERSISTENT)
      END DO
    ELSE
      ALLOCATE(VARIABLES(0))
    END IF
  END FUNCTION FIELD_REGISTRY_CREATE_VARIABLE_ARRAY_GFL

  SUBROUTINE FIELD_REGISTRY_REGISTER_GEOMETRY(SELF, VARIABLES, GEOM)
    ! Utility routine to register geometry fields in the current field container
    !
    ! Note that this is not meant to stay forever. It is required for gradual
    ! migration of existing arrays to an Atlas-based memory management system.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(FIELD_VARIABLES), POINTER, INTENT(INOUT) :: VARIABLES
    TYPE(GEOMETRY), INTENT(IN) :: GEOM

    IF (.NOT. ASSOCIATED(VARIABLES)) ALLOCATE(VARIABLES)

    VARIABLES%GEOMETRY%RCORI  = SELF%CREATE_VARIABLE(NAME='RCORI', DATA=GEOM%YRGSGEOM_B%RCORI)
    VARIABLES%GEOMETRY%RCORIC = SELF%CREATE_VARIABLE(NAME='RCORIC', DATA=GEOM%YRGSGEOM_B%RCORIC)
    VARIABLES%GEOMETRY%GEMU   = SELF%CREATE_VARIABLE(NAME='GEMU', DATA=GEOM%YRGSGEOM_B%GEMU)
    VARIABLES%GEOMETRY%GSQM2  = SELF%CREATE_VARIABLE(NAME='GSQM2', DATA=GEOM%YRGSGEOM_B%GSQM2)
    VARIABLES%GEOMETRY%GELAM  = SELF%CREATE_VARIABLE(NAME='GELAM', DATA=GEOM%YRGSGEOM_B%GELAM)
    VARIABLES%GEOMETRY%GELAT  = SELF%CREATE_VARIABLE(NAME='GELAT', DATA=GEOM%YRGSGEOM_B%GELAT)
    VARIABLES%GEOMETRY%GECLO  = SELF%CREATE_VARIABLE(NAME='GECLO', DATA=GEOM%YRGSGEOM_B%GECLO)
    VARIABLES%GEOMETRY%GESLO  = SELF%CREATE_VARIABLE(NAME='GESLO', DATA=GEOM%YRGSGEOM_B%GESLO)
    VARIABLES%GEOMETRY%GM     = SELF%CREATE_VARIABLE(NAME='GM', DATA=GEOM%YRGSGEOM_B%GM)
    VARIABLES%GEOMETRY%GMAPPA = SELF%CREATE_VARIABLE(NAME='GMAPPA', DATA=GEOM%YRGSGEOM_B%GMAPPA)
    VARIABLES%GEOMETRY%GOMVRL = SELF%CREATE_VARIABLE(NAME='GOMVRL', DATA=GEOM%YRGSGEOM_B%GOMVRL)
    VARIABLES%GEOMETRY%GOMVRM = SELF%CREATE_VARIABLE(NAME='GOMVRM', DATA=GEOM%YRGSGEOM_B%GOMVRM)
    VARIABLES%GEOMETRY%GNORDL = SELF%CREATE_VARIABLE(NAME='GNORDL', DATA=GEOM%YRGSGEOM_B%GNORDL)
    VARIABLES%GEOMETRY%GNORDM = SELF%CREATE_VARIABLE(NAME='GNORDM', DATA=GEOM%YRGSGEOM_B%GNORDM)
    VARIABLES%GEOMETRY%GNORDLCL = SELF%CREATE_VARIABLE(NAME='GNORDLCL', DATA=GEOM%YRGSGEOM_B%GNORDLCL)
    VARIABLES%GEOMETRY%GNORDMCL = SELF%CREATE_VARIABLE(NAME='GNORDMCL', DATA=GEOM%YRGSGEOM_B%GNORDMCL)
    VARIABLES%GEOMETRY%GNORDMCM = SELF%CREATE_VARIABLE(NAME='GNORDMCM', DATA=GEOM%YRGSGEOM_B%GNORDMCM)
    VARIABLES%GEOMETRY%GAW   = SELF%CREATE_VARIABLE(NAME='GAW', DATA=GEOM%YRGSGEOM_B%GAW)
    ! INTEGER(KIND=JPIM), POINTER,CONTIGUOUS :: NGPLAT(:,:)    => NULL()
    ! INTEGER(KIND=JPIM), POINTER,CONTIGUOUS :: NUNIQUEGP(:,:) => NULL()

    VARIABLES%GEOMETRY%OROG  = SELF%CREATE_VARIABLE(NAME='OROG', DATA=GEOM%YROROG_B%OROG)
    VARIABLES%GEOMETRY%OROGL = SELF%CREATE_VARIABLE(NAME='OROGL', DATA=GEOM%YROROG_B%OROGL)
    VARIABLES%GEOMETRY%OROGM = SELF%CREATE_VARIABLE(NAME='OROGM', DATA=GEOM%YROROG_B%OROGM)

    VARIABLES%GEOMETRY%RCOLON = SELF%CREATE_VARIABLE (NAME='RCOLON', DATA=GEOM%YRCSGEOM_B%RCOLON)
    VARIABLES%GEOMETRY%RSILON = SELF%CREATE_VARIABLE (NAME='RSILON', DATA=GEOM%YRCSGEOM_B%RSILON)
    VARIABLES%GEOMETRY%RINDX  = SELF%CREATE_VARIABLE (NAME='RINDX' , DATA=GEOM%YRCSGEOM_B%RINDX )
    VARIABLES%GEOMETRY%RINDY  = SELF%CREATE_VARIABLE (NAME='RINDY' , DATA=GEOM%YRCSGEOM_B%RINDY )
    VARIABLES%GEOMETRY%RATATH = SELF%CREATE_VARIABLE (NAME='RATATH', DATA=GEOM%YRCSGEOM_B%RATATH)
    VARIABLES%GEOMETRY%RATATX = SELF%CREATE_VARIABLE (NAME='RATATX', DATA=GEOM%YRCSGEOM_B%RATATX)

  END SUBROUTINE FIELD_REGISTRY_REGISTER_GEOMETRY

  SUBROUTINE FIELD_REGISTRY_REGISTER_GMV_FIELDS(SELF, VARIABLES, GMV)
    ! Utility routine to register GMV fields with the global field registry
    !
    ! Note that this is not meant to stay forever. It is required for gradual
    ! migration of existing arrays to the new object-based data management system.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(FIELD_VARIABLES), POINTER, INTENT(INOUT) :: VARIABLES
    TYPE(TGMV), INTENT(INOUT) :: GMV  ! Allocated arrays and pointers

    IF (.NOT. ASSOCIATED(VARIABLES)) ALLOCATE(VARIABLES)

    ASSOCIATE(GMVT1=>GMV%GMVT1, GMVS=>GMV%GMVS, GMVT1S=>GMV%GMVT1S, &
     &        YT0=>GMV%YT0, YT1=>GMV%YT1, YT9=>GMV%YT9, YPH9=>GMV%YPH9)
    VARIABLES%U = SELF%CREATE_VARIABLE('U', GMV%GMV, GMVT1, PT0=YT0%MU, PT1=YT1%MU, PT9=YT9%MU, PPH9=YPH9%MU, PDL=YT0%MUL, PDL9=YT9%MUL)
    VARIABLES%V = SELF%CREATE_VARIABLE('V', GMV%GMV, GMVT1, PT0=YT0%MV, PT1=YT1%MV, PT9=YT9%MV, PPH9=YPH9%MV, PDL=YT0%MVL, PDL9=YT9%MVL)
    VARIABLES%T = SELF%CREATE_VARIABLE('T', GMV%GMV, GMVT1, PT0=YT0%MT, PT1=YT1%MT, PT9=YT9%MT, PPH9=YPH9%MT, &
     &                                 PDL=YT0%MTL, PDM=YT0%MTM, PDL9=YT9%MTL, PDM9=YT9%MTM)
    VARIABLES%DIV = SELF%CREATE_VARIABLE('DIV', GMV%GMV, GMVT1, PT0=YT0%MDIV, PT1=YT1%MDIV, PT9=YT9%MDIV)
    VARIABLES%VOR = SELF%CREATE_VARIABLE('VOR', GMV%GMV, GMVT1, PT0=YT0%MVOR, PT1=YT1%MVOR, PT9=YT9%MVOR)
    ! Field pointers in GMVS
    VARIABLES%SP  = SELF%CREATE_VARIABLE('SP', GMVS, GMVT1S, PT0=YT0%MSP, PT1=YT1%MSP, PT9=YT9%MSP, &
     &                                   PPH9=YPH9%MSP, PDL=YT0%MSPL, PDM=YT0%MSPM, PDL9=YT9%MSPL, PDM9=YT9%MSPM)
    VARIABLES%SPD = SELF%CREATE_VARIABLE('SPD', GMV%GMV, GMVT1, PT0=YT0%MSPD, PT1=YT1%MSPD, PT9=YT9%MSPD, &
     &                                   PDL=YT0%MSPDL, PDM=YT0%MSPDM, PDL9=YT9%MSPDL, PDM9=YT9%MSPDM)
    VARIABLES%SVD = SELF%CREATE_VARIABLE('SVD', GMV%GMV, GMVT1, PT0=YT0%MSVD, PT1=YT1%MSVD, PT9=YT9%MSVD, &
     &                                   PDL=YT0%MSVDL, PDM=YT0%MSVDM, PDL9=YT9%MSVDL, PDM9=YT9%MSVDM)
    VARIABLES%NHX = SELF%CREATE_VARIABLE('NHX', GMV%GMV, GMVT1, PT0=YT0%MNHX, PT1=YT1%MNHX, PT9=YT9%MNHX, &
     &                                   PDL=YT0%MNHXL, PDM=YT0%MNHXM)
    VARIABLES%EDOT = SELF%CREATE_VARIABLE('EDOT', GMV%GMV, GMVT1, PT0=YT0%MEDOT, PT9=YT9%MEDOT)
    VARIABLES%SGRTL = SELF%CREATE_VARIABLE('SGRTL', GMV%GMV, GMVT1, PT0=YT0%MSGRTL, PT9=YT9%MSGRTL)
    VARIABLES%SGRTM = SELF%CREATE_VARIABLE('SGRTM', GMV%GMV, GMVT1, PT0=YT0%MSGRTM, PT9=YT9%MSGRTM)
    END ASSOCIATE

  END SUBROUTINE FIELD_REGISTRY_REGISTER_GMV_FIELDS

  SUBROUTINE FIELD_REGISTRY_REGISTER_GFL_FIELDS(SELF, VARIABLES, GFL_ARRAY, GFL_META)
    ! Utility routine to register GFL fields with the global field registry
    !
    ! Note that this is not meant to stay forever. It is required for gradual
    ! migration of existing arrays to an Atlas-based memory management system.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(FIELD_VARIABLES), POINTER, INTENT(INOUT) :: VARIABLES
    TYPE(TGFL), INTENT(INOUT) :: GFL_ARRAY  ! Actual allcoated arrays
    TYPE(TYPE_GFLD), INTENT(INOUT) :: GFL_META   ! Array of component metadata

    IF (.NOT. ASSOCIATED(VARIABLES)) ALLOCATE(VARIABLES)
    VARIABLES%Q = SELF%CREATE_VARIABLE('Q', GFL_META%YQ, GFL_ARRAY)
    VARIABLES%I = SELF%CREATE_VARIABLE('I', GFL_META%YI, GFL_ARRAY)
    VARIABLES%L = SELF%CREATE_VARIABLE('L', GFL_META%YL, GFL_ARRAY)
    VARIABLES%LCONV = SELF%CREATE_VARIABLE('LCONV', GFL_META%YLCONV, GFL_ARRAY)
    VARIABLES%ICONV = SELF%CREATE_VARIABLE('ICONV', GFL_META%YICONV, GFL_ARRAY)
    VARIABLES%RCONV = SELF%CREATE_VARIABLE('RCONV', GFL_META%YRCONV, GFL_ARRAY)
    VARIABLES%SCONV = SELF%CREATE_VARIABLE('SCONV', GFL_META%YSCONV, GFL_ARRAY)
    VARIABLES%IRAD = SELF%CREATE_VARIABLE('IRAD', GFL_META%YIRAD, GFL_ARRAY)
    VARIABLES%LRAD = SELF%CREATE_VARIABLE('LRAD', GFL_META%YLRAD, GFL_ARRAY)
    VARIABLES%S = SELF%CREATE_VARIABLE('S', GFL_META%YS, GFL_ARRAY)
    VARIABLES%R = SELF%CREATE_VARIABLE('R', GFL_META%YR, GFL_ARRAY)
    VARIABLES%G = SELF%CREATE_VARIABLE('G', GFL_META%YG, GFL_ARRAY)
    VARIABLES%H = SELF%CREATE_VARIABLE('H', GFL_META%YH, GFL_ARRAY)
    VARIABLES%TKE = SELF%CREATE_VARIABLE('TKE', GFL_META%YTKE, GFL_ARRAY)
    VARIABLES%TTE = SELF%CREATE_VARIABLE('TTE', GFL_META%YTTE, GFL_ARRAY)
    VARIABLES%EFB1 = SELF%CREATE_VARIABLE('EFB1', GFL_META%YEFB1, GFL_ARRAY)
    VARIABLES%EFB2 = SELF%CREATE_VARIABLE('EFB2', GFL_META%YEFB2, GFL_ARRAY)
    VARIABLES%EFB3 = SELF%CREATE_VARIABLE('EFB3', GFL_META%YEFB3, GFL_ARRAY)
    VARIABLES%A = SELF%CREATE_VARIABLE('A', GFL_META%YA, GFL_ARRAY)
    VARIABLES%O3 = SELF%CREATE_VARIABLE('O3', GFL_META%YO3, GFL_ARRAY)
    VARIABLES%SRC = SELF%CREATE_VARIABLE('SRC', GFL_META%YSRC, GFL_ARRAY)
    VARIABLES%MXL = SELF%CREATE_VARIABLE('MXL', GFL_META%YMXL, GFL_ARRAY)
    VARIABLES%SHTUR = SELF%CREATE_VARIABLE('SHTUR', GFL_META%YSHTUR, GFL_ARRAY)
    VARIABLES%FQTUR = SELF%CREATE_VARIABLE('FQTUR', GFL_META%YFQTUR, GFL_ARRAY)
    VARIABLES%FSTUR = SELF%CREATE_VARIABLE('FSTUR', GFL_META%YFSTUR, GFL_ARRAY)
    VARIABLES%CPF = SELF%CREATE_VARIABLE('CPF', GFL_META%YCPF, GFL_ARRAY)
    VARIABLES%SPF = SELF%CREATE_VARIABLE('SPF', GFL_META%YSPF, GFL_ARRAY)
    VARIABLES%CVGQ = SELF%CREATE_VARIABLE('CVGQ', GFL_META%YCVGQ, GFL_ARRAY)
    VARIABLES%QVA = SELF%CREATE_VARIABLE('QVA', GFL_META%YQVA, GFL_ARRAY)
    VARIABLES%GHG_G = SELF%CREATE_VARIABLE('GHG', GFL_META%YGHG, GFL_ARRAY)
    VARIABLES%GHG => VARIABLES%GHG_G
    VARIABLES%CHEM_G = SELF%CREATE_VARIABLE('CHEM', GFL_META%YCHEM, GFL_ARRAY)
    VARIABLES%CHEM => VARIABLES%CHEM_G
    VARIABLES%AERO_G = SELF%CREATE_VARIABLE('AERO', GFL_META%YAERO, GFL_ARRAY)
    VARIABLES%AERO => VARIABLES%AERO_G
    VARIABLES%LRCH4 = SELF%CREATE_VARIABLE('LRCH4', GFL_META%YLRCH4, GFL_ARRAY)
    VARIABLES%FORC_G = SELF%CREATE_VARIABLE('FORC', GFL_META%YFORC, GFL_ARRAY)
    VARIABLES%FORC => VARIABLES%FORC_G
    VARIABLES%EZDIAG_G = SELF%CREATE_VARIABLE('EZDIAG', GFL_META%YEZDIAG, GFL_ARRAY)
    VARIABLES%EZDIAG => VARIABLES%EZDIAG_G
    VARIABLES%ERA40_G = SELF%CREATE_VARIABLE('ERA40', GFL_META%YERA40, GFL_ARRAY)
    VARIABLES%ERA40 => VARIABLES%ERA40_G
    VARIABLES%NOGW_G = SELF%CREATE_VARIABLE('NOGW', GFL_META%YNOGW, GFL_ARRAY)
    VARIABLES%NOGW => VARIABLES%NOGW_G
    VARIABLES%EDRP_G = SELF%CREATE_VARIABLE('EDRP', GFL_META%YEDRP, GFL_ARRAY)
    VARIABLES%EDRP => VARIABLES%EDRP_G
    VARIABLES%SLDIA_G = SELF%CREATE_VARIABLE('SLDIA', GFL_META%YSLDIA, GFL_ARRAY)
    VARIABLES%SLDIA => VARIABLES%SLDIA_G
    VARIABLES%AERAOT_G = SELF%CREATE_VARIABLE('AERAOT', GFL_META%YAERAOT, GFL_ARRAY)
    VARIABLES%AERAOT => VARIABLES%AERAOT_G
    VARIABLES%AERLISI_G = SELF%CREATE_VARIABLE('AERLISI', GFL_META%YAERLISI, GFL_ARRAY)
    VARIABLES%AERLISI => VARIABLES%AERLISI_G
    VARIABLES%AEROUT_G = SELF%CREATE_VARIABLE('AEROUT', GFL_META%YAEROUT, GFL_ARRAY)
    VARIABLES%AEROUT => VARIABLES%AEROUT_G
    VARIABLES%AEROCLIM_G = SELF%CREATE_VARIABLE('AEROCLIM', GFL_META%YAEROCLIM, GFL_ARRAY)
    VARIABLES%AEROCLIM => VARIABLES%AEROCLIM_G
    VARIABLES%UVP_G = SELF%CREATE_VARIABLE('UVP', GFL_META%YUVP, GFL_ARRAY)
    VARIABLES%UVP => VARIABLES%UVP_G
    VARIABLES%PHYS_G = SELF%CREATE_VARIABLE('PHYS', GFL_META%YPHYS, GFL_ARRAY)
    VARIABLES%PHYS => VARIABLES%PHYS_G
    VARIABLES%PHYCTY = SELF%CREATE_VARIABLE('PHYCTY', GFL_META%YPHYCTY, GFL_ARRAY)
    VARIABLES%RSPEC = SELF%CREATE_VARIABLE('RSPEC', GFL_META%YRSPEC, GFL_ARRAY)
    VARIABLES%SDSAT = SELF%CREATE_VARIABLE('SDSAT', GFL_META%YSDSAT, GFL_ARRAY)
    VARIABLES%CVV = SELF%CREATE_VARIABLE('CVV', GFL_META%YCVV, GFL_ARRAY)
    VARIABLES%RKTH = SELF%CREATE_VARIABLE('RKTH', GFL_META%YRKTH, GFL_ARRAY)
    VARIABLES%RKTQV = SELF%CREATE_VARIABLE('RKTQV', GFL_META%YRKTQV, GFL_ARRAY)
    VARIABLES%RKTQC = SELF%CREATE_VARIABLE('RKTQC', GFL_META%YRKTQC, GFL_ARRAY)
    VARIABLES%UOM = SELF%CREATE_VARIABLE('UOM', GFL_META%YUOM, GFL_ARRAY)
    VARIABLES%UAL = SELF%CREATE_VARIABLE('UAL', GFL_META%YUAL, GFL_ARRAY)
    VARIABLES%DOM = SELF%CREATE_VARIABLE('DOM', GFL_META%YDOM, GFL_ARRAY)
    VARIABLES%DAL = SELF%CREATE_VARIABLE('DAL', GFL_META%YDAL, GFL_ARRAY)
    VARIABLES%UEN = SELF%CREATE_VARIABLE('UEN', GFL_META%YUEN, GFL_ARRAY)
    VARIABLES%UNEBH = SELF%CREATE_VARIABLE('UNEBH', GFL_META%YUNEBH, GFL_ARRAY)
    VARIABLES%CRM_G = SELF%CREATE_VARIABLE('CRM', GFL_META%YCRM, GFL_ARRAY)
    VARIABLES%CRM => VARIABLES%CRM_G
    VARIABLES%LIMA_G = SELF%CREATE_VARIABLE('LIMA', GFL_META%YLIMA, GFL_ARRAY)
    VARIABLES%LIMA => VARIABLES%LIMA_G
    VARIABLES%FSD = SELF%CREATE_VARIABLE('FSD', GFL_META%YFSD, GFL_ARRAY)
    VARIABLES%EXT_G = SELF%CREATE_VARIABLE('EXT', GFL_META%YEXT, GFL_ARRAY)
    VARIABLES%EXT => VARIABLES%EXT_G
  END SUBROUTINE FIELD_REGISTRY_REGISTER_GFL_FIELDS

  SUBROUTINE FIELD_REGISTRY_REGISTER_EC_PHYS_FIELDS(SELF, VARIABLES, FIELDS)
    ! Utility routine to register EC physics fields in the current field container
    !
    ! Note that this is not meant to stay forever. It is required for gradual
    ! migration of existing arrays to an Atlas-based memory management system.
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(FIELD_VARIABLES), INTENT(INOUT) :: VARIABLES
    TYPE(TEC_PHYS_FIELDS), INTENT(INOUT) :: FIELDS

    VARIABLES%ECPHYS%USTRTI = SELF%CREATE_VARIABLE(NAME='USTRTI', DATA=FIELDS%YRTILEPROP%RUSTRTI) ! E-W  SURFACE STRESS
    VARIABLES%ECPHYS%VSTRTI = SELF%CREATE_VARIABLE(NAME='VSTRTI', DATA=FIELDS%YRTILEPROP%RVSTRTI) ! N-S  SURFACE STRESS
    VARIABLES%ECPHYS%AHFSTI = SELF%CREATE_VARIABLE(NAME='AHFSTI', DATA=FIELDS%YRTILEPROP%RAHFSTI) ! SURFACE SENSIBLE HEAT FLUX
    VARIABLES%ECPHYS%EVAPTI = SELF%CREATE_VARIABLE(NAME='EVAPTI', DATA=FIELDS%YRTILEPROP%REVAPTI) ! EVAPORATION
    VARIABLES%ECPHYS%TSKTI  = SELF%CREATE_VARIABLE(NAME='TSKTI',  DATA=FIELDS%YRTILEPROP%RTSKTI)  ! SKIN TEMPERATURE
  END SUBROUTINE FIELD_REGISTRY_REGISTER_EC_PHYS_FIELDS

  SUBROUTINE FIELD_REGISTRY_REGISTER_PHYSICS_RADIATION_FIELDS(SELF, VARIABLES, PHYS_RADI)
    ! Utility routine to register EC physics fields in the current field container
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(FIELD_VARIABLES), INTENT(INOUT) :: VARIABLES
    TYPE(MODEL_PHYSICS_RADIATION_TYPE), TARGET, INTENT(IN) :: PHYS_RADI

    VARIABLES%RADIATION%EMTD     = SELF%CREATE_VARIABLE(NAME='EMTD', DATA=PHYS_RADI%YRRADF%EMTD)
    VARIABLES%RADIATION%TRSW     = SELF%CREATE_VARIABLE(NAME='TRSW', DATA=PHYS_RADI%YRRADF%TRSW)
    VARIABLES%RADIATION%EMTC     = SELF%CREATE_VARIABLE(NAME='EMTC', DATA=PHYS_RADI%YRRADF%EMTC)
    VARIABLES%RADIATION%TRSC     = SELF%CREATE_VARIABLE(NAME='TRSC', DATA=PHYS_RADI%YRRADF%TRSC)
    VARIABLES%RADIATION%EMTU     = SELF%CREATE_VARIABLE(NAME='EMTU', DATA=PHYS_RADI%YRRADF%EMTU)
    VARIABLES%RADIATION%TAUAER   = SELF%CREATE_VARIABLE(NAME='TAUAER', DATA=PHYS_RADI%YRRADF%TAUAER)
    VARIABLES%RADIATION%SRSWD    = SELF%CREATE_VARIABLE(NAME='SRSWD', DATA=PHYS_RADI%YRRADF%SRSWD)
    VARIABLES%RADIATION%SRLWDC   = SELF%CREATE_VARIABLE(NAME='SRLWDC', DATA=PHYS_RADI%YRRADF%SRLWDC)
    VARIABLES%RADIATION%SRLWD    = SELF%CREATE_VARIABLE(NAME='SRLWD', DATA=PHYS_RADI%YRRADF%SRLWD)
    VARIABLES%RADIATION%SRSWDC   = SELF%CREATE_VARIABLE(NAME='SRSWDC', DATA=PHYS_RADI%YRRADF%SRSWDC)
    VARIABLES%RADIATION%SRSWDCS  = SELF%CREATE_VARIABLE(NAME='SRSWDCS', DATA=PHYS_RADI%YRRADF%SRSWDCS)
    VARIABLES%RADIATION%SRLWDCS  = SELF%CREATE_VARIABLE(NAME='SRLWDCS', DATA=PHYS_RADI%YRRADF%SRLWDCS)
    VARIABLES%RADIATION%SRSWDV   = SELF%CREATE_VARIABLE(NAME='SRSWDV', DATA=PHYS_RADI%YRRADF%SRSWDV)
    VARIABLES%RADIATION%SRSWDUV  = SELF%CREATE_VARIABLE(NAME='SRSWDUV', DATA=PHYS_RADI%YRRADF%SRSWDUV)
    VARIABLES%RADIATION%EDRO     = SELF%CREATE_VARIABLE(NAME='EDRO', DATA=PHYS_RADI%YRRADF%EDRO)
    VARIABLES%RADIATION%SRSWPAR  = SELF%CREATE_VARIABLE(NAME='SRSWPAR', DATA=PHYS_RADI%YRRADF%SRSWPAR)
    VARIABLES%RADIATION%SRSWUVB  = SELF%CREATE_VARIABLE(NAME='SRSWUVB', DATA=PHYS_RADI%YRRADF%SRSWUVB)
    VARIABLES%RADIATION%SRSWPARC = SELF%CREATE_VARIABLE(NAME='SRSWPARC', DATA=PHYS_RADI%YRRADF%SRSWPARC)
    VARIABLES%RADIATION%SRSWTINC = SELF%CREATE_VARIABLE(NAME='SRSWTINC', DATA=PHYS_RADI%YRRADF%SRSWTINC)
    VARIABLES%RADIATION%SRFDIR   = SELF%CREATE_VARIABLE(NAME='SRFDIR', DATA=PHYS_RADI%YRRADF%SRFDIR)
    VARIABLES%RADIATION%SRCDIR   = SELF%CREATE_VARIABLE(NAME='SRCDIR', DATA=PHYS_RADI%YRRADF%SRCDIR)
    VARIABLES%RADIATION%RMOON    = SELF%CREATE_VARIABLE(NAME='RMOON', DATA=PHYS_RADI%YRRADF%RMOON)
    VARIABLES%RADIATION%DERIVATIVELW = SELF%CREATE_VARIABLE(NAME='DERIVATIVELW', DATA=PHYS_RADI%YRRADF%DERIVATIVELW)
  END SUBROUTINE FIELD_REGISTRY_REGISTER_PHYSICS_RADIATION_FIELDS


  !----   Utility wrapper routines for surface variables   ----!

  SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_2D(SELF, NAME, VARIABLE, ARRAY, META, DESCR, ACTIVE, PERSISTENT)
    ! Create a single field from a set of defaults and internalized field options
    CLASS(FIELD_REGISTRY) :: SELF
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    TYPE(VARIABLE_2D), INTENT(INOUT) :: VARIABLE
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: ARRAY(:,:,:)
    TYPE(TYPE_SURF_MTL_2D), INTENT(IN) :: META
    TYPE(TYPE_SURF_GEN), INTENT(IN) :: DESCR
    LOGICAL, INTENT(IN) :: ACTIVE
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT

    IF (.NOT. ACTIVE) THEN
      ! For inactive variables we still create full-sized temporaries,
      ! since the SURF module expects full NPROMA-sized buffers.
      VARIABLE = VARIABLE_2D(NAME, LACTIVE=.FALSE., LT1=.FALSE., LT9=.FALSE.)
      VARIABLE%FT0 => CREATE_TEMPORARY(GEOM=SELF%GEOM, PERSISTENT=PERSISTENT)
      VARIABLE%FT1 => CREATE_TEMPORARY(GEOM=SELF%GEOM, PERSISTENT=PERSISTENT)
      VARIABLE%FT9 => CREATE_TEMPORARY(GEOM=SELF%GEOM, PERSISTENT=PERSISTENT)
    ELSE
      ! Create variable according to existing meta-data
      VARIABLE = VARIABLE_2D(NAME, LACTIVE=META%MP > 0, LT1=META%MP1 > 0, LT9=META%MP9 > 0)

      IF (META%MP > 0) THEN
        VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=ARRAY(:,:,:), IDX=META%MP)
      ELSE
        VARIABLE%FT0 => CREATE_TEMPORARY(GEOM=SELF%GEOM, PERSISTENT=PERSISTENT)
      END IF
      IF (META%MP1 > 0) THEN
        VARIABLE%FT1 => CREATE_FIELD_WRAP(DATA=ARRAY(:,:,:), IDX=META%MP1)
      ELSE
        VARIABLE%FT1 => CREATE_TEMPORARY(GEOM=SELF%GEOM, PERSISTENT=PERSISTENT)
      END IF
      IF (META%MP9 > 0) THEN
        VARIABLE%FT9 => CREATE_FIELD_WRAP(DATA=ARRAY(:,:,:), IDX=META%MP9)
      ELSE
        VARIABLE%FT9 => CREATE_TEMPORARY(GEOM=SELF%GEOM, PERSISTENT=PERSISTENT)
      END IF
    END IF

  END SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_2D

  SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY_2D(SELF, NAME, VARIABLES, ARRAY, META, DESCR, ACTIVE, PERSISTENT)
    ! Create an array of fields from a set of defaults and internalized field options
    CLASS(FIELD_REGISTRY) :: SELF
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    TYPE(VARIABLE_2D), ALLOCATABLE, INTENT(INOUT) :: VARIABLES(:)
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: ARRAY(:,:,:)
    TYPE(TYPE_SURF_MTL_2D), INTENT(IN) :: META(:)
    TYPE(TYPE_SURF_GEN), INTENT(IN) :: DESCR
    LOGICAL, INTENT(IN) :: ACTIVE
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM) :: I
    CHARACTER(:), ALLOCATABLE :: VNAME

    ALLOCATE(VARIABLES(SIZE(META)))
    DO I=1, SIZE(META)
      VNAME = NAME//"_"//CHAR(I)
      CALL SELF%CREATE_SURFACE_VARIABLE_2D(VNAME, VARIABLES(I), ARRAY, META(I), DESCR, ACTIVE, PERSISTENT)
    END DO
  END SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY_2D

  SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY2_2D(SELF, NAME, VARIABLES, ARRAY, META, DESCR, ACTIVE, PERSISTENT)
    ! Create an array of fields from a set of defaults and internalized field options
    CLASS(FIELD_REGISTRY) :: SELF
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    TYPE(VARIABLE_2D), ALLOCATABLE, INTENT(INOUT) :: VARIABLES(:,:)
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: ARRAY(:,:,:)
    TYPE(TYPE_SURF_MTL_2D), INTENT(IN) :: META(:,:)
    TYPE(TYPE_SURF_GEN), INTENT(IN) :: DESCR
    LOGICAL, INTENT(IN) :: ACTIVE
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM) :: I, J
    CHARACTER(:), ALLOCATABLE :: VNAME

    ALLOCATE(VARIABLES(SIZE(META, DIM=1), SIZE(META, DIM=2)))
    DO J=1, SIZE(META, DIM=2)
      DO I=1, SIZE(META, DIM=1)
        VNAME = NAME//"_"//CHAR(I)//"_"//CHAR(J)
        CALL SELF%CREATE_SURFACE_VARIABLE_2D(VNAME, VARIABLES(I,J), ARRAY, META(I,J), DESCR, ACTIVE, PERSISTENT)
      END DO
    END DO
  END SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY2_2D

  SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_3D(SELF, NAME, VARIABLE, ARRAY, META, DESCR, ACTIVE, PERSISTENT)
    ! Create a single field from a set of defaults and internalized field options
    CLASS(FIELD_REGISTRY) :: SELF
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    TYPE(VARIABLE_3D), INTENT(INOUT) :: VARIABLE
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: ARRAY(:,:,:,:)
    TYPE(TYPE_SURF_MTL_3D), INTENT(IN) :: META
    TYPE(TYPE_SURF_GEN), INTENT(IN) :: DESCR
    LOGICAL, INTENT(IN) :: ACTIVE
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT

    IF (.NOT. ACTIVE) THEN
      ! For inactive variables we still create full-sized temporaries,
      ! since the SURF module expects full NPROMA-sized buffers.
      VARIABLE = VARIABLE_3D(NAME, LACTIVE=.FALSE., LT1=.FALSE., LT9=.FALSE.)
      VARIABLE%FT0 => CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=DESCR%NLEVS, PERSISTENT=PERSISTENT)
      VARIABLE%FT1 => CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=DESCR%NLEVS, PERSISTENT=PERSISTENT)
      VARIABLE%FT9 => CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=DESCR%NLEVS, PERSISTENT=PERSISTENT)
    ELSE
      ! Create variable according to existing meta-data
      VARIABLE = VARIABLE_3D(NAME, LACTIVE=META%MP > 0, LT1=META%MP1 > 0, LT9=META%MP9 > 0)

      IF (META%MP > 0) THEN
        VARIABLE%FT0 => CREATE_FIELD_WRAP(DATA=ARRAY(:,:,:,:), IDX=META%MP)
      ELSE
        VARIABLE%FT0 => CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=DESCR%NLEVS, PERSISTENT=PERSISTENT)
      END IF
      IF (META%MP1 > 0) THEN
        VARIABLE%FT1 => CREATE_FIELD_WRAP(DATA=ARRAY(:,:,:,:), IDX=META%MP1)
      ELSE
        VARIABLE%FT1 => CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=DESCR%NLEVS, PERSISTENT=PERSISTENT)
      END IF
      IF (META%MP9 > 0) THEN
        VARIABLE%FT9 => CREATE_FIELD_WRAP(DATA=ARRAY(:,:,:,:), IDX=META%MP9)
      ELSE
        VARIABLE%FT9 => CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=DESCR%NLEVS, PERSISTENT=PERSISTENT)
      END IF
    END IF

  END SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_3D

  SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY_3D(SELF, NAME, VARIABLES, ARRAY, META, DESCR, ACTIVE, PERSISTENT)
    ! Create an array of fields from a set of defaults and internalized field options
    CLASS(FIELD_REGISTRY) :: SELF
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    TYPE(VARIABLE_3D), ALLOCATABLE, INTENT(INOUT) :: VARIABLES(:)
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: ARRAY(:,:,:,:)
    TYPE(TYPE_SURF_MTL_3D), INTENT(IN) :: META(:)
    TYPE(TYPE_SURF_GEN), INTENT(IN) :: DESCR
    LOGICAL, INTENT(IN) :: ACTIVE
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM) :: I
    CHARACTER(:), ALLOCATABLE :: VNAME

    ALLOCATE(VARIABLES(SIZE(META)))
    DO I=1, SIZE(META)
      VNAME = NAME//"_"//CHAR(I)
      CALL SELF%CREATE_SURFACE_VARIABLE_3D(VNAME, VARIABLES(I), ARRAY, META(I), DESCR, ACTIVE, PERSISTENT)
    END DO
  END SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY_3D

  SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY2_3D(SELF, NAME, VARIABLES, ARRAY, META, DESCR, ACTIVE, PERSISTENT)
    ! Create an array of fields from a set of defaults and internalized field options
    CLASS(FIELD_REGISTRY) :: SELF
    CHARACTER(LEN=*), INTENT(IN) :: NAME
    TYPE(VARIABLE_3D), ALLOCATABLE, INTENT(INOUT) :: VARIABLES(:,:)
    REAL(KIND=JPRB), TARGET, INTENT(IN) :: ARRAY(:,:,:,:)
    TYPE(TYPE_SURF_MTL_3D), INTENT(IN) :: META(:,:)
    TYPE(TYPE_SURF_GEN), INTENT(IN) :: DESCR
    LOGICAL, INTENT(IN) :: ACTIVE
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT
    INTEGER(KIND=JPIM) :: I, J
    CHARACTER(:), ALLOCATABLE :: VNAME

    ALLOCATE(VARIABLES(SIZE(META, DIM=1), SIZE(META, DIM=2)))
    DO J=1, SIZE(META, DIM=2)
      DO I=1, SIZE(META, DIM=1)
        VNAME = NAME//"_"//CHAR(I)//"_"//CHAR(J)
        CALL SELF%CREATE_SURFACE_VARIABLE_3D(VNAME, VARIABLES(I,J), ARRAY, META(I,J), DESCR, ACTIVE, PERSISTENT)
      END DO
    END DO
  END SUBROUTINE FIELD_REGISTRY_CREATE_SURFACE_VARIABLE_ARRAY2_3D

  SUBROUTINE FIELD_REGISTRY_REGISTER_SURFACE_FIELDS(SELF, SURFVARS, YDSURF, PERSISTENT)
    ! Register all surface variables detailed in the configuration file
    CLASS(FIELD_REGISTRY) :: SELF
    TYPE(SURFACE_VARIABLES), POINTER, INTENT(INOUT) :: SURFVARS
    TYPE(TSURF), TARGET, INTENT(INOUT) :: YDSURF
    LOGICAL, OPTIONAL, INTENT(IN) :: PERSISTENT

    IF (.NOT. ASSOCIATED(SURFVARS)) ALLOCATE(SURFVARS)

    ASSOCIATE(SP_SB=>YDSURF%SP_SB, YSP_SB=>YDSURF%YSP_SB, YSP_SBD=>YDSURF%YSP_SBD)
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_SB_T', &
     & VARIABLE=SURFVARS%GSP_SB%VT, ARRAY=SP_SB, &
     & META=YSP_SB%YT, DESCR=YSP_SBD, &
     & ACTIVE=ASSOCIATED(YSP_SB%YT))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_SB_Q', &
     & VARIABLE=SURFVARS%GSP_SB%VQ, ARRAY=SP_SB, &
     & META=YSP_SB%YQ, DESCR=YSP_SBD, &
     & ACTIVE=ASSOCIATED(YSP_SB%YQ))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_SB_TL', &
     & VARIABLE=SURFVARS%GSP_SB%VTL, ARRAY=SP_SB, &
     & META=YSP_SB%YTL, DESCR=YSP_SBD, &
     & ACTIVE=ASSOCIATED(YSP_SB%YTL))

    IF (YSP_SBD%NDIM == 0) THEN
      SURFVARS%GSP_SB%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSP_SBD%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSP_SB%F_GROUP = FIELD_4D(DATA=SP_SB)
    END IF
    END ASSOCIATE

    ASSOCIATE(SP_SG=>YDSURF%SP_SG, YSP_SG=>YDSURF%YSP_SG, YSP_SGD=>YDSURF%YSP_SGD)
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_SG_F', &
     & VARIABLE=SURFVARS%GSP_SG%VF, ARRAY=SP_SG, &
     & META=YSP_SG%YF, DESCR=YSP_SGD, &
     & ACTIVE=ASSOCIATED(YSP_SG%YF))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_SG_A', &
     & VARIABLE=SURFVARS%GSP_SG%VA, ARRAY=SP_SG, &
     & META=YSP_SG%YA, DESCR=YSP_SGD, &
     & ACTIVE=ASSOCIATED(YSP_SG%YA))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_SG_R', &
     & VARIABLE=SURFVARS%GSP_SG%VR, ARRAY=SP_SG, &
     & META=YSP_SG%YR, DESCR=YSP_SGD, &
     & ACTIVE=ASSOCIATED(YSP_SG%YR))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_SG_T', &
     & VARIABLE=SURFVARS%GSP_SG%VT, ARRAY=SP_SG, &
     & META=YSP_SG%YT, DESCR=YSP_SGD, &
     & ACTIVE=ASSOCIATED(YSP_SG%YT))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_SG_W', &
     & VARIABLE=SURFVARS%GSP_SG%VW, ARRAY=SP_SG, &
     & META=YSP_SG%YW, DESCR=YSP_SGD, &
     & ACTIVE=ASSOCIATED(YSP_SG%YW))

    IF (YSP_SGD%NDIM == 0) THEN
      SURFVARS%GSP_SG%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSP_SGD%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSP_SG%F_GROUP = FIELD_4D(DATA=SP_SG)
    END IF
    END ASSOCIATE

    ASSOCIATE(SP_SL=>YDSURF%SP_SL, YSP_SL=>YDSURF%YSP_SL, YSP_SLD=>YDSURF%YSP_SLD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_SL_LICT', &
     & VARIABLE=SURFVARS%GSP_SL%VLICT, ARRAY=SP_SL, &
     & META=YSP_SL%YLICT, DESCR=YSP_SLD, &
     & ACTIVE=ASSOCIATED(YSP_SL%YLICT))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_SL_LMLT', &
     & VARIABLE=SURFVARS%GSP_SL%VLMLT, ARRAY=SP_SL, &
     & META=YSP_SL%YLMLT, DESCR=YSP_SLD, &
     & ACTIVE=ASSOCIATED(YSP_SL%YLMLT))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_SL_LTLT', &
     & VARIABLE=SURFVARS%GSP_SL%VLTLT, ARRAY=SP_SL, &
     & META=YSP_SL%YLTLT, DESCR=YSP_SLD, &
     & ACTIVE=ASSOCIATED(YSP_SL%YLTLT))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_SL_LBLT', &
     & VARIABLE=SURFVARS%GSP_SL%VLBLT, ARRAY=SP_SL, &
     & META=YSP_SL%YLBLT, DESCR=YSP_SLD, &
     & ACTIVE=ASSOCIATED(YSP_SL%YLBLT))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_SL_LSHF', &
     & VARIABLE=SURFVARS%GSP_SL%VLSHF, ARRAY=SP_SL, &
     & META=YSP_SL%YLSHF, DESCR=YSP_SLD, &
     & ACTIVE=ASSOCIATED(YSP_SL%YLSHF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_SL_LICD', &
     & VARIABLE=SURFVARS%GSP_SL%VLICD, ARRAY=SP_SL, &
     & META=YSP_SL%YLICD, DESCR=YSP_SLD, &
     & ACTIVE=ASSOCIATED(YSP_SL%YLICD))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_SL_LMLD', &
     & VARIABLE=SURFVARS%GSP_SL%VLMLD, ARRAY=SP_SL, &
     & META=YSP_SL%YLMLD, DESCR=YSP_SLD, &
     & ACTIVE=ASSOCIATED(YSP_SL%YLMLD))

    IF (YSP_SLD%NDIM == 0) THEN
      SURFVARS%GSP_SL%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSP_SL%F_GROUP = FIELD_3D(DATA=SP_SL)
    END IF
    END ASSOCIATE

    ASSOCIATE(SP_RR=>YDSURF%SP_RR, YSP_RR=>YDSURF%YSP_RR, YSP_RRD=>YDSURF%YSP_RRD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_RR_T', &
     & VARIABLE=SURFVARS%GSP_RR%VT, ARRAY=SP_RR, &
     & META=YSP_RR%YT, DESCR=YSP_RRD, &
     & ACTIVE=ASSOCIATED(YSP_RR%YT))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_RR_W', &
     & VARIABLE=SURFVARS%GSP_RR%VW, ARRAY=SP_RR, &
     & META=YSP_RR%YW, DESCR=YSP_RRD, &
     & ACTIVE=ASSOCIATED(YSP_RR%YW))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_RR_FC', &
     & VARIABLE=SURFVARS%GSP_RR%VFC, ARRAY=SP_RR, &
     & META=YSP_RR%YFC, DESCR=YSP_RRD, &
     & ACTIVE=ASSOCIATED(YSP_RR%YFC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_RR_IC', &
     & VARIABLE=SURFVARS%GSP_RR%VIC, ARRAY=SP_RR, &
     & META=YSP_RR%YIC, DESCR=YSP_RRD, &
     & ACTIVE=ASSOCIATED(YSP_RR%YIC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_RR_FP1', &
     & VARIABLE=SURFVARS%GSP_RR%VFP1, ARRAY=SP_RR, &
     & META=YSP_RR%YFP1, DESCR=YSP_RRD, &
     & ACTIVE=ASSOCIATED(YSP_RR%YFP1))

    IF (YSP_RRD%NDIM == 0) THEN
      SURFVARS%GSP_RR%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSP_RR%F_GROUP = FIELD_3D(DATA=SP_RR)
    END IF
    END ASSOCIATE

    ASSOCIATE(SP_CL=>YDSURF%SP_CL, YSP_CL=>YDSURF%YSP_CL, YSP_CLD=>YDSURF%YSP_CLD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_CL_TCLS', &
     & VARIABLE=SURFVARS%GSP_CL%VTCLS, ARRAY=SP_CL, &
     & META=YSP_CL%YTCLS, DESCR=YSP_CLD, &
     & ACTIVE=ASSOCIATED(YSP_CL%YTCLS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_CL_HUCLS', &
     & VARIABLE=SURFVARS%GSP_CL%VHUCLS, ARRAY=SP_CL, &
     & META=YSP_CL%YHUCLS, DESCR=YSP_CLD, &
     & ACTIVE=ASSOCIATED(YSP_CL%YHUCLS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_CL_UCLS', &
     & VARIABLE=SURFVARS%GSP_CL%VUCLS, ARRAY=SP_CL, &
     & META=YSP_CL%YUCLS, DESCR=YSP_CLD, &
     & ACTIVE=ASSOCIATED(YSP_CL%YUCLS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_CL_VCLS', &
     & VARIABLE=SURFVARS%GSP_CL%VVCLS, ARRAY=SP_CL, &
     & META=YSP_CL%YVCLS, DESCR=YSP_CLD, &
     & ACTIVE=ASSOCIATED(YSP_CL%YVCLS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_CL_NUCLS', &
     & VARIABLE=SURFVARS%GSP_CL%VNUCLS, ARRAY=SP_CL, &
     & META=YSP_CL%YNUCLS, DESCR=YSP_CLD, &
     & ACTIVE=ASSOCIATED(YSP_CL%YNUCLS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SP_CL_NVCLS', &
     & VARIABLE=SURFVARS%GSP_CL%VNVCLS, ARRAY=SP_CL, &
     & META=YSP_CL%YNVCLS, DESCR=YSP_CLD, &
     & ACTIVE=ASSOCIATED(YSP_CL%YNVCLS))

    IF (YSP_CLD%NDIM == 0) THEN
      SURFVARS%GSP_CL%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSP_CL%F_GROUP = FIELD_3D(DATA=SP_CL)
    END IF
    END ASSOCIATE

    ASSOCIATE(SP_OM=>YDSURF%SP_OM, YSP_OM=>YDSURF%YSP_OM, YSP_OMD=>YDSURF%YSP_OMD)
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_OM_TO', &
     & VARIABLE=SURFVARS%GSP_OM%VTO, ARRAY=SP_OM, &
     & META=YSP_OM%YTO, DESCR=YSP_OMD, &
     & ACTIVE=ASSOCIATED(YSP_OM%YTO))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_OM_SO', &
     & VARIABLE=SURFVARS%GSP_OM%VSO, ARRAY=SP_OM, &
     & META=YSP_OM%YSO, DESCR=YSP_OMD, &
     & ACTIVE=ASSOCIATED(YSP_OM%YSO))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_OM_UO', &
     & VARIABLE=SURFVARS%GSP_OM%VUO, ARRAY=SP_OM, &
     & META=YSP_OM%YUO, DESCR=YSP_OMD, &
     & ACTIVE=ASSOCIATED(YSP_OM%YUO))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SP_OM_VO', &
     & VARIABLE=SURFVARS%GSP_OM%VVO, ARRAY=SP_OM, &
     & META=YSP_OM%YVO, DESCR=YSP_OMD, &
     & ACTIVE=ASSOCIATED(YSP_OM%YVO))

    IF (YSP_OMD%NDIM == 0) THEN
      SURFVARS%GSP_OM%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSP_OMD%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSP_OM%F_GROUP = FIELD_4D(DATA=SP_OM)
    END IF
    END ASSOCIATE

    ASSOCIATE(SP_EP=>YDSURF%SP_EP, YSP_EP=>YDSURF%YSP_EP, YSP_EPD=>YDSURF%YSP_EPD)

    IF (YSP_EPD%NDIM == 0) THEN
      SURFVARS%GSP_EP%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSP_EPD%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSP_EP%F_GROUP = FIELD_4D(DATA=SP_EP)
    END IF
    END ASSOCIATE

    ASSOCIATE(SP_X2=>YDSURF%SP_X2, YSP_X2=>YDSURF%YSP_X2, YSP_X2D=>YDSURF%YSP_X2D)

    IF (YSP_X2D%NDIM == 0) THEN
      SURFVARS%GSP_X2%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSP_X2%F_GROUP = FIELD_3D(DATA=SP_X2)
    END IF
    END ASSOCIATE

    ASSOCIATE(SP_CI=>YDSURF%SP_CI, YSP_CI=>YDSURF%YSP_CI, YSP_CID=>YDSURF%YSP_CID)

    IF (YSP_CID%NDIM == 0) THEN
      SURFVARS%GSP_CI%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSP_CI%F_GROUP = FIELD_3D(DATA=SP_CI)
    END IF
    END ASSOCIATE


    ASSOCIATE(SD_VF=>YDSURF%SD_VF, YSD_VF=>YDSURF%YSD_VF, YSD_VFD=>YDSURF%YSD_VFD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_Z0F', &
     & VARIABLE=SURFVARS%GSD_VF%VZ0F, ARRAY=SD_VF, &
     & META=YSD_VF%YZ0F, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YZ0F))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_ALBF', &
     & VARIABLE=SURFVARS%GSD_VF%VALBF, ARRAY=SD_VF, &
     & META=YSD_VF%YALBF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YALBF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_EMISF', &
     & VARIABLE=SURFVARS%GSD_VF%VEMISF, ARRAY=SD_VF, &
     & META=YSD_VF%YEMISF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YEMISF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_GETRL', &
     & VARIABLE=SURFVARS%GSD_VF%VGETRL, ARRAY=SD_VF, &
     & META=YSD_VF%YGETRL, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YGETRL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_LSM', &
     & VARIABLE=SURFVARS%GSD_VF%VLSM, ARRAY=SD_VF, &
     & META=YSD_VF%YLSM, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YLSM))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_VEG', &
     & VARIABLE=SURFVARS%GSD_VF%VVEG, ARRAY=SD_VF, &
     & META=YSD_VF%YVEG, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YVEG))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_VRLAN', &
     & VARIABLE=SURFVARS%GSD_VF%VVRLAN, ARRAY=SD_VF, &
     & META=YSD_VF%YVRLAN, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YVRLAN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_VRLDI', &
     & VARIABLE=SURFVARS%GSD_VF%VVRLDI, ARRAY=SD_VF, &
     & META=YSD_VF%YVRLDI, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YVRLDI))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SIG', &
     & VARIABLE=SURFVARS%GSD_VF%VSIG, ARRAY=SD_VF, &
     & META=YSD_VF%YSIG, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSIG))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_ALBSF', &
     & VARIABLE=SURFVARS%GSD_VF%VALBSF, ARRAY=SD_VF, &
     & META=YSD_VF%YALBSF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YALBSF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_LAN', &
     & VARIABLE=SURFVARS%GSD_VF%VLAN, ARRAY=SD_VF, &
     & META=YSD_VF%YLAN, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YLAN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SST', &
     & VARIABLE=SURFVARS%GSD_VF%VSST, ARRAY=SD_VF, &
     & META=YSD_VF%YSST, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSST))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SSS', &
     & VARIABLE=SURFVARS%GSD_VF%VSSS, ARRAY=SD_VF, &
     & META=YSD_VF%YSSS, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSSS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_LZ0H', &
     & VARIABLE=SURFVARS%GSD_VF%VLZ0H, ARRAY=SD_VF, &
     & META=YSD_VF%YLZ0H, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YLZ0H))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CVL', &
     & VARIABLE=SURFVARS%GSD_VF%VCVL, ARRAY=SD_VF, &
     & META=YSD_VF%YCVL, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCVL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CVH', &
     & VARIABLE=SURFVARS%GSD_VF%VCVH, ARRAY=SD_VF, &
     & META=YSD_VF%YCVH, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCVH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_TVL', &
     & VARIABLE=SURFVARS%GSD_VF%VTVL, ARRAY=SD_VF, &
     & META=YSD_VF%YTVL, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YTVL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_TVH', &
     & VARIABLE=SURFVARS%GSD_VF%VTVH, ARRAY=SD_VF, &
     & META=YSD_VF%YTVH, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YTVH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_LAIL', &
     & VARIABLE=SURFVARS%GSD_VF%VLAIL, ARRAY=SD_VF, &
     & META=YSD_VF%YLAIL, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YLAIL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_LAIH', &
     & VARIABLE=SURFVARS%GSD_VF%VLAIH, ARRAY=SD_VF, &
     & META=YSD_VF%YLAIH, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YLAIH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SOTY', &
     & VARIABLE=SURFVARS%GSD_VF%VSOTY, ARRAY=SD_VF, &
     & META=YSD_VF%YSOTY, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSOTY))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CLK', &
     & VARIABLE=SURFVARS%GSD_VF%VCLK, ARRAY=SD_VF, &
     & META=YSD_VF%YCLK, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCLK))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_DL', &
     & VARIABLE=SURFVARS%GSD_VF%VDL, ARRAY=SD_VF, &
     & META=YSD_VF%YDL, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YDL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CI', &
     & VARIABLE=SURFVARS%GSD_VF%VCI, ARRAY=SD_VF, &
     & META=YSD_VF%YCI, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCI))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_UCUR', &
     & VARIABLE=SURFVARS%GSD_VF%VUCUR, ARRAY=SD_VF, &
     & META=YSD_VF%YUCUR, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YUCUR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_VCUR', &
     & VARIABLE=SURFVARS%GSD_VF%VVCUR, ARRAY=SD_VF, &
     & META=YSD_VF%YVCUR, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YVCUR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_Z0RLF', &
     & VARIABLE=SURFVARS%GSD_VF%VZ0RLF, ARRAY=SD_VF, &
     & META=YSD_VF%YZ0RLF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YZ0RLF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CO2O', &
     & VARIABLE=SURFVARS%GSD_VF%VCO2O, ARRAY=SD_VF, &
     & META=YSD_VF%YCO2O, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCO2O))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CO2B', &
     & VARIABLE=SURFVARS%GSD_VF%VCO2B, ARRAY=SD_VF, &
     & META=YSD_VF%YCO2B, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCO2B))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CO2A', &
     & VARIABLE=SURFVARS%GSD_VF%VCO2A, ARRAY=SD_VF, &
     & META=YSD_VF%YCO2A, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCO2A))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CO2F', &
     & VARIABLE=SURFVARS%GSD_VF%VCO2F, ARRAY=SD_VF, &
     & META=YSD_VF%YCO2F, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCO2F))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CGPP', &
     & VARIABLE=SURFVARS%GSD_VF%VCGPP, ARRAY=SD_VF, &
     & META=YSD_VF%YCGPP, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCGPP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CREC', &
     & VARIABLE=SURFVARS%GSD_VF%VCREC, ARRAY=SD_VF, &
     & META=YSD_VF%YCREC, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCREC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CH4AG', &
     & VARIABLE=SURFVARS%GSD_VF%VCH4AG, ARRAY=SD_VF, &
     & META=YSD_VF%YCH4AG, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCH4AG))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_CH4F', &
     & VARIABLE=SURFVARS%GSD_VF%VCH4F, ARRAY=SD_VF, &
     & META=YSD_VF%YCH4F, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YCH4F))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SDFOR', &
     & VARIABLE=SURFVARS%GSD_VF%VSDFOR, ARRAY=SD_VF, &
     & META=YSD_VF%YSDFOR, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSDFOR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_ALUVP', &
     & VARIABLE=SURFVARS%GSD_VF%VALUVP, ARRAY=SD_VF, &
     & META=YSD_VF%YALUVP, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YALUVP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_ALUVD', &
     & VARIABLE=SURFVARS%GSD_VF%VALUVD, ARRAY=SD_VF, &
     & META=YSD_VF%YALUVD, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YALUVD))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_ALNIP', &
     & VARIABLE=SURFVARS%GSD_VF%VALNIP, ARRAY=SD_VF, &
     & META=YSD_VF%YALNIP, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YALNIP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_ALNID', &
     & VARIABLE=SURFVARS%GSD_VF%VALNID, ARRAY=SD_VF, &
     & META=YSD_VF%YALNID, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YALNID))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_FP1', &
     & VARIABLE=SURFVARS%GSD_VF%VFP1, ARRAY=SD_VF, &
     & META=YSD_VF%YFP1, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YFP1))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_BCBF', &
     & VARIABLE=SURFVARS%GSD_VF%VBCBF, ARRAY=SD_VF, &
     & META=YSD_VF%YBCBF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YBCBF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_BCFF', &
     & VARIABLE=SURFVARS%GSD_VF%VBCFF, ARRAY=SD_VF, &
     & META=YSD_VF%YBCFF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YBCFF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_BCGF', &
     & VARIABLE=SURFVARS%GSD_VF%VBCGF, ARRAY=SD_VF, &
     & META=YSD_VF%YBCGF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YBCGF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_OMBF', &
     & VARIABLE=SURFVARS%GSD_VF%VOMBF, ARRAY=SD_VF, &
     & META=YSD_VF%YOMBF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YOMBF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_OMFF', &
     & VARIABLE=SURFVARS%GSD_VF%VOMFF, ARRAY=SD_VF, &
     & META=YSD_VF%YOMFF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YOMFF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_OMGF', &
     & VARIABLE=SURFVARS%GSD_VF%VOMGF, ARRAY=SD_VF, &
     & META=YSD_VF%YOMGF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YOMGF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_INJF', &
     & VARIABLE=SURFVARS%GSD_VF%VINJF, ARRAY=SD_VF, &
     & META=YSD_VF%YINJF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YINJF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SO2L', &
     & VARIABLE=SURFVARS%GSD_VF%VSO2L, ARRAY=SD_VF, &
     & META=YSD_VF%YSO2L, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSO2L))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SO2H', &
     & VARIABLE=SURFVARS%GSD_VF%VSO2H, ARRAY=SD_VF, &
     & META=YSD_VF%YSO2H, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSO2H))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SO2DD', &
     & VARIABLE=SURFVARS%GSD_VF%VSO2DD, ARRAY=SD_VF, &
     & META=YSD_VF%YSO2DD, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSO2DD))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SOGF', &
     & VARIABLE=SURFVARS%GSD_VF%VSOGF, ARRAY=SD_VF, &
     & META=YSD_VF%YSOGF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSOGF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SOA', &
     & VARIABLE=SURFVARS%GSD_VF%VSOA, ARRAY=SD_VF, &
     & META=YSD_VF%YSOA, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSOA))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_VOLC', &
     & VARIABLE=SURFVARS%GSD_VF%VVOLC, ARRAY=SD_VF, &
     & META=YSD_VF%YVOLC, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YVOLC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_VOLE', &
     & VARIABLE=SURFVARS%GSD_VF%VVOLE, ARRAY=SD_VF, &
     & META=YSD_VF%YVOLE, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YVOLE))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_DMSO', &
     & VARIABLE=SURFVARS%GSD_VF%VDMSO, ARRAY=SD_VF, &
     & META=YSD_VF%YDMSO, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YDMSO))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_SOACO', &
     & VARIABLE=SURFVARS%GSD_VF%VSOACO, ARRAY=SD_VF, &
     & META=YSD_VF%YSOACO, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YSOACO))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_URBF', &
     & VARIABLE=SURFVARS%GSD_VF%VURBF, ARRAY=SD_VF, &
     & META=YSD_VF%YURBF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YURBF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_VOLCALTI', &
     & VARIABLE=SURFVARS%GSD_VF%VVOLCALTI, ARRAY=SD_VF, &
     & META=YSD_VF%YVOLCALTI, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YVOLCALTI))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_FCA1', &
     & VARIABLE=SURFVARS%GSD_VF%VFCA1, ARRAY=SD_VF, &
     & META=YSD_VF%YFCA1, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YFCA1))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_FCA2', &
     & VARIABLE=SURFVARS%GSD_VF%VFCA2, ARRAY=SD_VF, &
     & META=YSD_VF%YFCA2, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YFCA2))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_AERDEP', &
     & VARIABLE=SURFVARS%GSD_VF%VAERDEP, ARRAY=SD_VF, &
     & META=YSD_VF%YAERDEP, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YAERDEP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_AERLTS', &
     & VARIABLE=SURFVARS%GSD_VF%VAERLTS, ARRAY=SD_VF, &
     & META=YSD_VF%YAERLTS, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YAERLTS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_AERSCC', &
     & VARIABLE=SURFVARS%GSD_VF%VAERSCC, ARRAY=SD_VF, &
     & META=YSD_VF%YAERSCC, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YAERSCC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_DSF', &
     & VARIABLE=SURFVARS%GSD_VF%VDSF, ARRAY=SD_VF, &
     & META=YSD_VF%YDSF, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YDSF))
    IF (ASSOCIATED(YSD_VF%YCHEMFLX)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VF_CHEMFLX', &
       & VARIABLES=SURFVARS%GSD_VF%VCHEMFLX, ARRAY=SD_VF, &
       & META=YSD_VF%YCHEMFLX(:), DESCR=YSD_VFD, &
       & ACTIVE=ASSOCIATED(YSD_VF%YCHEMFLX))
    END IF
    IF (ASSOCIATED(YSD_VF%YCHEMFLXO)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VF_CHEMFLXO', &
       & VARIABLES=SURFVARS%GSD_VF%VCHEMFLXO, ARRAY=SD_VF, &
       & META=YSD_VF%YCHEMFLXO(:), DESCR=YSD_VFD, &
       & ACTIVE=ASSOCIATED(YSD_VF%YCHEMFLXO))
    END IF
    IF (ASSOCIATED(YSD_VF%YCHEMDV)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VF_CHEMDV', &
       & VARIABLES=SURFVARS%GSD_VF%VCHEMDV, ARRAY=SD_VF, &
       & META=YSD_VF%YCHEMDV(:), DESCR=YSD_VFD, &
       & ACTIVE=ASSOCIATED(YSD_VF%YCHEMDV))
    END IF
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VF_NUDM', &
     & VARIABLE=SURFVARS%GSD_VF%VNUDM, ARRAY=SD_VF, &
     & META=YSD_VF%YNUDM, DESCR=YSD_VFD, &
     & ACTIVE=ASSOCIATED(YSD_VF%YNUDM))

    IF (YSD_VFD%NDIM == 0) THEN
      SURFVARS%GSD_VF%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_VF%F_GROUP = FIELD_3D(DATA=SD_VF)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_VH=>YDSURF%SD_VH, YSD_VH=>YDSURF%YSD_VH, YSD_VHD=>YDSURF%YSD_VHD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_TCCH', &
     & VARIABLE=SURFVARS%GSD_VH%VTCCH, ARRAY=SD_VH, &
     & META=YSD_VH%YTCCH, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YTCCH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_SCCH', &
     & VARIABLE=SURFVARS%GSD_VH%VSCCH, ARRAY=SD_VH, &
     & META=YSD_VH%YSCCH, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YSCCH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_BCCH', &
     & VARIABLE=SURFVARS%GSD_VH%VBCCH, ARRAY=SD_VH, &
     & META=YSD_VH%YBCCH, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YBCCH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_PBLH', &
     & VARIABLE=SURFVARS%GSD_VH%VPBLH, ARRAY=SD_VH, &
     & META=YSD_VH%YPBLH, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YPBLH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_SPSH', &
     & VARIABLE=SURFVARS%GSD_VH%VSPSH, ARRAY=SD_VH, &
     & META=YSD_VH%YSPSH, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YSPSH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_QSH', &
     & VARIABLE=SURFVARS%GSD_VH%VQSH, ARRAY=SD_VH, &
     & META=YSD_VH%YQSH, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YQSH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_PCL', &
     & VARIABLE=SURFVARS%GSD_VH%VPCL, ARRAY=SD_VH, &
     & META=YSD_VH%YPCL, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YPCL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_PSL', &
     & VARIABLE=SURFVARS%GSD_VH%VPSL, ARRAY=SD_VH, &
     & META=YSD_VH%YPSL, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YPSL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_PCN', &
     & VARIABLE=SURFVARS%GSD_VH%VPCN, ARRAY=SD_VH, &
     & META=YSD_VH%YPCN, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YPCN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_PSN', &
     & VARIABLE=SURFVARS%GSD_VH%VPSN, ARRAY=SD_VH, &
     & META=YSD_VH%YPSN, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YPSN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VH_EVA', &
     & VARIABLE=SURFVARS%GSD_VH%VEVA, ARRAY=SD_VH, &
     & META=YSD_VH%YEVA, DESCR=YSD_VHD, &
     & ACTIVE=ASSOCIATED(YSD_VH%YEVA))

    IF (YSD_VHD%NDIM == 0) THEN
      SURFVARS%GSD_VH%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_VH%F_GROUP = FIELD_3D(DATA=SD_VH)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_VK=>YDSURF%SD_VK, YSD_VK=>YDSURF%YSD_VK, YSD_VKD=>YDSURF%YSD_VKD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VK_UDGRO', &
     & VARIABLE=SURFVARS%GSD_VK%VUDGRO, ARRAY=SD_VK, &
     & META=YSD_VK%YUDGRO, DESCR=YSD_VKD, &
     & ACTIVE=ASSOCIATED(YSD_VK%YUDGRO))

    IF (YSD_VKD%NDIM == 0) THEN
      SURFVARS%GSD_VK%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_VK%F_GROUP = FIELD_3D(DATA=SD_VK)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_VP=>YDSURF%SD_VP, YSD_VP=>YDSURF%YSD_VP, YSD_VPD=>YDSURF%YSD_VPD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VP_TPC', &
     & VARIABLE=SURFVARS%GSD_VP%VTPC, ARRAY=SD_VP, &
     & META=YSD_VP%YTPC, DESCR=YSD_VPD, &
     & ACTIVE=ASSOCIATED(YSD_VP%YTPC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VP_WPC', &
     & VARIABLE=SURFVARS%GSD_VP%VWPC, ARRAY=SD_VP, &
     & META=YSD_VP%YWPC, DESCR=YSD_VPD, &
     & ACTIVE=ASSOCIATED(YSD_VP%YWPC))

    IF (YSD_VPD%NDIM == 0) THEN
      SURFVARS%GSD_VP%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_VP%F_GROUP = FIELD_3D(DATA=SD_VP)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_VV=>YDSURF%SD_VV, YSD_VV=>YDSURF%YSD_VV, YSD_VVD=>YDSURF%YSD_VVD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_ARG', &
     & VARIABLE=SURFVARS%GSD_VV%VARG, ARRAY=SD_VV, &
     & META=YSD_VV%YARG, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YARG))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_SAB', &
     & VARIABLE=SURFVARS%GSD_VV%VSAB, ARRAY=SD_VV, &
     & META=YSD_VV%YSAB, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YSAB))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_D2', &
     & VARIABLE=SURFVARS%GSD_VV%VD2, ARRAY=SD_VV, &
     & META=YSD_VV%YD2, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YD2))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_IVEG', &
     & VARIABLE=SURFVARS%GSD_VV%VIVEG, ARRAY=SD_VV, &
     & META=YSD_VV%YIVEG, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YIVEG))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_RSMIN', &
     & VARIABLE=SURFVARS%GSD_VV%VRSMIN, ARRAY=SD_VV, &
     & META=YSD_VV%YRSMIN, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YRSMIN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_LAI', &
     & VARIABLE=SURFVARS%GSD_VV%VLAI, ARRAY=SD_VV, &
     & META=YSD_VV%YLAI, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YLAI))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_HV', &
     & VARIABLE=SURFVARS%GSD_VV%VHV, ARRAY=SD_VV, &
     & META=YSD_VV%YHV, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YHV))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_Z0H', &
     & VARIABLE=SURFVARS%GSD_VV%VZ0H, ARRAY=SD_VV, &
     & META=YSD_VV%YZ0H, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YZ0H))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_ALS', &
     & VARIABLE=SURFVARS%GSD_VV%VALS, ARRAY=SD_VV, &
     & META=YSD_VV%YALS, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YALS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VV_ALV', &
     & VARIABLE=SURFVARS%GSD_VV%VALV, ARRAY=SD_VV, &
     & META=YSD_VV%YALV, DESCR=YSD_VVD, &
     & ACTIVE=ASSOCIATED(YSD_VV%YALV))

    IF (YSD_VVD%NDIM == 0) THEN
      SURFVARS%GSD_VV%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_VV%F_GROUP = FIELD_3D(DATA=SD_VV)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_VA=>YDSURF%SD_VA, YSD_VA=>YDSURF%YSD_VA, YSD_VAD=>YDSURF%YSD_VAD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VA_SEA', &
     & VARIABLE=SURFVARS%GSD_VA%VSEA, ARRAY=SD_VA, &
     & META=YSD_VA%YSEA, DESCR=YSD_VAD, &
     & ACTIVE=ASSOCIATED(YSD_VA%YSEA))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VA_LAN', &
     & VARIABLE=SURFVARS%GSD_VA%VLAN, ARRAY=SD_VA, &
     & META=YSD_VA%YLAN, DESCR=YSD_VAD, &
     & ACTIVE=ASSOCIATED(YSD_VA%YLAN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VA_SOO', &
     & VARIABLE=SURFVARS%GSD_VA%VSOO, ARRAY=SD_VA, &
     & META=YSD_VA%YSOO, DESCR=YSD_VAD, &
     & ACTIVE=ASSOCIATED(YSD_VA%YSOO))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VA_DES', &
     & VARIABLE=SURFVARS%GSD_VA%VDES, ARRAY=SD_VA, &
     & META=YSD_VA%YDES, DESCR=YSD_VAD, &
     & ACTIVE=ASSOCIATED(YSD_VA%YDES))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VA_SUL', &
     & VARIABLE=SURFVARS%GSD_VA%VSUL, ARRAY=SD_VA, &
     & META=YSD_VA%YSUL, DESCR=YSD_VAD, &
     & ACTIVE=ASSOCIATED(YSD_VA%YSUL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VA_VOL', &
     & VARIABLE=SURFVARS%GSD_VA%VVOL, ARRAY=SD_VA, &
     & META=YSD_VA%YVOL, DESCR=YSD_VAD, &
     & ACTIVE=ASSOCIATED(YSD_VA%YVOL))

    IF (YSD_VAD%NDIM == 0) THEN
      SURFVARS%GSD_VA%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_VA%F_GROUP = FIELD_3D(DATA=SD_VA)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_VN=>YDSURF%SD_VN, YSD_VN=>YDSURF%YSD_VN, YSD_VND=>YDSURF%YSD_VND)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VN_TOP', &
     & VARIABLE=SURFVARS%GSD_VN%VTOP, ARRAY=SD_VN, &
     & META=YSD_VN%YTOP, DESCR=YSD_VND, &
     & ACTIVE=ASSOCIATED(YSD_VN%YTOP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VN_BAS', &
     & VARIABLE=SURFVARS%GSD_VN%VBAS, ARRAY=SD_VN, &
     & META=YSD_VN%YBAS, DESCR=YSD_VND, &
     & ACTIVE=ASSOCIATED(YSD_VN%YBAS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VN_ACPR', &
     & VARIABLE=SURFVARS%GSD_VN%VACPR, ARRAY=SD_VN, &
     & META=YSD_VN%YACPR, DESCR=YSD_VND, &
     & ACTIVE=ASSOCIATED(YSD_VN%YACPR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VN_ACCPR', &
     & VARIABLE=SURFVARS%GSD_VN%VACCPR, ARRAY=SD_VN, &
     & META=YSD_VN%YACCPR, DESCR=YSD_VND, &
     & ACTIVE=ASSOCIATED(YSD_VN%YACCPR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VN_ACCPR5', &
     & VARIABLE=SURFVARS%GSD_VN%VACCPR5, ARRAY=SD_VN, &
     & META=YSD_VN%YACCPR5, DESCR=YSD_VND, &
     & ACTIVE=ASSOCIATED(YSD_VN%YACCPR5))

    IF (YSD_VND%NDIM == 0) THEN
      SURFVARS%GSD_VN%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_VN%F_GROUP = FIELD_3D(DATA=SD_VN)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_V2=>YDSURF%SD_V2, YSD_V2=>YDSURF%YSD_V2, YSD_V2D=>YDSURF%YSD_V2D)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_V2_OCDEP', &
     & VARIABLE=SURFVARS%GSD_V2%VOCDEP, ARRAY=SD_V2, &
     & META=YSD_V2%YOCDEP, DESCR=YSD_V2D, &
     & ACTIVE=ASSOCIATED(YSD_V2%YOCDEP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_V2_USTRC', &
     & VARIABLE=SURFVARS%GSD_V2%VUSTRC, ARRAY=SD_V2, &
     & META=YSD_V2%YUSTRC, DESCR=YSD_V2D, &
     & ACTIVE=ASSOCIATED(YSD_V2%YUSTRC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_V2_VSTRC', &
     & VARIABLE=SURFVARS%GSD_V2%VVSTRC, ARRAY=SD_V2, &
     & META=YSD_V2%YVSTRC, DESCR=YSD_V2D, &
     & ACTIVE=ASSOCIATED(YSD_V2%YVSTRC))

    IF (YSD_V2D%NDIM == 0) THEN
      SURFVARS%GSD_V2%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_V2%F_GROUP = FIELD_3D(DATA=SD_V2)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_V3=>YDSURF%SD_V3, YSD_V3=>YDSURF%YSD_V3, YSD_V3D=>YDSURF%YSD_V3D)
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_DIFM', &
     & VARIABLE=SURFVARS%GSD_V3%VDIFM, ARRAY=SD_V3, &
     & META=YSD_V3%YDIFM, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YDIFM))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_DIFT', &
     & VARIABLE=SURFVARS%GSD_V3%VDIFT, ARRAY=SD_V3, &
     & META=YSD_V3%YDIFT, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YDIFT))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_DIFS', &
     & VARIABLE=SURFVARS%GSD_V3%VDIFS, ARRAY=SD_V3, &
     & META=YSD_V3%YDIFS, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YDIFS))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_ADVT', &
     & VARIABLE=SURFVARS%GSD_V3%VADVT, ARRAY=SD_V3, &
     & META=YSD_V3%YADVT, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YADVT))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_ADVS', &
     & VARIABLE=SURFVARS%GSD_V3%VADVS, ARRAY=SD_V3, &
     & META=YSD_V3%YADVS, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YADVS))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_TRI0', &
     & VARIABLE=SURFVARS%GSD_V3%VTRI0, ARRAY=SD_V3, &
     & META=YSD_V3%YTRI0, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YTRI0))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_TRI1', &
     & VARIABLE=SURFVARS%GSD_V3%VTRI1, ARRAY=SD_V3, &
     & META=YSD_V3%YTRI1, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YTRI1))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_SWDK', &
     & VARIABLE=SURFVARS%GSD_V3%VSWDK, ARRAY=SD_V3, &
     & META=YSD_V3%YSWDK, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YSWDK))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_ZO', &
     & VARIABLE=SURFVARS%GSD_V3%VZO, ARRAY=SD_V3, &
     & META=YSD_V3%YZO, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YZO))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_HO', &
     & VARIABLE=SURFVARS%GSD_V3%VHO, ARRAY=SD_V3, &
     & META=YSD_V3%YHO, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YHO))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_DO', &
     & VARIABLE=SURFVARS%GSD_V3%VDO, ARRAY=SD_V3, &
     & META=YSD_V3%YDO, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YDO))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_HO_INV', &
     & VARIABLE=SURFVARS%GSD_V3%VHO_INV, ARRAY=SD_V3, &
     & META=YSD_V3%YHO_INV, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YHO_INV))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_UOC', &
     & VARIABLE=SURFVARS%GSD_V3%VUOC, ARRAY=SD_V3, &
     & META=YSD_V3%YUOC, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YUOC))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_V3_VOC', &
     & VARIABLE=SURFVARS%GSD_V3%VVOC, ARRAY=SD_V3, &
     & META=YSD_V3%YVOC, DESCR=YSD_V3D, &
     & ACTIVE=ASSOCIATED(YSD_V3%YVOC))

    IF (YSD_V3D%NDIM == 0) THEN
      SURFVARS%GSD_V3%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSD_V3D%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_V3%F_GROUP = FIELD_4D(DATA=SD_V3)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_VD=>YDSURF%SD_VD, YSD_VD=>YDSURF%YSD_VD, YSD_VDD=>YDSURF%YSD_VDD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LSP', &
     & VARIABLE=SURFVARS%GSD_VD%VLSP, ARRAY=SD_VD, &
     & META=YSD_VD%YLSP, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLSP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CP', &
     & VARIABLE=SURFVARS%GSD_VD%VCP, ARRAY=SD_VD, &
     & META=YSD_VD%YCP, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SF', &
     & VARIABLE=SURFVARS%GSD_VD%VSF, ARRAY=SD_VD, &
     & META=YSD_VD%YSF, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_FZRA', &
     & VARIABLE=SURFVARS%GSD_VD%VFZRA, ARRAY=SD_VD, &
     & META=YSD_VD%YFZRA, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YFZRA))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_BLD', &
     & VARIABLE=SURFVARS%GSD_VD%VBLD, ARRAY=SD_VD, &
     & META=YSD_VD%YBLD, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YBLD))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SSHF', &
     & VARIABLE=SURFVARS%GSD_VD%VSSHF, ARRAY=SD_VD, &
     & META=YSD_VD%YSSHF, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSSHF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SLHF', &
     & VARIABLE=SURFVARS%GSD_VD%VSLHF, ARRAY=SD_VD, &
     & META=YSD_VD%YSLHF, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSLHF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_NEE', &
     & VARIABLE=SURFVARS%GSD_VD%VNEE, ARRAY=SD_VD, &
     & META=YSD_VD%YNEE, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YNEE))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_GPP', &
     & VARIABLE=SURFVARS%GSD_VD%VGPP, ARRAY=SD_VD, &
     & META=YSD_VD%YGPP, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YGPP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_REC', &
     & VARIABLE=SURFVARS%GSD_VD%VREC, ARRAY=SD_VD, &
     & META=YSD_VD%YREC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YREC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_MSL', &
     & VARIABLE=SURFVARS%GSD_VD%VMSL, ARRAY=SD_VD, &
     & META=YSD_VD%YMSL, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YMSL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SP', &
     & VARIABLE=SURFVARS%GSD_VD%VSP, ARRAY=SD_VD, &
     & META=YSD_VD%YSP, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TCC', &
     & VARIABLE=SURFVARS%GSD_VD%VTCC, ARRAY=SD_VD, &
     & META=YSD_VD%YTCC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTCC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_10U', &
     & VARIABLE=SURFVARS%GSD_VD%V10U, ARRAY=SD_VD, &
     & META=YSD_VD%Y10U, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y10U))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_10V', &
     & VARIABLE=SURFVARS%GSD_VD%V10V, ARRAY=SD_VD, &
     & META=YSD_VD%Y10V, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y10V))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_2T', &
     & VARIABLE=SURFVARS%GSD_VD%V2T, ARRAY=SD_VD, &
     & META=YSD_VD%Y2T, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y2T))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_2D', &
     & VARIABLE=SURFVARS%GSD_VD%V2D, ARRAY=SD_VD, &
     & META=YSD_VD%Y2D, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y2D))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_2Q', &
     & VARIABLE=SURFVARS%GSD_VD%V2Q, ARRAY=SD_VD, &
     & META=YSD_VD%Y2Q, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y2Q))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SSR', &
     & VARIABLE=SURFVARS%GSD_VD%VSSR, ARRAY=SD_VD, &
     & META=YSD_VD%YSSR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSSR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_STR', &
     & VARIABLE=SURFVARS%GSD_VD%VSTR, ARRAY=SD_VD, &
     & META=YSD_VD%YSTR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSTR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TSR', &
     & VARIABLE=SURFVARS%GSD_VD%VTSR, ARRAY=SD_VD, &
     & META=YSD_VD%YTSR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTSR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TTR', &
     & VARIABLE=SURFVARS%GSD_VD%VTTR, ARRAY=SD_VD, &
     & META=YSD_VD%YTTR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTTR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_EWSS', &
     & VARIABLE=SURFVARS%GSD_VD%VEWSS, ARRAY=SD_VD, &
     & META=YSD_VD%YEWSS, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YEWSS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_NSSS', &
     & VARIABLE=SURFVARS%GSD_VD%VNSSS, ARRAY=SD_VD, &
     & META=YSD_VD%YNSSS, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YNSSS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_E', &
     & VARIABLE=SURFVARS%GSD_VD%VE, ARRAY=SD_VD, &
     & META=YSD_VD%YE, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YE))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_PEV', &
     & VARIABLE=SURFVARS%GSD_VD%VPEV, ARRAY=SD_VD, &
     & META=YSD_VD%YPEV, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YPEV))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CCC', &
     & VARIABLE=SURFVARS%GSD_VD%VCCC, ARRAY=SD_VD, &
     & META=YSD_VD%YCCC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCCC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LCC', &
     & VARIABLE=SURFVARS%GSD_VD%VLCC, ARRAY=SD_VD, &
     & META=YSD_VD%YLCC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLCC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_MCC', &
     & VARIABLE=SURFVARS%GSD_VD%VMCC, ARRAY=SD_VD, &
     & META=YSD_VD%YMCC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YMCC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_HCC', &
     & VARIABLE=SURFVARS%GSD_VD%VHCC, ARRAY=SD_VD, &
     & META=YSD_VD%YHCC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YHCC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LGWS', &
     & VARIABLE=SURFVARS%GSD_VD%VLGWS, ARRAY=SD_VD, &
     & META=YSD_VD%YLGWS, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLGWS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_MGWS', &
     & VARIABLE=SURFVARS%GSD_VD%VMGWS, ARRAY=SD_VD, &
     & META=YSD_VD%YMGWS, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YMGWS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_GWD', &
     & VARIABLE=SURFVARS%GSD_VD%VGWD, ARRAY=SD_VD, &
     & META=YSD_VD%YGWD, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YGWD))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_MX2T', &
     & VARIABLE=SURFVARS%GSD_VD%VMX2T, ARRAY=SD_VD, &
     & META=YSD_VD%YMX2T, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YMX2T))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_MN2T', &
     & VARIABLE=SURFVARS%GSD_VD%VMN2T, ARRAY=SD_VD, &
     & META=YSD_VD%YMN2T, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YMN2T))
    IF (ASSOCIATED(YSD_VD%YMX2T6)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_MX2T6', &
       & VARIABLES=SURFVARS%GSD_VD%VMX2T6, ARRAY=SD_VD, &
       & META=YSD_VD%YMX2T6(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YMX2T6))
    END IF
    IF (ASSOCIATED(YSD_VD%YMN2T6)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_MN2T6', &
       & VARIABLES=SURFVARS%GSD_VD%VMN2T6, ARRAY=SD_VD, &
       & META=YSD_VD%YMN2T6(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YMN2T6))
    END IF
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_RO', &
     & VARIABLE=SURFVARS%GSD_VD%VRO, ARRAY=SD_VD, &
     & META=YSD_VD%YRO, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YRO))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SRO', &
     & VARIABLE=SURFVARS%GSD_VD%VSRO, ARRAY=SD_VD, &
     & META=YSD_VD%YSRO, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSRO))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SSRO', &
     & VARIABLE=SURFVARS%GSD_VD%VSSRO, ARRAY=SD_VD, &
     & META=YSD_VD%YSSRO, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSSRO))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ALB', &
     & VARIABLE=SURFVARS%GSD_VD%VALB, ARRAY=SD_VD, &
     & META=YSD_VD%YALB, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YALB))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_IEWSS', &
     & VARIABLE=SURFVARS%GSD_VD%VIEWSS, ARRAY=SD_VD, &
     & META=YSD_VD%YIEWSS, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YIEWSS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_INSSS', &
     & VARIABLE=SURFVARS%GSD_VD%VINSSS, ARRAY=SD_VD, &
     & META=YSD_VD%YINSSS, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YINSSS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ISSHF', &
     & VARIABLE=SURFVARS%GSD_VD%VISSHF, ARRAY=SD_VD, &
     & META=YSD_VD%YISSHF, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YISSHF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_IE', &
     & VARIABLE=SURFVARS%GSD_VD%VIE, ARRAY=SD_VD, &
     & META=YSD_VD%YIE, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YIE))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_INEE', &
     & VARIABLE=SURFVARS%GSD_VD%VINEE, ARRAY=SD_VD, &
     & META=YSD_VD%YINEE, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YINEE))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_IGPP', &
     & VARIABLE=SURFVARS%GSD_VD%VIGPP, ARRAY=SD_VD, &
     & META=YSD_VD%YIGPP, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YIGPP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_IREC', &
     & VARIABLE=SURFVARS%GSD_VD%VIREC, ARRAY=SD_VD, &
     & META=YSD_VD%YIREC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YIREC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CSF', &
     & VARIABLE=SURFVARS%GSD_VD%VCSF, ARRAY=SD_VD, &
     & META=YSD_VD%YCSF, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCSF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LSSF', &
     & VARIABLE=SURFVARS%GSD_VD%VLSSF, ARRAY=SD_VD, &
     & META=YSD_VD%YLSSF, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLSSF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_MXTPR', &
     & VARIABLE=SURFVARS%GSD_VD%VMXTPR, ARRAY=SD_VD, &
     & META=YSD_VD%YMXTPR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YMXTPR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_MNTPR', &
     & VARIABLE=SURFVARS%GSD_VD%VMNTPR, ARRAY=SD_VD, &
     & META=YSD_VD%YMNTPR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YMNTPR))
    IF (ASSOCIATED(YSD_VD%YMXTPR6)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_MXTPR6', &
       & VARIABLES=SURFVARS%GSD_VD%VMXTPR6, ARRAY=SD_VD, &
       & META=YSD_VD%YMXTPR6(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YMXTPR6))
    END IF
    IF (ASSOCIATED(YSD_VD%YMNTPR6)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_MNTPR6', &
       & VARIABLES=SURFVARS%GSD_VD%VMNTPR6, ARRAY=SD_VD, &
       & META=YSD_VD%YMNTPR6(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YMNTPR6))
    END IF
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TPR', &
     & VARIABLE=SURFVARS%GSD_VD%VTPR, ARRAY=SD_VD, &
     & META=YSD_VD%YTPR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTPR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LSRR', &
     & VARIABLE=SURFVARS%GSD_VD%VLSRR, ARRAY=SD_VD, &
     & META=YSD_VD%YLSRR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLSRR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CRR', &
     & VARIABLE=SURFVARS%GSD_VD%VCRR, ARRAY=SD_VD, &
     & META=YSD_VD%YCRR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCRR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LSSFR', &
     & VARIABLE=SURFVARS%GSD_VD%VLSSFR, ARRAY=SD_VD, &
     & META=YSD_VD%YLSSFR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLSSFR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CSFR', &
     & VARIABLE=SURFVARS%GSD_VD%VCSFR, ARRAY=SD_VD, &
     & META=YSD_VD%YCSFR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCSFR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_PTYPE', &
     & VARIABLE=SURFVARS%GSD_VD%VPTYPE, ARRAY=SD_VD, &
     & META=YSD_VD%YPTYPE, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YPTYPE))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ILSPF', &
     & VARIABLE=SURFVARS%GSD_VD%VILSPF, ARRAY=SD_VD, &
     & META=YSD_VD%YILSPF, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YILSPF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_Z0F', &
     & VARIABLE=SURFVARS%GSD_VD%VZ0F, ARRAY=SD_VD, &
     & META=YSD_VD%YZ0F, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YZ0F))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LZ0H', &
     & VARIABLE=SURFVARS%GSD_VD%VLZ0H, ARRAY=SD_VD, &
     & META=YSD_VD%YLZ0H, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLZ0H))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_VIWVE', &
     & VARIABLE=SURFVARS%GSD_VD%VVIWVE, ARRAY=SD_VD, &
     & META=YSD_VD%YVIWVE, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YVIWVE))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_VIWVN', &
     & VARIABLE=SURFVARS%GSD_VD%VVIWVN, ARRAY=SD_VD, &
     & META=YSD_VD%YVIWVN, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YVIWVN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TCW', &
     & VARIABLE=SURFVARS%GSD_VD%VTCW, ARRAY=SD_VD, &
     & META=YSD_VD%YTCW, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTCW))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TCWV', &
     & VARIABLE=SURFVARS%GSD_VD%VTCWV, ARRAY=SD_VD, &
     & META=YSD_VD%YTCWV, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTCWV))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TCLW', &
     & VARIABLE=SURFVARS%GSD_VD%VTCLW, ARRAY=SD_VD, &
     & META=YSD_VD%YTCLW, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTCLW))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TCIW', &
     & VARIABLE=SURFVARS%GSD_VD%VTCIW, ARRAY=SD_VD, &
     & META=YSD_VD%YTCIW, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTCIW))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TCRW', &
     & VARIABLE=SURFVARS%GSD_VD%VTCRW, ARRAY=SD_VD, &
     & META=YSD_VD%YTCRW, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTCRW))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TCSW', &
     & VARIABLE=SURFVARS%GSD_VD%VTCSW, ARRAY=SD_VD, &
     & META=YSD_VD%YTCSW, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTCSW))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TCSLW', &
     & VARIABLE=SURFVARS%GSD_VD%VTCSLW, ARRAY=SD_VD, &
     & META=YSD_VD%YTCSLW, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTCSLW))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SSRD', &
     & VARIABLE=SURFVARS%GSD_VD%VSSRD, ARRAY=SD_VD, &
     & META=YSD_VD%YSSRD, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSSRD))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_STRD', &
     & VARIABLE=SURFVARS%GSD_VD%VSTRD, ARRAY=SD_VD, &
     & META=YSD_VD%YSTRD, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSTRD))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SSRDC', &
     & VARIABLE=SURFVARS%GSD_VD%VSSRDC, ARRAY=SD_VD, &
     & META=YSD_VD%YSSRDC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSSRDC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_STRDC', &
     & VARIABLE=SURFVARS%GSD_VD%VSTRDC, ARRAY=SD_VD, &
     & META=YSD_VD%YSTRDC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSTRDC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_BLH', &
     & VARIABLE=SURFVARS%GSD_VD%VBLH, ARRAY=SD_VD, &
     & META=YSD_VD%YBLH, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YBLH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SUND', &
     & VARIABLE=SURFVARS%GSD_VD%VSUND, ARRAY=SD_VD, &
     & META=YSD_VD%YSUND, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSUND))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SPAR', &
     & VARIABLE=SURFVARS%GSD_VD%VSPAR, ARRAY=SD_VD, &
     & META=YSD_VD%YSPAR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSPAR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SUVB', &
     & VARIABLE=SURFVARS%GSD_VD%VSUVB, ARRAY=SD_VD, &
     & META=YSD_VD%YSUVB, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSUVB))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SFDIR', &
     & VARIABLE=SURFVARS%GSD_VD%VSFDIR, ARRAY=SD_VD, &
     & META=YSD_VD%YSFDIR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSFDIR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SCDIR', &
     & VARIABLE=SURFVARS%GSD_VD%VSCDIR, ARRAY=SD_VD, &
     & META=YSD_VD%YSCDIR, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSCDIR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SDSRP', &
     & VARIABLE=SURFVARS%GSD_VD%VSDSRP, ARRAY=SD_VD, &
     & META=YSD_VD%YSDSRP, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSDSRP))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CAPE', &
     & VARIABLE=SURFVARS%GSD_VD%VCAPE, ARRAY=SD_VD, &
     & META=YSD_VD%YCAPE, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCAPE))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CAPES', &
     & VARIABLE=SURFVARS%GSD_VD%VCAPES, ARRAY=SD_VD, &
     & META=YSD_VD%YCAPES, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCAPES))
    IF (ASSOCIATED(YSD_VD%YMXCAP6)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_MXCAP6', &
       & VARIABLES=SURFVARS%GSD_VD%VMXCAP6, ARRAY=SD_VD, &
       & META=YSD_VD%YMXCAP6(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YMXCAP6))
    END IF
    IF (ASSOCIATED(YSD_VD%YMXCAPS6)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_MXCAPS6', &
       & VARIABLES=SURFVARS%GSD_VD%VMXCAPS6, ARRAY=SD_VD, &
       & META=YSD_VD%YMXCAPS6(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YMXCAPS6))
    END IF
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TSRC', &
     & VARIABLE=SURFVARS%GSD_VD%VTSRC, ARRAY=SD_VD, &
     & META=YSD_VD%YTSRC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTSRC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TTRC', &
     & VARIABLE=SURFVARS%GSD_VD%VTTRC, ARRAY=SD_VD, &
     & META=YSD_VD%YTTRC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTTRC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SSRC', &
     & VARIABLE=SURFVARS%GSD_VD%VSSRC, ARRAY=SD_VD, &
     & META=YSD_VD%YSSRC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSSRC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_STRC', &
     & VARIABLE=SURFVARS%GSD_VD%VSTRC, ARRAY=SD_VD, &
     & META=YSD_VD%YSTRC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSTRC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ES', &
     & VARIABLE=SURFVARS%GSD_VD%VES, ARRAY=SD_VD, &
     & META=YSD_VD%YES, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YES))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SMLT', &
     & VARIABLE=SURFVARS%GSD_VD%VSMLT, ARRAY=SD_VD, &
     & META=YSD_VD%YSMLT, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSMLT))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_10FG', &
     & VARIABLE=SURFVARS%GSD_VD%V10FG, ARRAY=SD_VD, &
     & META=YSD_VD%Y10FG, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y10FG))
    IF (ASSOCIATED(YSD_VD%Y10FG6)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_10FG6', &
       & VARIABLES=SURFVARS%GSD_VD%V10FG6, ARRAY=SD_VD, &
       & META=YSD_VD%Y10FG6(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%Y10FG6))
    END IF
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_10FGCV', &
     & VARIABLE=SURFVARS%GSD_VD%V10FGCV, ARRAY=SD_VD, &
     & META=YSD_VD%Y10FGCV, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y10FGCV))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_I10FG', &
     & VARIABLE=SURFVARS%GSD_VD%VI10FG, ARRAY=SD_VD, &
     & META=YSD_VD%YI10FG, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YI10FG))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LSPF', &
     & VARIABLE=SURFVARS%GSD_VD%VLSPF, ARRAY=SD_VD, &
     & META=YSD_VD%YLSPF, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLSPF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TCO3', &
     & VARIABLE=SURFVARS%GSD_VD%VTCO3, ARRAY=SD_VD, &
     & META=YSD_VD%YTCO3, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTCO3))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_VIMD', &
     & VARIABLE=SURFVARS%GSD_VD%VVIMD, ARRAY=SD_VD, &
     & META=YSD_VD%YVIMD, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YVIMD))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_SPARC', &
     & VARIABLE=SURFVARS%GSD_VD%VSPARC, ARRAY=SD_VD, &
     & META=YSD_VD%YSPARC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSPARC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_STINC', &
     & VARIABLE=SURFVARS%GSD_VD%VSTINC, ARRAY=SD_VD, &
     & META=YSD_VD%YSTINC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YSTINC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CBASE', &
     & VARIABLE=SURFVARS%GSD_VD%VCBASE, ARRAY=SD_VD, &
     & META=YSD_VD%YCBASE, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCBASE))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_0DEGL', &
     & VARIABLE=SURFVARS%GSD_VD%V0DEGL, ARRAY=SD_VD, &
     & META=YSD_VD%Y0DEGL, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y0DEGL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_VISIH', &
     & VARIABLE=SURFVARS%GSD_VD%VVISIH, ARRAY=SD_VD, &
     & META=YSD_VD%YVISIH, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YVISIH))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CIN', &
     & VARIABLE=SURFVARS%GSD_VD%VCIN, ARRAY=SD_VD, &
     & META=YSD_VD%YCIN, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCIN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_KINDEX', &
     & VARIABLE=SURFVARS%GSD_VD%VKINDEX, ARRAY=SD_VD, &
     & META=YSD_VD%YKINDEX, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YKINDEX))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TTINDEX', &
     & VARIABLE=SURFVARS%GSD_VD%VTTINDEX, ARRAY=SD_VD, &
     & META=YSD_VD%YTTINDEX, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTTINDEX))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CBASEA', &
     & VARIABLE=SURFVARS%GSD_VD%VCBASEA, ARRAY=SD_VD, &
     & META=YSD_VD%YCBASEA, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCBASEA))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_CTOPC', &
     & VARIABLE=SURFVARS%GSD_VD%VCTOPC, ARRAY=SD_VD, &
     & META=YSD_VD%YCTOPC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YCTOPC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ZTWETB0', &
     & VARIABLE=SURFVARS%GSD_VD%VZTWETB0, ARRAY=SD_VD, &
     & META=YSD_VD%YZTWETB0, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YZTWETB0))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ZTWETB1', &
     & VARIABLE=SURFVARS%GSD_VD%VZTWETB1, ARRAY=SD_VD, &
     & META=YSD_VD%YZTWETB1, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YZTWETB1))
    IF (ASSOCIATED(YSD_VD%YTCGHG)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_TCGHG', &
       & VARIABLES=SURFVARS%GSD_VD%VTCGHG, ARRAY=SD_VD, &
       & META=YSD_VD%YTCGHG(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YTCGHG))
    END IF
    IF (ASSOCIATED(YSD_VD%YTCCHEM)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_TCCHEM', &
       & VARIABLES=SURFVARS%GSD_VD%VTCCHEM, ARRAY=SD_VD, &
       & META=YSD_VD%YTCCHEM(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YTCCHEM))
    END IF
    IF (ASSOCIATED(YSD_VD%YAERODIAG)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY2_2D(NAME='SD_VD_AERODIAG', &
       & VARIABLES=SURFVARS%GSD_VD%VAERODIAG, ARRAY=SD_VD, &
       & META=YSD_VD%YAERODIAG(:,:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YAERODIAG))
    END IF
    IF (ASSOCIATED(YSD_VD%YAERO_WVL_DIAG)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY2_2D(NAME='SD_VD_AERO_WVL_DIAG', &
       & VARIABLES=SURFVARS%GSD_VD%VAERO_WVL_DIAG, ARRAY=SD_VD, &
       & META=YSD_VD%YAERO_WVL_DIAG(:,:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YAERO_WVL_DIAG))
    END IF
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_100U', &
     & VARIABLE=SURFVARS%GSD_VD%V100U, ARRAY=SD_VD, &
     & META=YSD_VD%Y100U, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y100U))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_100V', &
     & VARIABLE=SURFVARS%GSD_VD%V100V, ARRAY=SD_VD, &
     & META=YSD_VD%Y100V, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y100V))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_200U', &
     & VARIABLE=SURFVARS%GSD_VD%V200U, ARRAY=SD_VD, &
     & META=YSD_VD%Y200U, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y200U))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_200V', &
     & VARIABLE=SURFVARS%GSD_VD%V200V, ARRAY=SD_VD, &
     & META=YSD_VD%Y200V, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y200V))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ZUST', &
     & VARIABLE=SURFVARS%GSD_VD%VZUST, ARRAY=SD_VD, &
     & META=YSD_VD%YZUST, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YZUST))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_10NU', &
     & VARIABLE=SURFVARS%GSD_VD%V10NU, ARRAY=SD_VD, &
     & META=YSD_VD%Y10NU, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y10NU))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_10NV', &
     & VARIABLE=SURFVARS%GSD_VD%V10NV, ARRAY=SD_VD, &
     & META=YSD_VD%Y10NV, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%Y10NV))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_DNDZN', &
     & VARIABLE=SURFVARS%GSD_VD%VDNDZN, ARRAY=SD_VD, &
     & META=YSD_VD%YDNDZN, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YDNDZN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_DNDZA', &
     & VARIABLE=SURFVARS%GSD_VD%VDNDZA, ARRAY=SD_VD, &
     & META=YSD_VD%YDNDZA, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YDNDZA))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_DCTB', &
     & VARIABLE=SURFVARS%GSD_VD%VDCTB, ARRAY=SD_VD, &
     & META=YSD_VD%YDCTB, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YDCTB))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TPLB', &
     & VARIABLE=SURFVARS%GSD_VD%VTPLB, ARRAY=SD_VD, &
     & META=YSD_VD%YTPLB, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTPLB))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_TPLT', &
     & VARIABLE=SURFVARS%GSD_VD%VTPLT, ARRAY=SD_VD, &
     & META=YSD_VD%YTPLT, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YTPLT))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODSS', &
     & VARIABLE=SURFVARS%GSD_VD%VODSS, ARRAY=SD_VD, &
     & META=YSD_VD%YODSS, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODSS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODDU', &
     & VARIABLE=SURFVARS%GSD_VD%VODDU, ARRAY=SD_VD, &
     & META=YSD_VD%YODDU, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODDU))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODOM', &
     & VARIABLE=SURFVARS%GSD_VD%VODOM, ARRAY=SD_VD, &
     & META=YSD_VD%YODOM, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODOM))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODBC', &
     & VARIABLE=SURFVARS%GSD_VD%VODBC, ARRAY=SD_VD, &
     & META=YSD_VD%YODBC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODBC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODSU', &
     & VARIABLE=SURFVARS%GSD_VD%VODSU, ARRAY=SD_VD, &
     & META=YSD_VD%YODSU, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODSU))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODNI', &
     & VARIABLE=SURFVARS%GSD_VD%VODNI, ARRAY=SD_VD, &
     & META=YSD_VD%YODNI, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODNI))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODAM', &
     & VARIABLE=SURFVARS%GSD_VD%VODAM, ARRAY=SD_VD, &
     & META=YSD_VD%YODAM, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODAM))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODSOA', &
     & VARIABLE=SURFVARS%GSD_VD%VODSOA, ARRAY=SD_VD, &
     & META=YSD_VD%YODSOA, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODSOA))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODVFA', &
     & VARIABLE=SURFVARS%GSD_VD%VODVFA, ARRAY=SD_VD, &
     & META=YSD_VD%YODVFA, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODVFA))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODVSU', &
     & VARIABLE=SURFVARS%GSD_VD%VODVSU, ARRAY=SD_VD, &
     & META=YSD_VD%YODVSU, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODVSU))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_ODTOACC', &
     & VARIABLE=SURFVARS%GSD_VD%VODTOACC, ARRAY=SD_VD, &
     & META=YSD_VD%YODTOACC, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YODTOACC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_AEPM1', &
     & VARIABLE=SURFVARS%GSD_VD%VAEPM1, ARRAY=SD_VD, &
     & META=YSD_VD%YAEPM1, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YAEPM1))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_AEPM25', &
     & VARIABLE=SURFVARS%GSD_VD%VAEPM25, ARRAY=SD_VD, &
     & META=YSD_VD%YAEPM25, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YAEPM25))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_AEPM10', &
     & VARIABLE=SURFVARS%GSD_VD%VAEPM10, ARRAY=SD_VD, &
     & META=YSD_VD%YAEPM10, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YAEPM10))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_UVBED', &
     & VARIABLE=SURFVARS%GSD_VD%VUVBED, ARRAY=SD_VD, &
     & META=YSD_VD%YUVBED, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YUVBED))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_UVBEDCS', &
     & VARIABLE=SURFVARS%GSD_VD%VUVBEDCS, ARRAY=SD_VD, &
     & META=YSD_VD%YUVBEDCS, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YUVBEDCS))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LITOTI', &
     & VARIABLE=SURFVARS%GSD_VD%VLITOTI, ARRAY=SD_VD, &
     & META=YSD_VD%YLITOTI, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLITOTI))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VD_LICGI', &
     & VARIABLE=SURFVARS%GSD_VD%VLICGI, ARRAY=SD_VD, &
     & META=YSD_VD%YLICGI, DESCR=YSD_VDD, &
     & ACTIVE=ASSOCIATED(YSD_VD%YLICGI))
    IF (ASSOCIATED(YSD_VD%YLITOTA6)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_LITOTA6', &
       & VARIABLES=SURFVARS%GSD_VD%VLITOTA6, ARRAY=SD_VD, &
       & META=YSD_VD%YLITOTA6(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YLITOTA6))
    END IF
    IF (ASSOCIATED(YSD_VD%YLICGA6)) THEN
      CALL SELF%CREATE_SURFACE_VARIABLE_ARRAY_2D(NAME='SD_VD_LICGA6', &
       & VARIABLES=SURFVARS%GSD_VD%VLICGA6, ARRAY=SD_VD, &
       & META=YSD_VD%YLICGA6(:), DESCR=YSD_VDD, &
       & ACTIVE=ASSOCIATED(YSD_VD%YLICGA6))
    END IF

    IF (YSD_VDD%NDIM == 0) THEN
      SURFVARS%GSD_VD%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_VD%F_GROUP = FIELD_3D(DATA=SD_VD)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_SM=>YDSURF%SD_SM, YSD_SM=>YDSURF%YSD_SM, YSD_SMD=>YDSURF%YSD_SMD)
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_SM_CLBT', &
     & VARIABLE=SURFVARS%GSD_SM%VCLBT, ARRAY=SD_SM, &
     & META=YSD_SM%YCLBT, DESCR=YSD_SMD, &
     & ACTIVE=ASSOCIATED(YSD_SM%YCLBT))
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_SM_CSBT', &
     & VARIABLE=SURFVARS%GSD_SM%VCSBT, ARRAY=SD_SM, &
     & META=YSD_SM%YCSBT, DESCR=YSD_SMD, &
     & ACTIVE=ASSOCIATED(YSD_SM%YCSBT))

    IF (YSD_SMD%NDIM == 0) THEN
      SURFVARS%GSD_SM%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSD_SMD%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_SM%F_GROUP = FIELD_4D(DATA=SD_SM)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_WS=>YDSURF%SD_WS, YSD_WS=>YDSURF%YSD_WS, YSD_WSD=>YDSURF%YSD_WSD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WS_CHAR', &
     & VARIABLE=SURFVARS%GSD_WS%VCHAR, ARRAY=SD_WS, &
     & META=YSD_WS%YCHAR, DESCR=YSD_WSD, &
     & ACTIVE=ASSOCIATED(YSD_WS%YCHAR))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WS_USTOKES', &
     & VARIABLE=SURFVARS%GSD_WS%VUSTOKES, ARRAY=SD_WS, &
     & META=YSD_WS%YUSTOKES, DESCR=YSD_WSD, &
     & ACTIVE=ASSOCIATED(YSD_WS%YUSTOKES))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WS_VSTOKES', &
     & VARIABLE=SURFVARS%GSD_WS%VVSTOKES, ARRAY=SD_WS, &
     & META=YSD_WS%YVSTOKES, DESCR=YSD_WSD, &
     & ACTIVE=ASSOCIATED(YSD_WS%YVSTOKES))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WS_PHIOC', &
     & VARIABLE=SURFVARS%GSD_WS%VPHIOC, ARRAY=SD_WS, &
     & META=YSD_WS%YPHIOC, DESCR=YSD_WSD, &
     & ACTIVE=ASSOCIATED(YSD_WS%YPHIOC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WS_PHIAW', &
     & VARIABLE=SURFVARS%GSD_WS%VPHIAW, ARRAY=SD_WS, &
     & META=YSD_WS%YPHIAW, DESCR=YSD_WSD, &
     & ACTIVE=ASSOCIATED(YSD_WS%YPHIAW))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WS_TAUOC', &
     & VARIABLE=SURFVARS%GSD_WS%VTAUOC, ARRAY=SD_WS, &
     & META=YSD_WS%YTAUOC, DESCR=YSD_WSD, &
     & ACTIVE=ASSOCIATED(YSD_WS%YTAUOC))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WS_EMEAN', &
     & VARIABLE=SURFVARS%GSD_WS%VEMEAN, ARRAY=SD_WS, &
     & META=YSD_WS%YEMEAN, DESCR=YSD_WSD, &
     & ACTIVE=ASSOCIATED(YSD_WS%YEMEAN))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WS_FMEAN', &
     & VARIABLE=SURFVARS%GSD_WS%VFMEAN, ARRAY=SD_WS, &
     & META=YSD_WS%YFMEAN, DESCR=YSD_WSD, &
     & ACTIVE=ASSOCIATED(YSD_WS%YFMEAN))

    IF (YSD_WSD%NDIM == 0) THEN
      SURFVARS%GSD_WS%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_WS%F_GROUP = FIELD_3D(DATA=SD_WS)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_WW=>YDSURF%SD_WW, YSD_WW=>YDSURF%YSD_WW, YSD_WWD=>YDSURF%YSD_WWD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WW_U10N', &
     & VARIABLE=SURFVARS%GSD_WW%VU10N, ARRAY=SD_WW, &
     & META=YSD_WW%YU10N, DESCR=YSD_WWD, &
     & ACTIVE=ASSOCIATED(YSD_WW%YU10N))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WW_V10N', &
     & VARIABLE=SURFVARS%GSD_WW%VV10N, ARRAY=SD_WW, &
     & META=YSD_WW%YV10N, DESCR=YSD_WWD, &
     & ACTIVE=ASSOCIATED(YSD_WW%YV10N))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WW_RHO', &
     & VARIABLE=SURFVARS%GSD_WW%VRHO, ARRAY=SD_WW, &
     & META=YSD_WW%YRHO, DESCR=YSD_WWD, &
     & ACTIVE=ASSOCIATED(YSD_WW%YRHO))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WW_ZIL', &
     & VARIABLE=SURFVARS%GSD_WW%VZIL, ARRAY=SD_WW, &
     & META=YSD_WW%YZIL, DESCR=YSD_WWD, &
     & ACTIVE=ASSOCIATED(YSD_WW%YZIL))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WW_CIF', &
     & VARIABLE=SURFVARS%GSD_WW%VCIF, ARRAY=SD_WW, &
     & META=YSD_WW%YCIF, DESCR=YSD_WWD, &
     & ACTIVE=ASSOCIATED(YSD_WW%YCIF))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WW_CLK', &
     & VARIABLE=SURFVARS%GSD_WW%VCLK, ARRAY=SD_WW, &
     & META=YSD_WW%YCLK, DESCR=YSD_WWD, &
     & ACTIVE=ASSOCIATED(YSD_WW%YCLK))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WW_UCURW', &
     & VARIABLE=SURFVARS%GSD_WW%VUCURW, ARRAY=SD_WW, &
     & META=YSD_WW%YUCURW, DESCR=YSD_WWD, &
     & ACTIVE=ASSOCIATED(YSD_WW%YUCURW))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_WW_VCURW', &
     & VARIABLE=SURFVARS%GSD_WW%VVCURW, ARRAY=SD_WW, &
     & META=YSD_WW%YVCURW, DESCR=YSD_WWD, &
     & ACTIVE=ASSOCIATED(YSD_WW%YVCURW))

    IF (YSD_WWD%NDIM == 0) THEN
      SURFVARS%GSD_WW%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_WW%F_GROUP = FIELD_3D(DATA=SD_WW)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_XA=>YDSURF%SD_XA, YSD_XA=>YDSURF%YSD_XA, YSD_XAD=>YDSURF%YSD_XAD)

    IF (YSD_XAD%NDIM == 0) THEN
      SURFVARS%GSD_XA%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSD_XAD%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_XA%F_GROUP = FIELD_4D(DATA=SD_XA)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_DI=>YDSURF%SD_DI, YSD_DI=>YDSURF%YSD_DI, YSD_DID=>YDSURF%YSD_DID)
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_DI_XEDR', &
     & VARIABLE=SURFVARS%GSD_DI%VXEDR, ARRAY=SD_DI, &
     & META=YSD_DI%YXEDR, DESCR=YSD_DID, &
     & ACTIVE=ASSOCIATED(YSD_DI%YXEDR))

    IF (YSD_DID%NDIM == 0) THEN
      SURFVARS%GSD_DI%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSD_DID%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_DI%F_GROUP = FIELD_4D(DATA=SD_DI)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_XP=>YDSURF%SD_XP, YSD_XP=>YDSURF%YSD_XP, YSD_XPD=>YDSURF%YSD_XPD)
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_XP_PRECIP', &
     & VARIABLE=SURFVARS%GSD_XP%VPRECIP, ARRAY=SD_XP, &
     & META=YSD_XP%YPRECIP, DESCR=YSD_XPD, &
     & ACTIVE=ASSOCIATED(YSD_XP%YPRECIP))

    IF (YSD_XPD%NDIM == 0) THEN
      SURFVARS%GSD_XP%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSD_XPD%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_XP%F_GROUP = FIELD_4D(DATA=SD_XP)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_XP2=>YDSURF%SD_XP2, YSD_XP2=>YDSURF%YSD_XP2, YSD_XP2D=>YDSURF%YSD_XP2D)
    CALL SELF%CREATE_SURFACE_VARIABLE_3D(NAME='SD_XP2_PRECIP2', &
     & VARIABLE=SURFVARS%GSD_XP2%VPRECIP2, ARRAY=SD_XP2, &
     & META=YSD_XP2%YPRECIP2, DESCR=YSD_XP2D, &
     & ACTIVE=ASSOCIATED(YSD_XP2%YPRECIP2))

    IF (YSD_XP2D%NDIM == 0) THEN
      SURFVARS%GSD_XP2%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=MAX(1,YSD_XP2D%NLEVS), NDIM=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_XP2%F_GROUP = FIELD_4D(DATA=SD_XP2)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_X2=>YDSURF%SD_X2, YSD_X2=>YDSURF%YSD_X2, YSD_X2D=>YDSURF%YSD_X2D)

    IF (YSD_X2D%NDIM == 0) THEN
      SURFVARS%GSD_X2%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_X2%F_GROUP = FIELD_3D(DATA=SD_X2)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_SFO=>YDSURF%SD_SFO, YSD_SFO=>YDSURF%YSD_SFO, YSD_SFOD=>YDSURF%YSD_SFOD)

    IF (YSD_SFOD%NDIM == 0) THEN
      SURFVARS%GSD_SFO%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_SFO%F_GROUP = FIELD_3D(DATA=SD_SFO)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_SFL=>YDSURF%SD_SFL, YSD_SFL=>YDSURF%YSD_SFL, YSD_SFLD=>YDSURF%YSD_SFLD)

    IF (YSD_SFLD%NDIM == 0) THEN
      SURFVARS%GSD_SFL%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_SFL%F_GROUP = FIELD_3D(DATA=SD_SFL)
    END IF
    END ASSOCIATE
    ASSOCIATE(SD_VC=>YDSURF%SD_VC, YSD_VC=>YDSURF%YSD_VC, YSD_VCD=>YDSURF%YSD_VCD)
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VC_A', &
     & VARIABLE=SURFVARS%GSD_VC%VA, ARRAY=SD_VC, &
     & META=YSD_VC%YA, DESCR=YSD_VCD, &
     & ACTIVE=ASSOCIATED(YSD_VC%YA))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VC_B', &
     & VARIABLE=SURFVARS%GSD_VC%VB, ARRAY=SD_VC, &
     & META=YSD_VC%YB, DESCR=YSD_VCD, &
     & ACTIVE=ASSOCIATED(YSD_VC%YB))
    CALL SELF%CREATE_SURFACE_VARIABLE_2D(NAME='SD_VC_C', &
     & VARIABLE=SURFVARS%GSD_VC%VC, ARRAY=SD_VC, &
     & META=YSD_VC%YC, DESCR=YSD_VCD, &
     & ACTIVE=ASSOCIATED(YSD_VC%YC))

    IF (YSD_VCD%NDIM == 0) THEN
      SURFVARS%GSD_VC%F_GROUP = CREATE_TEMPORARY(GEOM=SELF%GEOM, NLEV=1, PERSISTENT=PERSISTENT)
    ELSE
      SURFVARS%GSD_VC%F_GROUP = FIELD_3D(DATA=SD_VC)
    END IF
    END ASSOCIATE

  END SUBROUTINE FIELD_REGISTRY_REGISTER_SURFACE_FIELDS

END MODULE FIELD_REGISTRY_MOD
