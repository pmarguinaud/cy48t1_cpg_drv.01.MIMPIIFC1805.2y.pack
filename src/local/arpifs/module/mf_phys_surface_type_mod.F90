
MODULE MF_PHYS_SURFACE_TYPE_MOD

USE PARKIND1, ONLY : JPIM, JPRB
USE SURFACE_VARIABLES_MOD, ONLY: SURFACE_VARIABLES
USE SURFACE_VIEWS_MODULE
USE YOMDYN, ONLY : TDYN

IMPLICIT NONE

TYPE MF_PHYS_SURF_TYPE
  ! --------------------------------------
  ! ----  Surface field group views  -----
  TYPE(SURFACE_VIEW_GROUP_SOILB) :: GSP_SB
  TYPE(SURFACE_VIEW_GROUP_SNOWG) :: GSP_SG
  TYPE(SURFACE_VIEW_GROUP_LAKEB) :: GSP_SL
  TYPE(SURFACE_VIEW_GROUP_RESVR) :: GSP_RR
  TYPE(SURFACE_VIEW_GROUP_CLS) :: GSP_CL
  TYPE(SURFACE_VIEW_GROUP_OML) :: GSP_OM
  TYPE(SURFACE_VIEW_GROUP_EXTRP) :: GSP_EP
  TYPE(SURFACE_VIEW_GROUP_XTRP2) :: GSP_X2
  TYPE(SURFACE_VIEW_GROUP_CANRI) :: GSP_CI
  TYPE(SURFACE_VIEW_GROUP_VARSF) :: GSD_VF
  TYPE(SURFACE_VIEW_GROUP_VCLIH) :: GSD_VH
  TYPE(SURFACE_VIEW_GROUP_VCLIK) :: GSD_VK
  TYPE(SURFACE_VIEW_GROUP_VCLIP) :: GSD_VP
  TYPE(SURFACE_VIEW_GROUP_VCLIV) :: GSD_VV
  TYPE(SURFACE_VIEW_GROUP_VCLIA) :: GSD_VA
  TYPE(SURFACE_VIEW_GROUP_VCLIN) :: GSD_VN
  TYPE(SURFACE_VIEW_GROUP_VDIAGO2) :: GSD_V2
  TYPE(SURFACE_VIEW_GROUP_VDIAGO3) :: GSD_V3
  TYPE(SURFACE_VIEW_GROUP_VDIAG) :: GSD_VD
  TYPE(SURFACE_VIEW_GROUP_SATSIM) :: GSD_SM
  TYPE(SURFACE_VIEW_GROUP_WAVES) :: GSD_WS
  TYPE(SURFACE_VIEW_GROUP_WAM) :: GSD_WW
  TYPE(SURFACE_VIEW_GROUP_VEXTRA) :: GSD_XA
  TYPE(SURFACE_VIEW_GROUP_VEXTRDI) :: GSD_DI
  TYPE(SURFACE_VIEW_GROUP_VPRECIP) :: GSD_XP
  TYPE(SURFACE_VIEW_GROUP_VPRECIP2) :: GSD_XP2
  TYPE(SURFACE_VIEW_GROUP_VEXTR2) :: GSD_X2
  TYPE(SURFACE_VIEW_GROUP_SFORC) :: GSD_SFO
  TYPE(SURFACE_VIEW_GROUP_SFLUX) :: GSD_SFL
  TYPE(SURFACE_VIEW_GROUP_VO3ABC) :: GSD_VC

CONTAINS
  PROCEDURE :: INIT => MF_PHYS_SURF_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => MF_PHYS_SURF_TYPE_UPDATE_VIEW
  PROCEDURE :: SET9TO0 => MF_PHYS_SURF_TYPE_SET9TO0
  PROCEDURE :: SET1TO9 => MF_PHYS_SURF_TYPE_SET1TO9
  PROCEDURE :: SET1TO0 => MF_PHYS_SURF_TYPE_SET1TO0
  PROCEDURE :: SET0TO1 => MF_PHYS_SURF_TYPE_SET0TO1
  PROCEDURE :: PHTFILT => MF_PHYS_SURF_TYPE_PHTFILT
  PROCEDURE :: FINAL => MF_PHYS_SURF_TYPE_FINAL
END TYPE MF_PHYS_SURF_TYPE


CONTAINS

  SUBROUTINE MF_PHYS_SURF_TYPE_INIT(SELF, SURFVARS)
    CLASS(MF_PHYS_SURF_TYPE) :: SELF
    TYPE(SURFACE_VARIABLES), TARGET, INTENT(INOUT) :: SURFVARS

    CALL SELF%GSP_SB%INIT(SURFVARS%GSP_SB)
    CALL SELF%GSP_SG%INIT(SURFVARS%GSP_SG)
    CALL SELF%GSP_SL%INIT(SURFVARS%GSP_SL)
    CALL SELF%GSP_RR%INIT(SURFVARS%GSP_RR)
    CALL SELF%GSP_CL%INIT(SURFVARS%GSP_CL)
    CALL SELF%GSP_OM%INIT(SURFVARS%GSP_OM)
    CALL SELF%GSP_EP%INIT(SURFVARS%GSP_EP)
    CALL SELF%GSP_X2%INIT(SURFVARS%GSP_X2)
    CALL SELF%GSP_CI%INIT(SURFVARS%GSP_CI)
    CALL SELF%GSD_VF%INIT(SURFVARS%GSD_VF)
    CALL SELF%GSD_VH%INIT(SURFVARS%GSD_VH)
    CALL SELF%GSD_VK%INIT(SURFVARS%GSD_VK)
    CALL SELF%GSD_VP%INIT(SURFVARS%GSD_VP)
    CALL SELF%GSD_VV%INIT(SURFVARS%GSD_VV)
    CALL SELF%GSD_VA%INIT(SURFVARS%GSD_VA)
    CALL SELF%GSD_VN%INIT(SURFVARS%GSD_VN)
    CALL SELF%GSD_V2%INIT(SURFVARS%GSD_V2)
    CALL SELF%GSD_V3%INIT(SURFVARS%GSD_V3)
    CALL SELF%GSD_VD%INIT(SURFVARS%GSD_VD)
    CALL SELF%GSD_SM%INIT(SURFVARS%GSD_SM)
    CALL SELF%GSD_WS%INIT(SURFVARS%GSD_WS)
    CALL SELF%GSD_WW%INIT(SURFVARS%GSD_WW)
    CALL SELF%GSD_XA%INIT(SURFVARS%GSD_XA)
    CALL SELF%GSD_DI%INIT(SURFVARS%GSD_DI)
    CALL SELF%GSD_XP%INIT(SURFVARS%GSD_XP)
    CALL SELF%GSD_XP2%INIT(SURFVARS%GSD_XP2)
    CALL SELF%GSD_X2%INIT(SURFVARS%GSD_X2)
    CALL SELF%GSD_SFO%INIT(SURFVARS%GSD_SFO)
    CALL SELF%GSD_SFL%INIT(SURFVARS%GSD_SFL)
    CALL SELF%GSD_VC%INIT(SURFVARS%GSD_VC)

  END SUBROUTINE MF_PHYS_SURF_TYPE_INIT

  SUBROUTINE MF_PHYS_SURF_TYPE_UPDATE_VIEW(SELF, BLOCK_INDEX)
    ! Extract local array views from field objects
    CLASS(MF_PHYS_SURF_TYPE) :: SELF
    INTEGER(KIND=JPIM), INTENT(IN) :: BLOCK_INDEX

    CALL SELF%GSP_SB%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSP_SG%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSP_SL%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSP_RR%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSP_CL%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSP_OM%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSP_EP%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSP_X2%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSP_CI%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_VF%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_VH%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_VK%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_VP%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_VV%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_VA%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_VN%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_V2%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_V3%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_VD%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_SM%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_WS%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_WW%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_XA%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_DI%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_XP%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_XP2%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_X2%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_SFO%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_SFL%UPDATE_VIEW(BLOCK_INDEX)
    CALL SELF%GSD_VC%UPDATE_VIEW(BLOCK_INDEX)

  END SUBROUTINE MF_PHYS_SURF_TYPE_UPDATE_VIEW

  SUBROUTINE MF_PHYS_SURF_TYPE_SET9TO0(SELF)
    ! Field update operation for timestepping schemes
    CLASS(MF_PHYS_SURF_TYPE) :: SELF

    CALL SELF%GSP_SB%SET9TO0()
    CALL SELF%GSP_SG%SET9TO0()
    CALL SELF%GSP_SL%SET9TO0()
    CALL SELF%GSP_RR%SET9TO0()
    CALL SELF%GSP_CL%SET9TO0()
    CALL SELF%GSP_OM%SET9TO0()
    CALL SELF%GSP_EP%SET9TO0()
    CALL SELF%GSP_X2%SET9TO0()
    CALL SELF%GSP_CI%SET9TO0()
  END SUBROUTINE MF_PHYS_SURF_TYPE_SET9TO0

  SUBROUTINE MF_PHYS_SURF_TYPE_SET1TO9(SELF)
    ! Field update operation for timestepping schemes
    CLASS(MF_PHYS_SURF_TYPE) :: SELF

    CALL SELF%GSP_SB%SET1TO9()
    CALL SELF%GSP_SG%SET1TO9()
    CALL SELF%GSP_SL%SET1TO9()
    CALL SELF%GSP_RR%SET1TO9()
    CALL SELF%GSP_CL%SET1TO9()
    CALL SELF%GSP_OM%SET1TO9()
    CALL SELF%GSP_EP%SET1TO9()
    CALL SELF%GSP_X2%SET1TO9()
    CALL SELF%GSP_CI%SET1TO9()
  END SUBROUTINE MF_PHYS_SURF_TYPE_SET1TO9

  SUBROUTINE MF_PHYS_SURF_TYPE_SET1TO0(SELF)
    ! Field update operation for timestepping schemes
    CLASS(MF_PHYS_SURF_TYPE) :: SELF

    CALL SELF%GSP_SB%SET1TO0()
    CALL SELF%GSP_SG%SET1TO0()
    CALL SELF%GSP_SL%SET1TO0()
    CALL SELF%GSP_RR%SET1TO0()
    CALL SELF%GSP_CL%SET1TO0()
    CALL SELF%GSP_OM%SET1TO0()
    CALL SELF%GSP_EP%SET1TO0()
    CALL SELF%GSP_X2%SET1TO0()
    CALL SELF%GSP_CI%SET1TO0()
  END SUBROUTINE MF_PHYS_SURF_TYPE_SET1TO0

  SUBROUTINE MF_PHYS_SURF_TYPE_SET0TO1(SELF)
    ! Field update operation for timestepping schemes
    CLASS(MF_PHYS_SURF_TYPE) :: SELF

    CALL SELF%GSP_SB%SET0TO1()
    CALL SELF%GSP_SG%SET0TO1()
    CALL SELF%GSP_SL%SET0TO1()
    CALL SELF%GSP_RR%SET0TO1()
    CALL SELF%GSP_CL%SET0TO1()
    CALL SELF%GSP_OM%SET0TO1()
    CALL SELF%GSP_EP%SET0TO1()
    CALL SELF%GSP_X2%SET0TO1()
    CALL SELF%GSP_CI%SET0TO1()
  END SUBROUTINE MF_PHYS_SURF_TYPE_SET0TO1

  SUBROUTINE MF_PHYS_SURF_TYPE_PHTFILT(SELF, YDDYN)
    ! Field update operation for timestepping schemes
    CLASS(MF_PHYS_SURF_TYPE) :: SELF
    TYPE(TDYN), INTENT(IN) :: YDDYN

    CALL SELF%GSP_SB%PHTFILT(YDDYN)
    CALL SELF%GSP_SG%PHTFILT(YDDYN)
    CALL SELF%GSP_SL%PHTFILT(YDDYN)
    CALL SELF%GSP_RR%PHTFILT(YDDYN)
    CALL SELF%GSP_CL%PHTFILT(YDDYN)
    CALL SELF%GSP_OM%PHTFILT(YDDYN)
    CALL SELF%GSP_EP%PHTFILT(YDDYN)
    CALL SELF%GSP_X2%PHTFILT(YDDYN)
    CALL SELF%GSP_CI%PHTFILT(YDDYN)
  END SUBROUTINE MF_PHYS_SURF_TYPE_PHTFILT

  SUBROUTINE MF_PHYS_SURF_TYPE_FINAL(SELF)
    ! Finalize underlying field storage
    CLASS(MF_PHYS_SURF_TYPE) :: SELF

  END SUBROUTINE MF_PHYS_SURF_TYPE_FINAL

END MODULE MF_PHYS_SURFACE_TYPE_MOD
