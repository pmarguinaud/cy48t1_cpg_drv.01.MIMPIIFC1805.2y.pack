SUBROUTINE APL_ARPEGE_HYDRO_BUDGET (YDMF_PHYS_BASE_STATE, YDCPG_DIM, YDCPG_GPAR, YDMF_PHYS,    &
& YDMF_PHYS_SURF, YDMODEL, PC3, PCN, PDSA_C1, PDSA_C2, PFLU_FEVI, PFLU_NEIJ, PFLU_VEG, &
& PFPLSL, PFPLSN, PWFC, PWLMX, PWPMX, PWSEQ, PWSMX)

USE PARKIND1, ONLY : JPIM, JPRB

USE MF_PHYS_BASE_STATE_TYPE_MOD &
                       , ONLY : MF_PHYS_BASE_STATE_TYPE
USE CPG_DIM_TYPE_MOD   , ONLY : CPG_DIM_TYPE
USE CPG_TYPE_MOD       , ONLY : CPG_MISC_TYPE, CPG_DYN_TYPE, &
                              & CPG_SL2_TYPE, CPG_GPAR_TYPE
USE MF_PHYS_TYPE_MOD   , ONLY : MF_PHYS_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY : MF_PHYS_SURF_TYPE
USE SURFACE_FIELDS_MIX , ONLY : TSURF
USE TYPE_MODEL         , ONLY : MODEL


IMPLICIT NONE

TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT(IN)    :: YDMF_PHYS_BASE_STATE
TYPE(CPG_DIM_TYPE),             INTENT(IN)    :: YDCPG_DIM
TYPE(CPG_GPAR_TYPE),            INTENT(INOUT) :: YDCPG_GPAR
TYPE(MF_PHYS_TYPE),             INTENT(INOUT) :: YDMF_PHYS
TYPE(MF_PHYS_SURF_TYPE),        INTENT(INOUT) :: YDMF_PHYS_SURF
TYPE(MODEL),                    INTENT(IN)    :: YDMODEL
REAL(KIND=JPRB),                INTENT(IN)    :: PC3(YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PCN(YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PDSA_C1 (YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PDSA_C2 (YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PFLU_FEVI (YDCPG_DIM%KLON, 1:YDCPG_DIM%KTSSG+1)
REAL(KIND=JPRB),                INTENT(IN)    :: PFLU_NEIJ (YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PFLU_VEG (YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PFPLSL(YDCPG_DIM%KLON,0:YDCPG_DIM%KFLEVG)
REAL(KIND=JPRB),                INTENT(IN)    :: PFPLSN(YDCPG_DIM%KLON,0:YDCPG_DIM%KFLEVG)
REAL(KIND=JPRB),                INTENT(IN)    :: PWFC(YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PWLMX(YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PWPMX(YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PWSEQ(YDCPG_DIM%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PWSMX(YDCPG_DIM%KLON)

#include "acdrov.intfb.h"

INTEGER (KIND=JPIM) :: JLON


! BILAN HYDRIQUE DU SOL 
IF ( YDMODEL%YRML_PHY_MF%YRARPHY%LMSE ) THEN
  DO JLON=YDCPG_DIM%KIDIA,YDCPG_DIM%KFDIA
    YDCPG_GPAR%RAIN(JLON)=PFPLSL(JLON,YDCPG_DIM%KFLEVG)+YDMF_PHYS%OUT%FPLCL(JLON,YDCPG_DIM%KFLEVG)
    YDCPG_GPAR%SNOW(JLON)=PFPLSN(JLON,YDCPG_DIM%KFLEVG)+YDMF_PHYS%OUT%FPLCN(JLON,YDCPG_DIM%KFLEVG)
  ENDDO
ELSE
  IF ( YDMODEL%YRML_PHY_MF%YRPHY%LSOLV ) THEN
    CALL ACDROV ( YDMODEL%YRML_PHY_MF, YDCPG_DIM%KIDIA, YDCPG_DIM%KFDIA, YDCPG_DIM%KLON, YDCPG_DIM%KFLEVG,              &
    & YDCPG_DIM%YRSURF%YSP_SBD%NLEVS, YDMF_PHYS%OUT%FPLCL, YDMF_PHYS%OUT%FPLCN, PFPLSL, PFPLSN, YDMF_PHYS%OUT%FRSO,               &
    & YDMF_PHYS%OUT%FRTH, PDSA_C1, PDSA_C2, PC3, PCN, YDMF_PHYS%OUT%CT, YDMF_PHYS_SURF%GSD_VV%PD2, YDMF_PHYS%OUT%FEVV,  &
    & YDMF_PHYS%OUT%FTR, YDMF_PHYS_SURF%GSD_VV%PLAI, PFLU_NEIJ, PFLU_VEG, PWFC, PWPMX, YDMF_PHYS_BASE_STATE%YGSP_RR%FC, &
    & PWLMX, PWSEQ, PWSMX, YDMF_PHYS%OUT%FCHSP, YDMF_PHYS%OUT%FCLL, YDMF_PHYS%OUT%FCLN, YDMF_PHYS%OUT%FCS,              &
    & PFLU_FEVI, YDMF_PHYS%OUT%FEVL, YDMF_PHYS%OUT%FEVN, YDMF_PHYS_SURF%GSD_VF%PLSM, YDMF_PHYS_BASE_STATE%YGSP_SG%F,    &
    & YDMF_PHYS_BASE_STATE%YGSP_SB%T, YDMF_PHYS_BASE_STATE%YGSP_RR%T, YDMF_PHYS_BASE_STATE%YGSP_SB%Q,                   &
    & YDMF_PHYS_BASE_STATE%YGSP_SB%TL, YDMF_PHYS_BASE_STATE%YGSP_RR%W, YDMF_PHYS_BASE_STATE%YGSP_RR%IC,                 &
    & YDMF_PHYS%OUT%FGEL, YDMF_PHYS%OUT%FGELS, YDMF_PHYS%OUT%FLWSP, YDMF_PHYS%OUT%FONTE, YDMF_PHYS%OUT%RUISP,           &
    & YDMF_PHYS%OUT%RUISL, YDMF_PHYS%OUT%RUISS)
  ENDIF
ENDIF


END SUBROUTINE
