SUBROUTINE APL_ARPEGE_OCEANIC_FLUXES (YDMF_PHYS_BASE_STATE, YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS, YDMF_PHYS_SURF, &
& YDMODEL, LDHMT, PCDROV, PCEROV, PCHROV, PDPHIT, PDPHIV, PDSA_RS, PFLU_CD, PFLU_CDN, PFLU_CH, PFLU_QSATS)

!**** *APL_ARPEGE_OCEANIC_FLUXES*  

!     Author. 
!     ------- 
!      Philippe Marguinaud *METEO-FRANCE*
!      Original : 28-04-2021

USE YOMHOOK, ONLY : LHOOK, DR_HOOK
USE PARKIND1, ONLY : JPIM, JPRB

USE GEOMETRY_MOD       , ONLY : GEOMETRY
USE MF_PHYS_BASE_STATE_TYPE_MOD &
                       , ONLY : MF_PHYS_BASE_STATE_TYPE
USE CPG_OPTS_TYPE_MOD  , ONLY : CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MF_PHYS_TYPE_MOD   , ONLY : MF_PHYS_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD &
                       , ONLY : MF_PHYS_SURF_TYPE
USE TYPE_MODEL         , ONLY : MODEL


IMPLICIT NONE

TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT(IN)    :: YDMF_PHYS_BASE_STATE
TYPE(CPG_BNDS_TYPE),            INTENT(IN)    :: YDCPG_BNDS
TYPE(CPG_OPTS_TYPE),            INTENT(IN)    :: YDCPG_OPTS
TYPE(MF_PHYS_TYPE),             INTENT(INOUT) :: YDMF_PHYS
TYPE(MF_PHYS_SURF_TYPE),        INTENT(INOUT) :: YDMF_PHYS_SURF
TYPE(MODEL),                    INTENT(IN)    :: YDMODEL
LOGICAL,                        INTENT(IN)    :: LDHMT
REAL(KIND=JPRB),                INTENT(INOUT) :: PCDROV(YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(INOUT) :: PCEROV(YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(INOUT) :: PCHROV(YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PDPHIT(YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PDPHIV(YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PDSA_RS (YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(INOUT) :: PFLU_CD (YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(INOUT) :: PFLU_CDN (YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(INOUT) :: PFLU_CH (YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(IN)    :: PFLU_QSATS (YDCPG_OPTS%KLON)

#include "acfluso.intfb.h"

REAL(KIND=JPRB) :: ZCE(YDCPG_OPTS%KLON)
REAL(KIND=JPRB) :: ZCRTI(YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM) :: JLON

REAL (KIND=JPRB) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_OCEANIC_FLUXES', 0, ZHOOK_HANDLE)

! OCEANIC FLUXES COMPUTATION (IF NOT SURFEX)  

IF ((.NOT.YDMODEL%YRML_PHY_MF%YRARPHY%LMSE)) THEN

!=PARALLEL

  DO JLON=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
    ZCRTI(JLON) = 1.0_JPRB/(YDMF_PHYS_BASE_STATE%YGSP_RR%T(JLON)*PDSA_RS(JLON))
  ENDDO
  CALL ACFLUSO (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF, YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG,      &
  & YDMF_PHYS_BASE_STATE%YCPG_DYN%PHI, YDMF_PHYS_BASE_STATE%YCPG_DYN%PHIF, YDMF_PHYS_BASE_STATE%YCPG_PHY%PREHYD,   &
  & YDMF_PHYS_BASE_STATE%YCPG_PHY%PREHYDF, YDMF_PHYS_BASE_STATE%Q, YDMF_PHYS_BASE_STATE%T, YDMF_PHYS_BASE_STATE%U, &
  & YDMF_PHYS_BASE_STATE%V, PDPHIT, PDPHIV, YDMF_PHYS%OUT%GZ0, YDMF_PHYS_SURF%GSD_VF%PLSM,                         &
  & PFLU_QSATS, ZCRTI, YDMF_PHYS_BASE_STATE%YGSP_RR%T, LDHMT, PFLU_CD, PFLU_CDN, PCDROV, ZCE, PCEROV,              &
  & PFLU_CH, PCHROV, YDMF_PHYS%OUT%QCLS, YDMF_PHYS%OUT%RHCLS, YDMF_PHYS%OUT%TCLS, YDMF_PHYS%OUT%UCLS,              &
  & YDMF_PHYS%OUT%VCLS, YDMF_PHYS%OUT%UGST, YDMF_PHYS%OUT%VGST)

!=END PARALLEL

ELSE

!=PARALLEL

  DO JLON=YDCPG_BNDS%KIDIA,YDCPG_BNDS%KFDIA
    ZCE   (JLON) = PFLU_CH   (JLON)
    PCEROV(JLON) = PCHROV(JLON)
  ENDDO

!=END PARALLEL

ENDIF

IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_OCEANIC_FLUXES', 1, ZHOOK_HANDLE)

END SUBROUTINE APL_ARPEGE_OCEANIC_FLUXES
