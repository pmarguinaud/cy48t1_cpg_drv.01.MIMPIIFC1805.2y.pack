SUBROUTINE APL_WIND_GUST (YDGEOMETRY, YDMF_PHYS_BASE_STATE, YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS, &
& YDVARS, YDMODEL, KMOC_CLPH, PBLH, PDCAPE)

!**** *APL_WIND_GUST*  

!     Author. 
!     ------- 
!      Philippe Marguinaud *METEO-FRANCE*
!      Original : 28-04-2021

USE YOMHOOK, ONLY : LHOOK, DR_HOOK
USE PARKIND1, ONLY : JPIM, JPRB

USE GEOMETRY_MOD       , ONLY : GEOMETRY
USE MF_PHYS_BASE_STATE_TYPE_MOD &
                       , ONLY : MF_PHYS_BASE_STATE_TYPE
USE CPG_OPTS_TYPE_MOD  , ONLY : CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MF_PHYS_TYPE_MOD   , ONLY : MF_PHYS_TYPE
USE FIELD_VARIABLES_MOD, ONLY : FIELD_VARIABLES
USE TYPE_MODEL         , ONLY : MODEL


IMPLICIT NONE

TYPE(GEOMETRY),                 INTENT(IN)    :: YDGEOMETRY
TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT(IN)    :: YDMF_PHYS_BASE_STATE
TYPE(CPG_BNDS_TYPE),            INTENT(IN)    :: YDCPG_BNDS
TYPE(CPG_OPTS_TYPE),            INTENT(IN)    :: YDCPG_OPTS
TYPE(MF_PHYS_TYPE),             INTENT(INOUT) :: YDMF_PHYS
TYPE(FIELD_VARIABLES),          INTENT(INOUT) :: YDVARS
TYPE(MODEL),                    INTENT(IN)    :: YDMODEL
INTEGER (KIND=JPIM),            INTENT(OUT)   :: KMOC_CLPH (YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(OUT)   :: PBLH(YDCPG_OPTS%KLON)
REAL(KIND=JPRB),                INTENT(OUT)   :: PDCAPE(YDCPG_OPTS%KLON)

#include "accldia.intfb.h"

REAL (KIND=JPRB) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST', 0, ZHOOK_HANDLE)

! WIND GUST COMPUTATION
IF (YDMODEL%YRML_PHY_MF%YRPHY2%LRAFTKE) THEN

!=PARALLEL

  YDMF_PHYS%OUT%CAPE(:)=0._JPRB
  PDCAPE(:)=0._JPRB
  CALL ACCLDIA(YDMODEL%YRCST, YDCPG_OPTS%LXCLP, YDCPG_OPTS%LXTGST, YDCPG_OPTS%LXXGST, YDMODEL%YRML_PHY_MF%YRPHY,         &
  & YDMODEL%YRML_PHY_MF%YRPHY2, YDMODEL%YRML_PHY_MF%YRTOPH,                                                              &
  & YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDMF_PHYS%OUT%UCLS, YDMF_PHYS%OUT%VCLS,      &
  & YDMF_PHYS_BASE_STATE%U, YDMF_PHYS_BASE_STATE%V, YDMF_PHYS%OUT%CAPE, PDCAPE, YDMF_PHYS_BASE_STATE%TKE,                &
  & YDMF_PHYS_BASE_STATE%YCPG_DYN%PHIF, YDVARS%GEOMETRY%OROG%T0, YDMF_PHYS%OUT%UGST, YDMF_PHYS%OUT%VGST,                 &
  & PBLH, KMOC_CLPH)

!=END PARALLEL

ENDIF

IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST', 1, ZHOOK_HANDLE)

END SUBROUTINE APL_WIND_GUST
