SUBROUTINE APLPAR2INTFLEX(YGFL,YDPHY,KPROMA, KST, KEND, KFLEV, &
 & PDIFCQ , PDIFCQI, PDIFCQL, PDIFCS ,PDIFEXT,&
 & PDIFTQ , PDIFTQI, PDIFTQL, PDIFTS ,&
 & PFCCQL , PFCCQN , PFCSQL , PFCSQN ,&
 & PFPLSL , PFPLSN , PFPLCL,  PFPLCN, &
 & PFESL  , PFESN  , PFECL  , PFECN  ,&
 & PFASL  , PFASN  , PFACL  , PFACN  ,&
 & PFCQLNG, PFCQING, PFCQRNG, PFCQSNG,&
 & PFCQNG , PFRMH  , PFRMQ  , PFRSO  , PFRTH  ,&
 & PSTRCU , PSTRCV , PSTRDU , PSTRDV ,&
 & PSTRTU , PSTRTV , PSTRMU , PSTRMV ,&
 & PDIFCQLC,PDIFCQIC,PFIMCC, &
 & PFEDQLC, PFEDQIC, PFEDQRC, PFEDQSC, &
 & PFCNEGQLC,PFCNEGQIC,PFCNEGQRC,PFCNEGQSC, &
 & PFTKE, &
 & PTENDTKE, PTENDEXT, PTENDEXT_DEP, &  !!! not in CPTEND_NEW
 & YDPROCSET)

! APLPAR2INTFLEX
! 
! Convert output of APLPAR into INTFLEX structure
!
!
! Author: 2013-11, D. Degrauwe
! 

USE PARKIND1, ONLY  : JPIM, JPRB

USE INTFLEX_MOD, ONLY : TYPE_INTPROCSET, TYPE_INTPROC, NEWINTPROC, NEWINTFIELD

USE YOMPHY, ONLY : TPHY

USE YOM_YGFL, ONLY : TYPE_GFLD
USE YOMHOOK   ,ONLY : LHOOK,   DR_HOOK

! PDIFCQ     : FLUX CONVECTIF D'HUMIDITE SPECIFIQUE (HORS COND. ET RR).
! PDIFCQI    : FLUX CONVECTIF D'EAU SOLIDE (HORS COND. ET RR).
! PDIFCQL    : FLUX CONVECTIF D'EAU LIQUIDE (HORS COND. ET RR).
! PDIFCS     : FLUX CONVECTIF D'ENTHALPIE .
! PDIFTQ     : FLUX TURBULENT (ET Q NEGATIF) D'HUMIDITE SPECIFIQUE.
! PDIFTQI    : FLUX TURBULENT (ET Q NEGATIF) D'EAU GLACE.
! PDIFTQL    : FLUX TURBULENT (ET Q NEGATIF) D'EAU LIQUIDE.
! PDIFTS     : FLUX TURBULENT D'ENTHALPIE (OU D'ENERGIE STATIQUE SECHE).
! PFCCQL     : FLUX DE CONDENSATION LIE AUX RR CONVECTIVES LIQUIDES.
! PFCCQN     : FLUX DE CONDENSATION LIE AUX RR CONVECTIVES NEIGEUSES.
! PFCSQL     : FLUX DE CONDENSATION LIE AUX RR STRATIFORMES LIQUIDES.
! PFCSQN     : FLUX DE CONDENSATION LIE AUX RR STRATIFORMES NEIGEUSES.
! PFPLCL     : PRECIPITATIONS CONVECTIVES SOUS FORME LIQUIDE.
! PFPLCN     : PRECIPITATIONS CONVECTIVES SOUS FORME NEIGE.
! PFPLSL     : PRECIPITATIONS STRATIFORMES SOUS FORME LIQUIDE.
! PFPLSN     : PRECIPITATIONS STRATIFORMES SOUS FORME NEIGE.
! PFRMH      : FLUX MESOSPHERIQUE D'ENTHALPIE.
! PFRSO      : FLUX DE RAYONNEMENT SOLAIRE.
! PFRTH      : FLUX DE RAYONNEMENT THERMIQUE.
! PSTRCU     : FLUX CONVECTIF DE QUANTITE DE MOUVEMENT "U".
! PSTRCV     : FLUX CONVECTIF DE QUANTITE DE MOUVEMENT "V".
! PSTRDU     : FLUX "GRAVITY WAVE DRAG" "U".
! PSTRDV     : FLUX "GRAVITY WAVE DRAG" "V".
! PSTRTU     : FLUX TURBULENT DE QUANTITE DE MOUVEMENT "U".
! PSTRTV     : FLUX TURBULENT DE QUANTITE DE MOUVEMENT "V".
! PSTRMU     : FLUX MESOSPHERIQUE DE QUANTITE DE MOUVEMENT "U".
! PSTRMV     : FLUX MESOSPHERIQUE DE QUANTITE DE MOUVEMENT "V".
! PDIFCQLC   : CONVECTIVE TRANSPORT FLUX OF QLC (LIQUID CONVECTIVE).
! PDIFCQIC   : CONVECTIVE TRANSPORT FLUX OF QIC (ICE CONVECTIVE).
! PFIMCC     : Q FLUX DUE TO ICING-MELTING FOLLOWING CONVECTIVE TRANSPORT OF CONVECTIVE LIQUID AND ICE WATER.
! PFEDQLC    : ENTRAINMENT-DETRAINMENT OF QLC AND QLR (LIQUID CONVECTIVE AND RESOLVED).
! PFEDQIC    : ENTRAINMENT-DETRAINMENT OF QIC AND QIR (ICE    CONVECTIVE AND RESOLVED).
! PFEDQRC    : ENTRAINMENT-DETRAINMENT OF QRC AND QRR (RAIN   CONVECTIVE AND RESOLVED).
! PFEDQSC    : ENTRAINMENT-DETRAINMENT OF QSC AND QSR (SNOW   CONVECTIVE AND RESOLVED).
! PFCNEGQLC  : CORRECT NEGATIVE VALUES OF QLC (LIQUID CONVECTIVE).
! PFCNEGQIC  : CORRECT NEGATIVE VALUES OF QIC (ICE    CONVECTIVE).
! PFCNEGQRC  : CORRECT NEGATIVE VALUES OF QRC (RAIN   CONVECTIVE).
! PFCNEGQSC  : CORRECT NEGATIVE VALUES OF QSC (SNOW   CONVECTIVE).

IMPLICIT NONE

TYPE(TPHY)        ,INTENT(IN)        :: YDPHY
TYPE(TYPE_GFLD)   ,INTENT(IN),TARGET :: YGFL
INTEGER(KIND=JPIM),INTENT(IN)    :: KPROMA 
INTEGER(KIND=JPIM),INTENT(IN)    :: KST 
INTEGER(KIND=JPIM),INTENT(IN)    :: KEND 
INTEGER(KIND=JPIM),INTENT(IN)    :: KFLEV 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFCQ  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFCQI (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFCQL (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFCS  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFTQ  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFTQI (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFTQL (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFTS  (KPROMA,0:KFLEV) 

REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCCQL  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCCQN  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCSQL  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCSQN  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFESL   (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFESN   (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFECL   (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFECN   (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFASL   (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFASN   (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFACL   (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFACN   (KPROMA,0:KFLEV) 


REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCQNG  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCQLNG (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCQING (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCQRNG (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCQSNG (KPROMA,0:KFLEV) 

REAL(KIND=JPRB)   ,INTENT(IN)    :: PFPLCL  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFPLCN  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFPLSL  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFPLSN  (KPROMA,0:KFLEV) 

REAL(KIND=JPRB)   ,INTENT(IN)    :: PFRMH   (KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFRMQ   (KPROMA,0:KFLEV)

REAL(KIND=JPRB)   ,INTENT(IN)    :: PFRSO   (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFRTH   (KPROMA,0:KFLEV)

REAL(KIND=JPRB)   ,INTENT(IN)    :: PSTRCU  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PSTRCV  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PSTRDU  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PSTRDV  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PSTRTU  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PSTRTV  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PSTRMU  (KPROMA,0:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PSTRMV  (KPROMA,0:KFLEV)

REAL(KIND=JPRB)   ,INTENT(IN)    :: PTENDTKE (KPROMA,1:KFLEV) 
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFTKE (KPROMA,0:KFLEV) 

REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFEXT (KPROMA,0:KFLEV,YGFL%NGFL_EXT)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PTENDEXT (KPROMA,1:KFLEV,YGFL%NGFL_EXT)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PTENDEXT_DEP (KPROMA,1:KFLEV,YGFL%NGFL_EXT)

REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFCQLC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PDIFCQIC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFIMCC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFEDQLC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFEDQIC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFEDQRC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFEDQSC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCNEGQLC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCNEGQIC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCNEGQRC(KPROMA,0:KFLEV)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PFCNEGQSC(KPROMA,0:KFLEV)

! output: set of processes 
TYPE(TYPE_INTPROCSET), INTENT(INOUT) :: YDPROCSET

! local variables
TYPE(TYPE_INTPROC), POINTER :: YLPROC
INTEGER(KIND=JPIM) :: JPROC_CP
INTEGER(KIND=JPIM) :: JGFL 
INTEGER(KIND=JPIM) :: JGFLQV, JGFLQI, JGFLQL, JGFLQR, JGFLQS
INTEGER(KIND=JPIM) :: JGFLQIC, JGFLQLC, JGFLQRC, JGFLQSC
INTEGER(KIND=JPIM) :: JGFLTKE, JGFLEXT
INTEGER(KIND=JPIM) :: JROF, JLEV

! pointers to fields for local use
REAL(KIND=JPRB), POINTER :: ZAUX(:,:)

REAL(KIND=JPRB) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK('APLPAR2INTFLEX',0,ZHOOK_HANDLE)
ASSOCIATE(YCOMP=>YGFL%YCOMP, NGFL_EXT=>YGFL%NGFL_EXT, &
 & LPTKE=>YDPHY%LPTKE, LGPCMT=>YDPHY%LGPCMT)
!
! 0. Preparations
!

! get indices of gfl variables
DO JGFL=1,UBOUND(YGFL%YCOMP,1)
  ! humidity
  IF (ASSOCIATED(YGFL%YQ,YGFL%YCOMP(JGFL))) JGFLQV = JGFL
  
  ! ALARO variables
  IF (ASSOCIATED(YGFL%YI,YGFL%YCOMP(JGFL))) JGFLQI = JGFL
  IF (ASSOCIATED(YGFL%YL,YGFL%YCOMP(JGFL))) JGFLQL = JGFL
  IF (ASSOCIATED(YGFL%YR,YGFL%YCOMP(JGFL))) JGFLQR = JGFL
  IF (ASSOCIATED(YGFL%YS,YGFL%YCOMP(JGFL))) JGFLQS = JGFL
  
  ! PCMT variables
  IF (ASSOCIATED(YGFL%YICONV,YGFL%YCOMP(JGFL))) JGFLQIC = JGFL
  IF (ASSOCIATED(YGFL%YLCONV,YGFL%YCOMP(JGFL))) JGFLQLC = JGFL
  IF (ASSOCIATED(YGFL%YRCONV,YGFL%YCOMP(JGFL))) JGFLQRC = JGFL
  IF (ASSOCIATED(YGFL%YSCONV,YGFL%YCOMP(JGFL))) JGFLQSC = JGFL
  
  ! tke
  IF (ASSOCIATED(YGFL%YTKE,YGFL%YCOMP(JGFL))) JGFLTKE = JGFL
  
  ! extra GFL variables
  IF ( NGFL_EXT> 0 ) THEN
    IF (ASSOCIATED(YGFL%YEXT,YGFL%YCOMP(JGFL:JGFL+NGFL_EXT-1))) JGFLEXT = JGFL
  ENDIF
  
ENDDO

! when no PCMT, point to regular species
IF (.NOT.LGPCMT) THEN
  JGFLQLC=JGFLQL
  JGFLQIC=JGFLQI
  JGFLQRC=JGFLQR
  JGFLQSC=JGFLQS
ENDIF

! process constructor
YLPROC=>NEWINTPROC(YDPROCSET,'Complete physics')


! 
! 1. Diffusive fluxes
! 

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFCQ', 'G','D',KGFL=JGFLQV)
ZAUX(KST:KEND,:)=PDIFCQ(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFTQ', 'G','D',KGFL=JGFLQV)
ZAUX(KST:KEND,:)=PDIFTQ(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFRMQ', 'G','D',KGFL=JGFLQV)
ZAUX(KST:KEND,:)=PFRMQ(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFCQI','G','D',KGFL=JGFLQI)
ZAUX(KST:KEND,:)=PDIFCQI(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFTQI','G','D',KGFL=JGFLQI)
ZAUX(KST:KEND,:)=PDIFTQI(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFCQL','G','D',KGFL=JGFLQL)
ZAUX(KST:KEND,:)=PDIFCQL(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFTQL','G','D',KGFL=JGFLQL)
ZAUX(KST:KEND,:)=PDIFTQL(KST:KEND,:)

IF (LGPCMT) THEN
  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFCQLC','G','D',KGFL=JGFLQLC)
  ZAUX(KST:KEND,:)=PDIFCQLC(KST:KEND,:)

  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFCQIC','G','D',KGFL=JGFLQIC)
  ZAUX(KST:KEND,:)=PDIFCQIC(KST:KEND,:)
ENDIF

! 
! 2. PseudoFluxes
! 

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCCQL','G','S',KGFL=JGFLQV,KGFLTARGET=JGFLQLC)
ZAUX(KST:KEND,:)=PFCCQL(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCCQN','G','S',KGFL=JGFLQV,KGFLTARGET=JGFLQIC)
ZAUX(KST:KEND,:)=PFCCQN(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCSQL','G','S',KGFL=JGFLQV,KGFLTARGET=JGFLQL)
ZAUX(KST:KEND,:)=PFCSQL(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCSQN','G','S',KGFL=JGFLQV,KGFLTARGET=JGFLQI)
ZAUX(KST:KEND,:)=PFCSQN(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFACL', 'G','S',KGFL=JGFLQLC,KGFLTARGET=JGFLQRC)
ZAUX(KST:KEND,:)=PFACL(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFACN', 'G','S',KGFL=JGFLQIC,KGFLTARGET=JGFLQSC)
ZAUX(KST:KEND,:)=PFACN(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFASL', 'G','S',KGFL=JGFLQL,KGFLTARGET=JGFLQR)
ZAUX(KST:KEND,:)=PFASL(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFASN', 'G','S',KGFL=JGFLQI,KGFLTARGET=JGFLQS)
ZAUX(KST:KEND,:)=PFASN(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFECL', 'G','S',KGFL=JGFLQRC,KGFLTARGET=JGFLQV)
ZAUX(KST:KEND,:)=PFECL(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFECN', 'G','S',KGFL=JGFLQSC,KGFLTARGET=JGFLQV)
ZAUX(KST:KEND,:)=PFECN(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFESL', 'G','S',KGFL=JGFLQR,KGFLTARGET=JGFLQV)
ZAUX(KST:KEND,:)=PFESL(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFESN', 'G','S',KGFL=JGFLQS,KGFLTARGET=JGFLQV)
ZAUX(KST:KEND,:)=PFESN(KST:KEND,:)

IF (LGPCMT) THEN
  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFEDQLC', 'G','S',KGFL=JGFLQLC,KGFLTARGET=JGFLQL)
  ZAUX(KST:KEND,:)=PFEDQLC(KST:KEND,:)

  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFEDQIC', 'G','S',KGFL=JGFLQIC,KGFLTARGET=JGFLQI)
  ZAUX(KST:KEND,:)=PFEDQIC(KST:KEND,:)
  
  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFEDQRC', 'G','S',KGFL=JGFLQRC,KGFLTARGET=JGFLQR)
  ZAUX(KST:KEND,:)=PFEDQRC(KST:KEND,:)

  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFEDQSC', 'G','S',KGFL=JGFLQSC,KGFLTARGET=JGFLQS)
  ZAUX(KST:KEND,:)=PFEDQSC(KST:KEND,:)

  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFIMCC', 'G','S',KGFL=JGFLQLC,KGFLTARGET=JGFLQIC)
  ZAUX(KST:KEND,:)=PFIMCC(KST:KEND,:)

ENDIF

! 
! 3. precipitation fluxes
! 
ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFPLCL','G','P',KGFL=JGFLQRC)
ZAUX(KST:KEND,:)=PFPLCL(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFPLCN','G','P',KGFL=JGFLQSC)
ZAUX(KST:KEND,:)=PFPLCN(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFPLSL','G','P',KGFL=JGFLQR)
ZAUX(KST:KEND,:)=PFPLSL(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFPLSN','G','P',KGFL=JGFLQS)
ZAUX(KST:KEND,:)=PFPLSN(KST:KEND,:)

! 
! 4. corrective fluxes
!
ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCQNG', 'G','C',KGFL=JGFLQV)
ZAUX(KST:KEND,:)=PFCQNG(KST:KEND,:)


ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCQLNG', 'G','C',KGFL=JGFLQL)
ZAUX(KST:KEND,:)=PFCQLNG(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCQING', 'G','C',KGFL=JGFLQI)
ZAUX(KST:KEND,:)=PFCQING(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCQRNG', 'G','C',KGFL=JGFLQR)
ZAUX(KST:KEND,:)=PFCQRNG(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCQSNG', 'G','C',KGFL=JGFLQS)
ZAUX(KST:KEND,:)=PFCQSNG(KST:KEND,:)

IF (LGPCMT) THEN
  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCNEGQLC', 'G','C',KGFL=JGFLQLC)
  ZAUX(KST:KEND,:)=PFCNEGQLC(KST:KEND,:)

  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCNEGQIC', 'G','C',KGFL=JGFLQIC)
  ZAUX(KST:KEND,:)=PFCNEGQIC(KST:KEND,:)

  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCNEGQRC', 'G','C',KGFL=JGFLQRC)
  ZAUX(KST:KEND,:)=PFCNEGQRC(KST:KEND,:)

  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFCNEGQSC', 'G','C',KGFL=JGFLQSC)
  ZAUX(KST:KEND,:)=PFCNEGQSC(KST:KEND,:)
ENDIF

! 
! 5. enthalpy fluxes
! 
ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFCS','H','F')
ZAUX(KST:KEND,:)=PDIFCS(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFTS','H','F')
ZAUX(KST:KEND,:)=PDIFTS(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFRMH','H','F')
ZAUX(KST:KEND,:)=PFRMH(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFRSO','H','F')
ZAUX(KST:KEND,:)=PFRSO(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFRTH','H','F')
ZAUX(KST:KEND,:)=PFRTH(KST:KEND,:)

! 
! 6. momentum fluxes
! 

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PSTRC','U','F')
ZAUX(KST:KEND,:)=PSTRCU(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PSTRC','V','F')
ZAUX(KST:KEND,:)=PSTRCV(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PSTRD','U','F')
ZAUX(KST:KEND,:)=PSTRDU(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PSTRD','V','F')
ZAUX(KST:KEND,:)=PSTRDV(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PSTRT','U','F')
ZAUX(KST:KEND,:)=PSTRTU(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PSTRT','V','F')
ZAUX(KST:KEND,:)=PSTRTV(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PSTRM','U','F')
ZAUX(KST:KEND,:)=PSTRMU(KST:KEND,:)

ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PSTRM','V','F')
ZAUX(KST:KEND,:)=PSTRMV(KST:KEND,:)

! 
! 7. TKE and extra GFL variables
! 

! tke
IF (LPTKE) THEN
  ! tendency
  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PTPTKE','G','T',KGFL=JGFLTKE)
  ZAUX(KST:KEND,:)=PTENDTKE(KST:KEND,:)
ELSE
  ! flux
  ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PFTKE','G','F',KGFL=JGFLTKE)
  ZAUX(KST:KEND,:)=PFTKE(KST:KEND,:)
ENDIF

! extra GFL tendencies and fluxes
IF (NGFL_EXT>0) THEN
  DO JGFL=1,NGFL_EXT
    ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PDIFEXT','G','F',KGFL=JGFLEXT+JGFL-1)
    ZAUX(KST:KEND,:)=PDIFEXT(KST:KEND,:,JGFL)
    ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PTENDEXT','G','T',KGFL=JGFLEXT+JGFL-1)
    ZAUX(KST:KEND,:)=PTENDEXT(KST:KEND,:,JGFL)
    ZAUX => NEWINTFIELD(YLPROC,KPROMA,KFLEV,'PTENDEXT_DEP','G','T',KGFL=JGFLEXT+JGFL-1)
    ZAUX(KST:KEND,:)=PTENDEXT_DEP(KST:KEND,:,JGFL)
  ENDDO
ENDIF


END ASSOCIATE
IF (LHOOK) CALL DR_HOOK('APLPAR2INTFLEX',1,ZHOOK_HANDLE)
END SUBROUTINE APLPAR2INTFLEX
