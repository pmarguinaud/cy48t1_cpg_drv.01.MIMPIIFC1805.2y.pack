SUBROUTINE MF_PHYS_MOCON (YDCPG_DIM, YDMF_PHYS, YDMF_PHYS_TMP, YDAPLPAR_TMP, YDMF_PHYS_STATE)

USE PARKIND1, ONLY : JPIM, JPRB

USE CPG_DIM_TYPE_MOD   , ONLY : CPG_DIM_TYPE
USE MF_PHYS_TYPE_MOD   , ONLY : MF_PHYS_TYPE, MF_PHYS_TMP_TYPE, APLPAR_TMP_TYPE
USE MF_PHYS_STATE_TYPE_MOD &
                       , ONLY : MF_PHYS_STATE_TYPE


IMPLICIT NONE

TYPE(CPG_DIM_TYPE),INTENT(IN)    :: YDCPG_DIM
TYPE(MF_PHYS_TYPE),INTENT(INOUT) :: YDMF_PHYS
TYPE(MF_PHYS_TMP_TYPE),INTENT(INOUT) :: YDMF_PHYS_TMP
TYPE(APLPAR_TMP_TYPE),INTENT(INOUT) :: YDAPLPAR_TMP
TYPE (MF_PHYS_STATE_TYPE) :: YDMF_PHYS_STATE


INTEGER (KIND=JPIM) :: JLEV
INTEGER (KIND=JPIM) :: JROF


  DO JLEV=1,YDCPG_DIM%KFLEVG
    DO JROF = YDCPG_DIM%KIDIA, YDCPG_DIM%KFDIA
      YDMF_PHYS%OUT%MOCON(JROF) = YDMF_PHYS%OUT%MOCON(JROF)+(YDAPLPAR_TMP%MSC%LCVQ(JROF,JLEV)-YDMF_PHYS_STATE%Q(JROF,JLEV)*&
       & YDMF_PHYS_STATE%DIV(JROF,JLEV))*YDMF_PHYS_STATE%YCPG_PHY%XYB%DELP(JROF,JLEV)&
       & *MAX(0,SIGN(1,JLEV-YDAPLPAR_TMP%MOC%CLPH(JROF)))  
    ENDDO
  ENDDO
  DO JROF = YDCPG_DIM%KIDIA, YDCPG_DIM%KFDIA
    YDMF_PHYS%OUT%MOCON(JROF) = YDMF_PHYS%OUT%MOCON(JROF)/(YDMF_PHYS_STATE%YCPG_PHY%PREHYD(JROF,YDCPG_DIM%KFLEVG)-YDMF_PHYS_STATE%YCPG_PHY%PREHYD(JROF,YDAPLPAR_TMP%MOC%CLPH(JROF)-1))
  ENDDO



END SUBROUTINE
