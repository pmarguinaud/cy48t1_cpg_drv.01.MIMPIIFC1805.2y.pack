SUBROUTINE WRITEPHYSIO(YDGEOMETRY,&
 & YDCPG_MISC,YDCPG_PHY0,YDCPG_PHY9,YDMF_PHYS,YDCPG_DYN0,YDCPG_DYN9,YDMF_PHYS_SURF,YDVARS,&
 & YDSURF,YDDPHY,YDRIP,YDML_PHY_MF,KEND, KST, KGL1, KGL2, KSTGLO,&
 & KSTEP  , KSGST  , KCSS   , PGELAM, PGEMU,&
 & PGM, PMU0, POROG, PRCORI, PRATATH, PRATATX,&
 & PCVGQ, PLCVQ,&
 & PCLON  , PSLON,&
 & PFTKE, PFEFB1,PFEFB2,PFEFB3,&
 & PFRMQ, &
 & PFEVI, &
 & PCD, PCDN, PCH, PC1, PC2, PEMISH, PNEIJ, PVEG ,&
 & PCPS, PLHS, PRS, PLH, PLSCPE, PQSAT, PQW, PTW,&
 & PQSATS, &
 & KCLPH  , &
 & PFPLCH, PFPLSH )

! --------------------------------------------------------------
! **** *writephysio* Write SCM input/output of physics on file.
! --------------------------------------------------------------
! Subject:
!     Write on files all inputs and some outputs from MF_PHYS
!     for profiles matching a given criteria.

! Method:
! Authors:  1999-03, J.M. Piriou / F. Bouyssel.
! Modifications:
!   2000-10, J.M. Piriou: use of a namelist for SCM extractions.
!   2002-03, J.M. Piriou: same arguments for writephysio as for MF_PHYS.
!        M.Hamrud      01-Oct-2003 CY28 Cleaning
!   2004-03: T. Kovacic : extracted subroutine WRITEPROFILE
!   2004-10, F. Bouyssel : cleaning
!   2007-05, F. Bouyssel : add PFCLL, PFCLN
!   2011-08, E. Bazile : add fields for WRITEMUSC (old recopie).
!   2013-11, Y. Bouteloup : EFB fields
!   K. Yessad (July 2014): Move some variables.
! --------------------------------------------------------------

USE MF_PHYS_TYPE_MOD   , ONLY : MF_PHYS_TYPE
USE CPG_TYPE_MOD       , ONLY : CPG_DYN_TYPE, CPG_PHY_TYPE, &
                              & CPG_MISC_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY : MF_PHYS_SURF_TYPE
USE FIELD_VARIABLES_MOD, ONLY : FIELD_VARIABLES
USE MODEL_PHYSICS_MF_MOD , ONLY : MODEL_PHYSICS_MF_TYPE
USE GEOMETRY_MOD , ONLY : GEOMETRY
USE SURFACE_FIELDS_MIX , ONLY : TSURF
USE PARKIND1  ,ONLY : JPIM    ,JPRB
USE YOMHOOK   ,ONLY : LHOOK   ,DR_HOOK
USE YOMLUN    ,ONLY : NULOUT
USE YOMRIP    ,ONLY : TRIP
USE YOMSCM    ,ONLY : NFRSCM, NSCMTS, NSCM_SPACE_S, GSCM_LON1, GSCM_LON2&
 & , GSCM_LAT1, GSCM_LAT2, GSCM_RADIUS, NSCM_ADD_SAMPL , LGSCM 
USE YOMDPHY   ,ONLY : TDPHY
USE YOMCST    ,ONLY : RA  
USE YOMCT3    ,ONLY : NSTEP
USE YOMLSFORC, ONLY : LMUSCLFA

! --------------------------------------------------------------

IMPLICIT NONE

TYPE(GEOMETRY)    ,INTENT(IN)    :: YDGEOMETRY
TYPE(CPG_MISC_TYPE),INTENT(INOUT):: YDCPG_MISC
TYPE(CPG_PHY_TYPE),INTENT(INOUT) :: YDCPG_PHY0
TYPE(CPG_PHY_TYPE),INTENT(INOUT) :: YDCPG_PHY9
TYPE(MF_PHYS_TYPE),INTENT(INOUT) :: YDMF_PHYS
TYPE(CPG_DYN_TYPE),INTENT(INOUT) :: YDCPG_DYN0
TYPE(CPG_DYN_TYPE),INTENT(INOUT) :: YDCPG_DYN9
TYPE(MF_PHYS_SURF_TYPE),INTENT(INOUT) :: YDMF_PHYS_SURF
TYPE(FIELD_VARIABLES),INTENT(INOUT) :: YDVARS
TYPE(TSURF)       ,INTENT(INOUT) :: YDSURF
TYPE(TDPHY)       ,INTENT(INOUT) :: YDDPHY
TYPE(MODEL_PHYSICS_MF_TYPE),INTENT(INOUT):: YDML_PHY_MF
TYPE(TRIP)        ,INTENT(INOUT) :: YDRIP
INTEGER(KIND=JPIM),INTENT(IN)    :: KEND 
INTEGER(KIND=JPIM),INTENT(IN)    :: KST 
INTEGER(KIND=JPIM),INTENT(IN)    :: KGL1
INTEGER(KIND=JPIM),INTENT(IN)    :: KGL2
INTEGER(KIND=JPIM),INTENT(IN)    :: KSTGLO
INTEGER(KIND=JPIM),INTENT(IN)    :: KSTEP,  KSGST, KCSS
REAL(KIND=JPRB)   ,INTENT(IN)    :: PGELAM(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PGEMU(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PGM(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PMU0(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: POROG(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PRCORI(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PRATATH(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PRATATX(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB),INTENT(IN)    :: PCVGQ(YDGEOMETRY%YRDIM%NPROMM,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),INTENT(IN)    :: PLCVQ(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),INTENT(IN)    :: PCLON(YDGEOMETRY%YRDIM%NPROMM)
REAL(KIND=JPRB),INTENT(IN)    :: PSLON(YDGEOMETRY%YRDIM%NPROMM)
REAL(KIND=JPRB),INTENT(IN) :: &
  & PFTKE(YDGEOMETRY%YRDIM%NPROMM,0:YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),INTENT(IN)    :: PFEFB1(YDGEOMETRY%YRDIM%NPROMM,0:YDGEOMETRY%YRDIMV%NFLEVG)  
REAL(KIND=JPRB),INTENT(IN)    :: PFEFB2(YDGEOMETRY%YRDIM%NPROMM,0:YDGEOMETRY%YRDIMV%NFLEVG)  
REAL(KIND=JPRB),INTENT(IN)    :: PFEFB3(YDGEOMETRY%YRDIM%NPROMM,0:YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),INTENT(IN)    :: PFRMQ(YDGEOMETRY%YRDIM%NPROMM,0:YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),INTENT(IN)    :: PFEVI(YDGEOMETRY%YRDIM%NPROMM,YDDPHY%NTSSG+1)
REAL(KIND=JPRB),INTENT(IN)    :: PCD(YDGEOMETRY%YRDIM%NPROMM), PCDN(YDGEOMETRY%YRDIM%NPROMM), PCH(YDGEOMETRY%YRDIM%NPROMM) 
REAL(KIND=JPRB),INTENT(IN)    :: PC1(YDGEOMETRY%YRDIM%NPROMM), PC2(YDGEOMETRY%YRDIM%NPROMM), PEMISH(YDGEOMETRY%YRDIM%NPROMM) 
REAL(KIND=JPRB),INTENT(IN)    :: PNEIJ(YDGEOMETRY%YRDIM%NPROMM) 
REAL(KIND=JPRB),INTENT(IN)    :: PVEG(YDGEOMETRY%YRDIM%NPROMM)
REAL(KIND=JPRB),INTENT(IN)    :: PQSATS(YDGEOMETRY%YRDIM%NPROMM)
REAL(KIND=JPRB),INTENT(IN)    :: PCPS(YDGEOMETRY%YRDIM%NPROMM)
REAL(KIND=JPRB),INTENT(IN)    :: PLHS(YDGEOMETRY%YRDIM%NPROMM)
REAL(KIND=JPRB),INTENT(IN)    :: PRS(YDGEOMETRY%YRDIM%NPROMM)
REAL(KIND=JPRB),INTENT(IN)    :: PLH(YDGEOMETRY%YRDIM%NPROMM,YDGEOMETRY%YRDIMV%NFLEVG),&
 & PLSCPE(YDGEOMETRY%YRDIM%NPROMM,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),INTENT(IN)    :: PQSAT(YDGEOMETRY%YRDIM%NPROMM,YDGEOMETRY%YRDIMV%NFLEVG),&
 & PQW(YDGEOMETRY%YRDIM%NPROMM,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),INTENT(IN)    :: PTW(YDGEOMETRY%YRDIM%NPROMM,YDGEOMETRY%YRDIMV%NFLEVG)
INTEGER(KIND=JPIM),INTENT(IN) :: KCLPH(YDGEOMETRY%YRDIM%NPROMM)
REAL(KIND=JPRB),INTENT(IN)    :: PFPLCH(YDGEOMETRY%YRDIM%NPROMA,0:YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB),INTENT(IN)    :: PFPLSH(YDGEOMETRY%YRDIM%NPROMA,0:YDGEOMETRY%YRDIMV%NFLEVG)

! --------------------------------------------------------------
INTEGER(KIND=JPIM) :: JSTEP,JLON
LOGICAL :: LLOK, LLTIME_OK
REAL(KIND=JPRB) :: ZLAT_MODELE,ZLON_MODELE,ZD,ZHOUR,ZRR,ZPI,ZREQUIRED
REAL(KIND=JPRB) :: ZHOOK_HANDLE

! --------------------------------------------------------------

#include "abor1.intfb.h"
#include "writeprofile.intfb.h"
#include "writemusc.intfb.h"

! --------------------------------------------------------------
IF (LHOOK) CALL DR_HOOK('WRITEPHYSIO',0,ZHOOK_HANDLE)
ASSOCIATE(YDDIM=>YDGEOMETRY%YRDIM,YDDIMV=>YDGEOMETRY%YRDIMV,YDGEM=>YDGEOMETRY%YRGEM, &
  & YDMP=>YDGEOMETRY%YRMP, YDVAB=>YDGEOMETRY%YRVAB, YDVETA=>YDGEOMETRY%YRVETA, YDVFE=>YDGEOMETRY%YRVFE)
ASSOCIATE(NPROMA=>YDDIM%NPROMA, NPROMM=>YDDIM%NPROMM, &
 & NFLEVG=>YDDIMV%NFLEVG, &
 & NTSSG=>YDDPHY%NTSSG, &
 & RSTATI=>YDRIP%RSTATI, TSTEP=>YDRIP%TSTEP)
! --------------------------------------------------------------

IF (LGSCM) THEN
! -------------------------------------------------
! Define criteria for choosing profiles.
! -------------------------------------------------

!-------------------------------------------------
! 1. Time sampling.
!-------------------------------------------------
ZHOUR=RSTATI/3600._JPRB ! time since the beginning of the prediction in hours.
IF(NSCMTS(0) == 0) THEN
  !
  ! -------------------------------------------------
  ! One time step over nfrscm.
  ! -------------------------------------------------
  !
  LLTIME_OK=MOD(NSTEP,NFRSCM) == 0
  WRITE(NULOUT,*) 'writephysio: nscmts(0) == 0: lltime_ok=',LLTIME_OK
ELSEIF(NSCMTS(0) > 0) THEN
  !
  ! -------------------------------------------------
  ! Explicit list of time steps.
  ! -------------------------------------------------
  !
  LLTIME_OK=.FALSE.
  DO JSTEP=1,NSCMTS(0)
    IF(NFRSCM*NSCMTS(JSTEP) == NSTEP) LLTIME_OK=.TRUE.
  ENDDO
  WRITE(NULOUT,*) 'writephysio: nscmts(0) > 0: NSTEP=',NSTEP,' lltime_ok=',LLTIME_OK
ELSE
  !
  ! -------------------------------------------------
  ! Explicit list of hours.
  ! -------------------------------------------------
  !
  LLTIME_OK=.FALSE.
  DO JSTEP=1,-NSCMTS(0)
    ZREQUIRED=-REAL(NFRSCM,JPRB)*NSCMTS(JSTEP) ! required time in hours.
    IF(ABS(ZHOUR-ZREQUIRED) <= TSTEP) LLTIME_OK=.TRUE.
  ENDDO
  WRITE(NULOUT,*) 'writephysio: expl list hours: lltime_ok=',LLTIME_OK
ENDIF

!-------------------------------------------------
! 2. Space sampling.
!-------------------------------------------------

! RAPPEL: en t042: 8000 pdg, en T199: 180000 pdg.

IF (LLTIME_OK) THEN
  DO JLON=KST,KEND
    !
    ! -------------------------------------------------
    ! Compute model grid-point lat/lon coordinates.
    ! -------------------------------------------------
    !
    ZLAT_MODELE=ASIN(PGEMU(JLON))
    ZPI=4._JPRB*ATAN(1.0_JPRB)
    ZLON_MODELE=MODULO(PGELAM(JLON)+ZPI,2.0_JPRB*ZPI)-ZPI
    !
    ! -------------------------------------------------
    ! Is this profile required by the user?
    ! -------------------------------------------------
    !
    LLOK=.FALSE.
    IF(NSCM_SPACE_S == 0) THEN
      !
      ! -------------------------------------------------
      ! Choose profiles close to a given location.
      ! -------------------------------------------------
      !
      ! Compute othodromic distance (in meters) between searched point and model grid-point.
      !
      ZD=COS(ZLAT_MODELE)*COS(GSCM_LAT1)*COS(ZLON_MODELE-GSCM_LON1)&
       & + SIN(ZLAT_MODELE)*SIN(GSCM_LAT1)  
      ZD=ACOS(ZD)*RA
      LLOK=ZD < GSCM_RADIUS

    ELSEIF(NSCM_SPACE_S == 1) THEN
      !
      ! -------------------------------------------------
      ! Choose profiles inside a given box (in (lon, lat)),
      ! with additional regular sampling inside that box.
      ! -------------------------------------------------
      !
      LLOK=ZLON_MODELE > GSCM_LON1&
       & .AND. ZLON_MODELE < GSCM_LON2&
       & .AND. ZLAT_MODELE > GSCM_LAT1&
       & .AND. ZLAT_MODELE < GSCM_LAT2&
       & .AND.MOD(JLON,NSCM_ADD_SAMPL) == 0  
    ELSEIF(NSCM_SPACE_S == 10) THEN
      !
      ! -------------------------------------------------
      ! Choose profiles depending on physical output.
      ! -------------------------------------------------
      !
      ZRR=YDMF_PHYS%OUT%FPLCL(JLON,NFLEVG)+YDMF_PHYS%OUT%FPLCN(JLON,NFLEVG)
      LLOK=ZRR > 0.0_JPRB
    ELSEIF(NSCM_SPACE_S < 0) THEN
      !
      ! -------------------------------------------------
      ! Choose one profile over -NSCM_SPACE_S.
      ! -------------------------------------------------
      !
      LLOK=MOD(JLON,-NSCM_SPACE_S) == 0
    ELSE
      WRITE (NULOUT,*) 'writephysio/ERROR: NSCM_SPACE_S unexpected!...'
      WRITE (NULOUT,*) NSCM_SPACE_S
      CALL ABOR1('writephysio/ERROR: NSCM_SPACE_S unexpected!')
    ENDIF
    IF (LLOK) THEN
      !
      ! -------------------------------------------------
      ! The grid-point is a desired profile.
      ! -------------------------------------------------
      !
      CALL WRITEPROFILE(YDGEOMETRY,YDSURF,YDDPHY,YDRIP,YDML_PHY_MF,'Profile.',JLON,ZLAT_MODELE,ZLON_MODELE,ZD,PGELAM, &
& PGEMU,PGM,PMU0,&
& POROG,YDCPG_DYN0%OROGL,YDCPG_DYN0%OROGM,PRCORI,PRATATH,PRATATX,YDMF_PHYS_SURF%GSD_VF%PLSM,YDMF_PHYS_SURF%GSD_VV%PARG,YDMF_PHYS_SURF%GSD_VV%PSAB,YDMF_PHYS_SURF%GSD_VF%PALBF,YDMF_PHYS_SURF%GSD_VF%PALBSF,YDMF_PHYS_SURF%GSD_VF%PEMISF,YDMF_PHYS_SURF%GSD_VV%PD2,YDMF_PHYS_SURF%GSD_VV%PIVEG,YDMF_PHYS_SURF%GSD_VV%PLAI,YDMF_PHYS%OUT%CT,YDMF_PHYS_SURF%GSD_VF%PZ0F,YDMF_PHYS_SURF%GSD_VV%PZ0H,YDMF_PHYS_SURF%GSD_VF%PZ0RLF, &
& YDMF_PHYS_SURF%GSD_VF%PGETRL,YDMF_PHYS_SURF%GSD_VF%PVRLAN,&
& YDMF_PHYS_SURF%GSD_VF%PVRLDI,YDMF_PHYS_SURF%GSD_VV%PRSMIN,YDMF_PHYS_SURF%GSD_VF%PVEG,YDMF_PHYS_SURF%GSD_VV%PHV,YDMF_PHYS_SURF%GSD_VA%PSEA,YDMF_PHYS_SURF%GSD_VA%PLAN,YDMF_PHYS_SURF%GSD_VA%PSOO,YDMF_PHYS_SURF%GSD_VA%PDES,YDMF_PHYS_SURF%GSD_VC%PGROUP,YDVARS%SP%T0,YDVARS%SP%DL,YDVARS%SP%DM,YDVARS%T%T0,YDVARS%T%DL,YDVARS%T%DM,YDVARS%Q%T0,YDVARS%Q%DL,YDVARS%Q%DM,YDVARS%U%T0, &
& YDVARS%V%T0,YDVARS%VOR%T0,&
& YDVARS%DIV%T0,PCVGQ,PLCVQ,YDMF_PHYS_SURF%GSP_RR%PT_T9,YDMF_PHYS_SURF%GSP_SB%PT_T9,YDMF_PHYS_SURF%GSP_RR%PFC_T9,YDMF_PHYS_SURF%GSP_RR%PW_T9,YDMF_PHYS_SURF%GSP_RR%PIC_T9,YDMF_PHYS_SURF%GSP_SB%PQ_T9,YDMF_PHYS_SURF%GSP_SB%PTL_T9,YDMF_PHYS_SURF%GSP_SG%PF_T9,YDMF_PHYS%OUT%DIFCQ,YDMF_PHYS%OUT%DIFCQN,YDMF_PHYS%OUT%DIFCQL,YDMF_PHYS%OUT%DIFCS,YDMF_PHYS%OUT%DIFTQ,YDMF_PHYS%OUT%DIFTQN,YDMF_PHYS%OUT%DIFTQL,YDMF_PHYS%OUT%DIFTS, &
& YDMF_PHYS%OUT%FCCQL,&
& YDMF_PHYS%OUT%FCCQN,YDMF_PHYS%OUT%FCSQL,YDMF_PHYS%OUT%FCSQN,YDMF_PHYS%OUT%FCQNG,YDMF_PHYS%OUT%FCQNNG,YDMF_PHYS%OUT%FCQLNG,YDMF_PHYS%OUT%FPLCL,YDMF_PHYS%OUT%FPLCN,YDMF_PHYS%OUT%FPLSL,YDMF_PHYS%OUT%FPLSN,YDMF_PHYS%OUT%FRSO,YDMF_PHYS%OUT%FRTH,YDMF_PHYS%OUT%STRCU,YDMF_PHYS%OUT%STRCV,YDMF_PHYS%OUT%STRDU,YDMF_PHYS%OUT%STRDV,YDMF_PHYS%OUT%STRTU, &
& YDMF_PHYS%OUT%STRTV,YDMF_PHYS%OUT%STRMU,&
& YDMF_PHYS%OUT%STRMV,YDMF_PHYS%OUT%FRMH,YDMF_PHYS%OUT%FCHOZ,YDCPG_MISC%NEB,YDCPG_MISC%QICE,YDCPG_MISC%QLI,YDCPG_MISC%RH,YDMF_PHYS%OUT%FCS,YDMF_PHYS%OUT%FCLL,YDMF_PHYS%OUT%FCLN,YDMF_PHYS%OUT%FEVL,YDMF_PHYS%OUT%FEVN,YDMF_PHYS%OUT%FEVV,YDMF_PHYS%OUT%FTR,YDMF_PHYS%OUT%FLWSP,YDMF_PHYS%OUT%FONTE,YDMF_PHYS%OUT%FGEL,YDMF_PHYS%OUT%FGELS,YDMF_PHYS%OUT%FRSODS, &
& YDMF_PHYS%OUT%FRSOPS,YDMF_PHYS%OUT%FRSOPT,&
& YDMF_PHYS%OUT%FRTHDS,YDCPG_MISC%QS,YDMF_PHYS%OUT%RUISL,YDMF_PHYS%OUT%RUISP,YDMF_PHYS%OUT%RUISS,YDMF_PHYS%OUT%UCLS,YDMF_PHYS%OUT%VCLS,YDMF_PHYS%OUT%TCLS,YDMF_PHYS%OUT%QCLS,YDMF_PHYS%OUT%RHCLS,YDCPG_MISC%CLCT,YDMF_PHYS%OUT%CLCH,YDMF_PHYS%OUT%CLCM,YDMF_PHYS%OUT%CLCL,YDMF_PHYS%OUT%CLCC,PFPLCH,PFPLSH,YDMF_PHYS_SURF%GSD_VH%PTCCH,YDMF_PHYS_SURF%GSD_VH%PSCCH, &
& YDMF_PHYS_SURF%GSD_VH%PBCCH,YDMF_PHYS_SURF%GSD_VH%PPBLH)
    ENDIF
  ENDDO
ENDIF

ENDIF ! (LGSCM)

IF (LMUSCLFA) THEN
   CALL WRITEMUSC(YDVETA,YDRIP,YDML_PHY_MF,KST,KEND,NPROMA,1,NFLEVG,KGL1,KGL2,KSTEP,KSGST,KCSS,YDCPG_DYN0%PHI,YDCPG_PHY0%PREHYD,YDCPG_DYN0%PHIF,YDCPG_PHY0%PREHYDF, &
& YDCPG_PHY0%XYB%ALPH,YDMF_PHYS_SURF%GSD_VV%PARG,YDMF_PHYS_SURF%GSD_VV%PD2,&
& YDCPG_PHY0%XYB%DELP,YDMF_PHYS_SURF%GSD_VV%PIVEG,YDMF_PHYS_SURF%GSD_VV%PLAI,YDCPG_PHY0%XYB%LNPR,YDCPG_PHY0%XYB%RDELP,YDMF_PHYS_SURF%GSD_VV%PRSMIN,YDMF_PHYS_SURF%GSD_VV%PSAB,YDMF_PHYS_SURF%GSD_VV%PZ0H,YDVARS%U%T0,YDVARS%V%T0,YDVARS%T%T0,YDVARS%Q%T0,YDVARS%I%T0,YDVARS%L%T0,YDVARS%S%T0,YDVARS%R%T0,YDVARS%G%T0,YDVARS%TKE%T0,YDVARS%EFB1%T0,YDVARS%EFB2%T0,YDVARS%EFB3%T0,YDCPG_DYN0%RCP%CP,PCVGQ,&
& YDCPG_DYN0%RCP%R,YDMF_PHYS_SURF%GSD_VH%PPBLH,YDMF_PHYS_SURF%GSP_SG%PF_T9,&
& YDMF_PHYS_SURF%GSP_SG%PA_T0,YDMF_PHYS_SURF%GSP_SG%PR_T0,YDMF_PHYS_SURF%GSP_SB%PT_T9,YDMF_PHYS_SURF%GSP_RR%PT_T9,YDMF_PHYS_SURF%GSP_RR%PFC_T9,YDMF_PHYS_SURF%GSP_SB%PQ_T9,YDMF_PHYS_SURF%GSP_SB%PTL_T9,YDMF_PHYS_SURF%GSP_RR%PW_T9,YDMF_PHYS_SURF%GSP_RR%PIC_T9,YDMF_PHYS_SURF%GSD_VV%PHV,YDCPG_DYN0%CTY%VVEL(:,1:),YDMF_PHYS%RAD%EMTD,YDMF_PHYS%RAD%EMTU,YDMF_PHYS%RAD%TRSW,PCLON,PSLON,YDMF_PHYS_SURF%GSD_VV%PALV,YDMF_PHYS_SURF%GSD_VF%PALBF,YDMF_PHYS_SURF%GSD_VF%PALBSF,YDMF_PHYS_SURF%GSD_VF%PEMISF, &
& YDMF_PHYS_SURF%GSD_VF%PGETRL,YDMF_PHYS_SURF%GSD_VF%PLSM,YDMF_PHYS_SURF%GSD_VF%PVEG,&
& YDMF_PHYS_SURF%GSD_VF%PZ0F,YDMF_PHYS_SURF%GSD_VF%PZ0RLF,YDMF_PHYS_SURF%GSD_VF%PVRLAN,YDMF_PHYS_SURF%GSD_VF%PVRLDI,PMU0,PGELAM,PGEMU,PGM,POROG,YDMF_PHYS%OUT%DIFCQ,YDMF_PHYS%OUT%DIFCQN,YDMF_PHYS%OUT%DIFCQL,YDMF_PHYS%OUT%DIFCS,YDMF_PHYS%OUT%DIFTQ,YDMF_PHYS%OUT%DIFTQN,YDMF_PHYS%OUT%DIFTQL,YDMF_PHYS%OUT%DIFTS, &
& YDMF_PHYS%OUT%FCCQL,YDMF_PHYS%OUT%FCCQN,YDMF_PHYS%OUT%FCSQL,&
& YDMF_PHYS%OUT%FCSQN,YDMF_PHYS%OUT%FCQNG,YDMF_PHYS%OUT%FCQNNG,YDMF_PHYS%OUT%FCQLNG,YDMF_PHYS%OUT%FCQRNG,YDMF_PHYS%OUT%FCQSNG,YDMF_PHYS%OUT%FPLCL,YDMF_PHYS%OUT%FPLCN,YDMF_PHYS%OUT%FPLSL,YDMF_PHYS%OUT%FPLSN,YDMF_PHYS%OUT%FPLSG,YDMF_PHYS%OUT%FPLSH,YDMF_PHYS%OUT%FRSO,YDMF_PHYS%OUT%FRSOC,YDMF_PHYS%OUT%FRTH,YDMF_PHYS%OUT%FRTHC, &
& YDMF_PHYS%OUT%STRCU,YDMF_PHYS%OUT%STRCV,YDMF_PHYS%OUT%STRDU,&
& YDMF_PHYS%OUT%STRDV,YDMF_PHYS%OUT%STRTU,YDMF_PHYS%OUT%STRTV,YDMF_PHYS%OUT%STRMU,YDMF_PHYS%OUT%STRMV,YDMF_PHYS%OUT%FRMH,PFRMQ,YDMF_PHYS%OUT%FCHOZ,PCPS,PLHS,PRS,PLH,PLSCPE,YDCPG_MISC%NEB,YDCPG_MISC%QICE,YDCPG_MISC%QLI,PQSAT,PQW,YDCPG_MISC%RH,PTW,YDMF_PHYS%OUT%ALB,PCD, &
& PCDN,PCH,PC1,&
& PC2,YDMF_PHYS%OUT%CT,PEMISH,YDMF_PHYS%OUT%FCHSP,YDMF_PHYS%OUT%FCLL,YDMF_PHYS%OUT%FCLN,YDMF_PHYS%OUT%FCS,PFEVI,YDMF_PHYS%OUT%FEVL,YDMF_PHYS%OUT%FEVN,YDMF_PHYS%OUT%FEVV,YDMF_PHYS%OUT%FTR,YDMF_PHYS%OUT%FLWSP,YDMF_PHYS%OUT%FONTE,YDMF_PHYS_SURF%GSP_SG%PT_T1,YDMF_PHYS%OUT%FGEL,YDMF_PHYS%OUT%FGELS,YDMF_PHYS%OUT%FRSODS,YDMF_PHYS%OUT%FRSOPS, &
& YDMF_PHYS%OUT%FRSOPT,YDMF_PHYS%OUT%FRSOLU,&
& YDMF_PHYS%OUT%FRTHDS,YDMF_PHYS%OUT%FPFPSL,YDMF_PHYS%OUT%FPFPSN,YDMF_PHYS%OUT%FPFPCL,YDMF_PHYS%OUT%FPFPCN,YDMF_PHYS%OUT%FPEVPSL,YDMF_PHYS%OUT%FPEVPSN,YDMF_PHYS%OUT%FPEVPCL,YDMF_PHYS%OUT%FPEVPCN,PFTKE,PFEFB1,PFEFB2,PFEFB3,YDMF_PHYS%OUT%GZ0,YDMF_PHYS%OUT%GZ0H,PNEIJ, &
& PVEG,YDCPG_MISC%QS,PQSATS,&
& YDMF_PHYS%OUT%RUISL,YDMF_PHYS%OUT%RUISP,YDMF_PHYS%OUT%RUISS,YDMF_PHYS%OUT%UCLS,YDMF_PHYS%OUT%VCLS,YDMF_PHYS%OUT%TCLS,YDMF_PHYS%OUT%QCLS,YDMF_PHYS%OUT%RHCLS,YDCPG_MISC%CLCT,YDMF_PHYS%OUT%CLCH,YDMF_PHYS%OUT%CLCM,YDMF_PHYS%OUT%CLCL,YDMF_PHYS%OUT%CLCC,YDMF_PHYS%OUT%CAPE,YDMF_PHYS%OUT%CTOP,KCLPH,YDMF_PHYS%OUT%CLPH,YDMF_PHYS%OUT%UGST,YDMF_PHYS%OUT%VGST,'WRITEMUSC')

ENDIF

! --------------------------------------------------------------
END ASSOCIATE
END ASSOCIATE
IF (LHOOK) CALL DR_HOOK('WRITEPHYSIO',1,ZHOOK_HANDLE)
END SUBROUTINE WRITEPHYSIO
