SUBROUTINE WRITEPROFILE(YDGEOMETRY,&
 & YDCPG_MISC,YDMF_PHYS,PRDG_CVGQ, PRDG_LCVQ, PRDG_MU0,YDCPG_DYN0,YDMF_PHYS_SURF,YDVARS,&
 & YDSURF,YDDPHY,YDRIP,YDML_PHY_MF,CDNAME,&
 & KLON, PLAT_MODELE, PLON_MODELE, PD, PGELAM, PGEMU,&
 & PGM, POROG, PRCORI, PRATATH, PRATATX,&
 & PPFL_FPLCH, PPFL_FPLSH)

! --------------------------------------------------------------
! **** *WRITEPROFILE* Write SCM input/output of physics on file.
! --------------------------------------------------------------
! Subject:
!     Write on files all inputs and some outputs from MF_PHYS
!     for one point.

! Method:
! Authors:  1999-03, J.M. Piriou / F. Bouyssel.
! Modifications:
!   2000-10, J.M. Piriou: use of a namelist for SCM extractions.
!   2002-03, J.M. Piriou: same arguments for writephysio as for MF_PHYS.
!        M.Hamrud      01-Oct-2003 CY28 Cleaning
!   2004-03, T. Kovacic : extracted this subroutine from WRITEPHYSIO
!   2004-10, F. Bouyssel : cleaning
!   2005-03, F. Bouyssel : TEQH
!   2007-05, F. Bouyssel : add PFCLL, PFCLN
!   T. Wilhelmsson (Sept 2013) Geometry and setup refactoring.
!   K. Yessad (July 2014): Move some variables.
! --------------------------------------------------------------

USE MF_PHYS_TYPE_MOD   , ONLY : MF_PHYS_TYPE
USE CPG_TYPE_MOD       , ONLY : CPG_DYN_TYPE, CPG_PHY_TYPE, &
                              & CPG_MISC_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY : MF_PHYS_SURF_TYPE
USE FIELD_VARIABLES_MOD, ONLY : FIELD_VARIABLES
USE MODEL_PHYSICS_MF_MOD , ONLY : MODEL_PHYSICS_MF_TYPE
USE GEOMETRY_MOD , ONLY : GEOMETRY
USE SURFACE_FIELDS_MIX , ONLY : TSURF
USE PARKIND1  ,ONLY : JPIM    ,JPRB
USE YOMHOOK   ,ONLY : LHOOK   ,DR_HOOK
USE YOMLUN   , ONLY : NULFP15
USE YOMRIP0  , ONLY : NINDAT  ,NSSSSS
USE YOMRIP   , ONLY : TRIP
USE YOMSCM   , ONLY : NSCM_SPACE_S   
USE YOMDPHY  , ONLY : TDPHY
USE YOMCT3   , ONLY : NSTEP

IMPLICIT NONE

!-------------------------------------------------

TYPE(GEOMETRY)    ,INTENT(IN)    :: YDGEOMETRY
TYPE(CPG_MISC_TYPE),INTENT(INOUT):: YDCPG_MISC
TYPE(MF_PHYS_TYPE),INTENT(INOUT) :: YDMF_PHYS

REAL (KIND=JPRB),  INTENT(IN)    :: PRDG_CVGQ (KLON, 1:YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB),  INTENT(IN)    :: PRDG_LCVQ (KLON, 1:YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB),  INTENT(IN)    :: PRDG_MU0 (KLON)
TYPE(CPG_DYN_TYPE),INTENT(INOUT) :: YDCPG_DYN0
TYPE(MF_PHYS_SURF_TYPE),INTENT(INOUT) :: YDMF_PHYS_SURF
TYPE(FIELD_VARIABLES),INTENT(INOUT) :: YDVARS
TYPE(TSURF)       ,INTENT(INOUT) :: YDSURF
TYPE(TDPHY)       ,INTENT(INOUT) :: YDDPHY
TYPE(MODEL_PHYSICS_MF_TYPE),INTENT(INOUT):: YDML_PHY_MF
TYPE(TRIP)        ,INTENT(INOUT) :: YDRIP
CHARACTER(LEN=*)  ,INTENT(IN)    :: CDNAME
INTEGER(KIND=JPIM),INTENT(IN)    :: KLON
REAL(KIND=JPRB)   ,INTENT(IN)    :: PLAT_MODELE
REAL(KIND=JPRB)   ,INTENT(IN)    :: PLON_MODELE
REAL(KIND=JPRB)   ,INTENT(IN)    :: PD
REAL(KIND=JPRB)   ,INTENT(IN)    :: PGELAM(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PGEMU(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PGM(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: POROG(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PRCORI(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PRATATH(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)   ,INTENT(IN)    :: PRATATX(YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)  ,INTENT(IN), OPTIONAL :: PPFL_FPLCH (YDGEOMETRY%YRDIM%NPROMA, 0:YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)  ,INTENT(IN), OPTIONAL :: PPFL_FPLSH (YDGEOMETRY%YRDIM%NPROMA, 0:YDGEOMETRY%YRDIMV%NFLEVG)
CHARACTER (LEN = 200) ::  CLDURH,CLFS,CLNOMP
INTEGER(KIND=JPIM) :: IULLFA
REAL(KIND=JPRB) :: ZHOOK_HANDLE

#include "ecr1d.intfb.h"
#include "ecr2df.intfb.h"
#include "ecr2dv.intfb.h"
#include "ecrpnebh.intfb.h"
#include "nomfi.intfb.h"

!-------------------------------------------------

IF (LHOOK) CALL DR_HOOK('WRITEPROFILE',0,ZHOOK_HANDLE)
ASSOCIATE(YDDIM=>YDGEOMETRY%YRDIM,YDDIMV=>YDGEOMETRY%YRDIMV,YDGEM=>YDGEOMETRY%YRGEM, YDMP=>YDGEOMETRY%YRMP, &
  & YDVAB=>YDGEOMETRY%YRVAB, YDVETA=>YDGEOMETRY%YRVETA, YDVFE=>YDGEOMETRY%YRVFE, &
  & YDPHY=>YDML_PHY_MF%YRPHY,YDARPHY=>YDML_PHY_MF%YRARPHY,YDPHY2=>YDML_PHY_MF%YRPHY2,YDPHY0=>YDML_PHY_MF%YRPHY0)

ASSOCIATE(TEQK=>YDPHY0%TEQK, TEQH=>YDPHY0%TEQH, TEQC=>YDPHY0%TEQC, &
 & NTSSG=>YDDPHY%NTSSG, &
 & NPROMA=>YDDIM%NPROMA, NPROMM=>YDDIM%NPROMM, &
 & LMSE=>YDARPHY%LMSE, &
 & YSD_VVD=>YDSURF%YSD_VVD, YSP_SBD=>YDSURF%YSP_SBD, YSD_VND=>YDSURF%YSD_VND, &
 & YSD_VAD=>YDSURF%YSD_VAD, &
 & NFLEVG=>YDDIMV%NFLEVG, &
 & LSOLV=>YDPHY%LSOLV, LNEBCO=>YDPHY%LNEBCO, LNEBR=>YDPHY%LNEBR, &
 & LO3ABC=>YDPHY%LO3ABC, LSNV=>YDPHY%LSNV, LGWDC=>YDPHY%LGWDC, &
 & TSPHY=>YDPHY2%TSPHY, RSTATI=>YDRIP%RSTATI)
! -------------------------------------------------

WRITE(CLDURH,FMT='(I4.4)') NSTEP
WRITE(CLFS,FMT='(2A)') '+',CLDURH(1:4)
      !
      ! -------------------------------------------------
      ! Look for a free file name.
      ! -------------------------------------------------
      !
CALL NOMFI(CDNAME,CLFS,CLNOMP)
      !
      ! -------------------------------------------------
      ! Open SCM file.
      ! -------------------------------------------------
      !
IULLFA=NULFP15
CALL LFAOUV(IULLFA,CLNOMP,'W')
      !
      ! -------------------------------------------------
      ! Write input to physics.
      ! Write integers from physics.
      ! -------------------------------------------------
      !
CALL LFAECRR(IULLFA,'LONGITUDE',PLON_MODELE,1)
CALL LFAECRR(IULLFA,'LATITUDE',PLAT_MODELE,1)
CALL ECR1D  (IULLFA,'PGM',PGM,KLON,NPROMA)
CALL LFAECRR(IULLFA,'TEQK',TEQK,1)
CALL LFAECRR(IULLFA,'TEQC',TEQC,1)
CALL LFAECRR(IULLFA,'TEQH',TEQH,1)
CALL LFAECRI(IULLFA,'KINDAT',NINDAT,1)
CALL LFAECRI(IULLFA,'KSSSSS',NSSSSS,1)
CALL LFAECRR(IULLFA,'RSTATI',RSTATI,1)
CALL LFAECRI(IULLFA,'NSTEP',NSTEP,1)
CALL LFAECRI(IULLFA,'KLEV',NFLEVG,1)
CALL LFAECRR(IULLFA,'TSPHY',TSPHY,1)
CALL LFAECRI(IULLFA,'KVCLIV',YSD_VVD%NUMFLDS,1)
CALL LFAECRI(IULLFA,'KNEBH',YSD_VND%NUMFLDS,1)
CALL LFAECRI(IULLFA,'KCSS',YSP_SBD%NLEVS,1)
CALL LFAECRI(IULLFA,'KSGST',NTSSG,1)
IF(NSCM_SPACE_S == 0) THEN
  CALL LFAECRR(IULLFA,'DISTANCE',PD,1)
ENDIF
      !
      ! -------------------------------------------------
      ! Write fields from time 0.
      ! -------------------------------------------------
      !
CALL ECR2DV(IULLFA,'PVORT0',YDVARS%VOR%T0,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PDIVT0',YDVARS%DIV%T0,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PUT0',YDVARS%U%T0,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PVT0',YDVARS%V%T0,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PTT0',YDVARS%T%T0,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PQT0',YDVARS%Q%T0,KLON,NPROMA,NFLEVG)
CALL ECR1D (IULLFA,'PSPT0',YDVARS%SP%T0,KLON,NPROMA)
      !
      !
CALL ECR2DV(IULLFA,'PTT0L',YDVARS%T%DL,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PQT0L',YDVARS%Q%DL,KLON,NPROMA,NFLEVG)
CALL ECR1D (IULLFA,'PSPT0L',YDVARS%SP%DL,KLON,NPROMA)
      !
      !
CALL ECR2DV(IULLFA,'PTT0M',YDVARS%T%DM,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PQT0M',YDVARS%Q%DM,KLON,NPROMA,NFLEVG)
CALL ECR1D (IULLFA,'PSPT0M',YDVARS%SP%DM,KLON,NPROMA)
      !
      !
CALL ECR1D(IULLFA,'PTS0',YDMF_PHYS_SURF%GSP_RR%PT_T9,KLON,NPROMA)
CALL ECRPNEBH(IULLFA,'PTP0',YDMF_PHYS_SURF%GSP_SB%PT_T9,KLON,NPROMA,1)
IF (.NOT.LMSE) THEN
  CALL ECR1D(IULLFA,'PWL0',YDMF_PHYS_SURF%GSP_RR%PFC_T9,KLON,NPROMA)
ENDIF
CALL ECR1D(IULLFA,'PWS0',YDMF_PHYS_SURF%GSP_RR%PW_T9,KLON,NPROMA)
CALL ECR1D(IULLFA,'PWSI0',YDMF_PHYS_SURF%GSP_RR%PIC_T9,KLON,NPROMA)
CALL ECR1D(IULLFA,'PWP0',YDMF_PHYS_SURF%GSP_SB%PQ_T9,KLON,NPROMA)
CALL ECR1D(IULLFA,'PWPI0',YDMF_PHYS_SURF%GSP_SB%PTL_T9,KLON,NPROMA)
CALL ECR1D(IULLFA,'PSNS0',YDMF_PHYS_SURF%GSP_SG%PF_T9,KLON,NPROMA)
      !
      ! -------------------------------------------------
      ! Write constant fields.
      ! -------------------------------------------------
      !
CALL ECR1D(IULLFA,'PRCORI',PRCORI,KLON,NPROMA)
CALL ECR1D(IULLFA,'PGEMU',PGEMU,KLON,NPROMA)
CALL ECR1D(IULLFA,'PGELAM',PGELAM,KLON,NPROMA)
CALL ECR1D(IULLFA,'PRATATH',PRATATH,KLON,NPROMA)
CALL ECR1D(IULLFA,'PRATATX',PRATATX,KLON,NPROMA)
CALL ECR1D(IULLFA,'POROG',POROG,KLON,NPROMA)
CALL ECR1D(IULLFA,'POROGL',YDCPG_DYN0%OROGL,KLON,NPROMA)
CALL ECR1D(IULLFA,'POROGM',YDCPG_DYN0%OROGM,KLON,NPROMA)
CALL LFAECRR(IULLFA,'VAH',YDVAB%VAH,NFLEVG+1)
CALL LFAECRR(IULLFA,'VBH',YDVAB%VBH,NFLEVG+1)
      !
      ! -------------------------------------------------
      ! Write arrays in input to physics.
      ! -------------------------------------------------
      !
IF (LSOLV) THEN
  CALL ECR1D(IULLFA,'PARG',YDMF_PHYS_SURF%GSD_VV%PARG,KLON,NPROMA)
  CALL ECR1D(IULLFA,'PD2',YDMF_PHYS_SURF%GSD_VV%PD2,KLON,NPROMA)
  CALL ECR1D(IULLFA,'PIVEG',YDMF_PHYS_SURF%GSD_VV%PIVEG,KLON,NPROMA)
  CALL ECR1D(IULLFA,'PLAI',YDMF_PHYS_SURF%GSD_VV%PLAI,KLON,NPROMA)
  CALL ECR1D(IULLFA,'PRSMIN',YDMF_PHYS_SURF%GSD_VV%PRSMIN,KLON,NPROMA)
  IF (YSD_VVD%NUMFLDS >= 8) THEN
    CALL ECR1D(IULLFA,'PGZ0HF',YDMF_PHYS_SURF%GSD_VV%PZ0H,KLON,NPROMA)
  ENDIF
  CALL ECR1D(IULLFA,'PSAB',YDMF_PHYS_SURF%GSD_VV%PSAB,KLON,NPROMA)
ENDIF
IF (LSOLV) THEN
  CALL ECR1D(IULLFA,'PHV',YDMF_PHYS_SURF%GSD_VV%PHV,KLON,NPROMA)
ENDIF
IF (.NOT.LMSE) THEN
  CALL ECR1D(IULLFA,'PALBF',YDMF_PHYS_SURF%GSD_VF%PALBF,KLON,NPROMA)
  IF (LSNV) THEN
    CALL ECR1D(IULLFA,'PALBSF',YDMF_PHYS_SURF%GSD_VF%PALBSF,KLON,NPROMA)
  ENDIF
  CALL ECR1D(IULLFA,'PEMISF',YDMF_PHYS_SURF%GSD_VF%PEMISF,KLON,NPROMA)
ENDIF
CALL ECR1D(IULLFA,'PGETRL',YDMF_PHYS_SURF%GSD_VF%PGETRL,KLON,NPROMA)
CALL ECR1D(IULLFA,'PLSM',YDMF_PHYS_SURF%GSD_VF%PLSM,KLON,NPROMA)
CALL ECR1D(IULLFA,'PVEG0',YDMF_PHYS_SURF%GSD_VF%PVEG,KLON,NPROMA)
IF (.NOT.LMSE) THEN
  CALL ECR1D(IULLFA,'PGZ0F',YDMF_PHYS_SURF%GSD_VF%PZ0F,KLON,NPROMA)
  IF (LSOLV) THEN
    IF (LSNV) THEN
      CALL ECR1D(IULLFA,'PGZ0RLF',YDMF_PHYS_SURF%GSD_VF%PZ0RLF,KLON,NPROMA)
    ENDIF
  ENDIF
ENDIF
CALL ECR1D(IULLFA,'PVRLAN',YDMF_PHYS_SURF%GSD_VF%PVRLAN,KLON,NPROMA)
CALL ECR1D(IULLFA,'PVRLDI',YDMF_PHYS_SURF%GSD_VF%PVRLDI,KLON,NPROMA)
IF (YSD_VAD%NUMFLDS >= 4) THEN
  CALL ECR1D(IULLFA,'PAESEA',YDMF_PHYS_SURF%GSD_VA%PSEA,KLON,NPROMA)
  CALL ECR1D(IULLFA,'PAELAN',YDMF_PHYS_SURF%GSD_VA%PLAN,KLON,NPROMA)
  CALL ECR1D(IULLFA,'PAESOO',YDMF_PHYS_SURF%GSD_VA%PSOO,KLON,NPROMA)
  CALL ECR1D(IULLFA,'PAEDES',YDMF_PHYS_SURF%GSD_VA%PDES,KLON,NPROMA)
ENDIF
IF (LO3ABC) THEN
  CALL ECRPNEBH(IULLFA,'PVO3ABC',YDMF_PHYS_SURF%GSD_VC%PGROUP,KLON,NPROMA,3)
ENDIF
      !
      ! -------------------------------------------------
      ! Write input to physics, redundant
      ! with variables that will be computed by SCM.
      ! -------------------------------------------------
      !
CALL ECR2DV(IULLFA,'PCVGQ',PRDG_CVGQ,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PCVGQDY',PRDG_LCVQ,KLON,NPROMA,NFLEVG)
      !
      ! -------------------------------------------------
      ! Write output from physics.
      ! -------------------------------------------------
      !
CALL ECR2DF(IULLFA,'PDIFCQ',YDMF_PHYS%OUT%DIFCQ,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PDIFCS',YDMF_PHYS%OUT%DIFCS,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PDIFCQN',YDMF_PHYS%OUT%DIFCQN,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PDIFCQL',YDMF_PHYS%OUT%DIFCQL,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PDIFTQ',YDMF_PHYS%OUT%DIFTQ,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PDIFTQN',YDMF_PHYS%OUT%DIFTQN,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PDIFTQL',YDMF_PHYS%OUT%DIFTQL,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PDIFTS',YDMF_PHYS%OUT%DIFTS,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFCCQL',YDMF_PHYS%OUT%FCCQL,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFCCQN',YDMF_PHYS%OUT%FCCQN,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFCSQL',YDMF_PHYS%OUT%FCSQL,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFCSQN',YDMF_PHYS%OUT%FCSQN,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFCQNG',YDMF_PHYS%OUT%FCQNG,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFCQNNG',YDMF_PHYS%OUT%FCQNNG,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFCQLNG',YDMF_PHYS%OUT%FCQLNG,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFPLCL',YDMF_PHYS%OUT%FPLCL,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFPLCN',YDMF_PHYS%OUT%FPLCN,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFPLSL',YDMF_PHYS%OUT%FPLSL,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFPLSN',YDMF_PHYS%OUT%FPLSN,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFRSO',YDMF_PHYS%OUT%FRSO,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFRTH',YDMF_PHYS%OUT%FRTH,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PSTRCU',YDMF_PHYS%OUT%STRCU,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PSTRCV',YDMF_PHYS%OUT%STRCV,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PSTRDU',YDMF_PHYS%OUT%STRDU,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PSTRDV',YDMF_PHYS%OUT%STRDV,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PSTRTU',YDMF_PHYS%OUT%STRTU,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PSTRTV',YDMF_PHYS%OUT%STRTV,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PSTRMU',YDMF_PHYS%OUT%STRMU,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PSTRMV',YDMF_PHYS%OUT%STRMV,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFRMH',YDMF_PHYS%OUT%FRMH,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFCHOZ',YDMF_PHYS%OUT%FCHOZ,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PNEB',YDCPG_MISC%NEB,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PQICE',YDCPG_MISC%QICE,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PQLI',YDCPG_MISC%QLI,KLON,NPROMA,NFLEVG)
!     CALL ECR2DV(IULLFA,'PQSAT',PQSAT,KLON,NPROMA,NFLEVG)
CALL ECR2DV(IULLFA,'PRH',YDCPG_MISC%RH,KLON,NPROMA,NFLEVG)

!     Split of old PNEBH      
CALL ECR2DF(IULLFA,'PFPLCH',PPFL_FPLCH,KLON,NPROMA,NFLEVG)
CALL ECR2DF(IULLFA,'PFPLSH',PPFL_FPLSH,KLON,NPROMA,NFLEVG)
IF (LNEBCO.OR.LGWDC) THEN
  CALL ECR1D(IULLFA,'PTCCH',YDMF_PHYS_SURF%GSD_VH%PTCCH,KLON,NPROMA)
  CALL ECR1D(IULLFA,'PSCCH',YDMF_PHYS_SURF%GSD_VH%PSCCH,KLON,NPROMA)
  CALL ECR1D(IULLFA,'PBCCH',YDMF_PHYS_SURF%GSD_VH%PBCCH,KLON,NPROMA)
ENDIF
IF ( LNEBR ) CALL ECR1D(IULLFA,'PPBLH' ,YDMF_PHYS_SURF%GSD_VH%PPBLH ,KLON,NPROMA)

CALL ECR1D(IULLFA,'PCT',YDMF_PHYS%OUT%CT,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFCS',YDMF_PHYS%OUT%FCS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFCLL',YDMF_PHYS%OUT%FCLL,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFCLN',YDMF_PHYS%OUT%FCLN,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFEVL',YDMF_PHYS%OUT%FEVL,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFEVN',YDMF_PHYS%OUT%FEVN,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFEVV',YDMF_PHYS%OUT%FEVV,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFTR',YDMF_PHYS%OUT%FTR,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFLWSP',YDMF_PHYS%OUT%FLWSP,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFONTE',YDMF_PHYS%OUT%FONTE,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFGEL',YDMF_PHYS%OUT%FGEL,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFGELS',YDMF_PHYS%OUT%FGELS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFRSODS',YDMF_PHYS%OUT%FRSODS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFRSOPS',YDMF_PHYS%OUT%FRSOPS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFRSOPT',YDMF_PHYS%OUT%FRSOPT,KLON,NPROMA)
CALL ECR1D(IULLFA,'PFRTHDS',YDMF_PHYS%OUT%FRTHDS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PQS',YDCPG_MISC%QS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PRUISL',YDMF_PHYS%OUT%RUISL,KLON,NPROMA)
CALL ECR1D(IULLFA,'PRUISP',YDMF_PHYS%OUT%RUISP,KLON,NPROMA)
CALL ECR1D(IULLFA,'PRUISS',YDMF_PHYS%OUT%RUISS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PUCLS',YDMF_PHYS%OUT%UCLS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PVCLS',YDMF_PHYS%OUT%VCLS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PTCLS',YDMF_PHYS%OUT%TCLS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PQCLS',YDMF_PHYS%OUT%QCLS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PRHCLS',YDMF_PHYS%OUT%RHCLS,KLON,NPROMA)
CALL ECR1D(IULLFA,'PCLCT',YDCPG_MISC%CLCT,KLON,NPROMA)
CALL ECR1D(IULLFA,'PCLCH',YDMF_PHYS%OUT%CLCH,KLON,NPROMA)
CALL ECR1D(IULLFA,'PCLCM',YDMF_PHYS%OUT%CLCM,KLON,NPROMA)
CALL ECR1D(IULLFA,'PCLCL',YDMF_PHYS%OUT%CLCL,KLON,NPROMA)
CALL ECR1D(IULLFA,'PCLCC',YDMF_PHYS%OUT%CLCC,KLON,NPROMA)
CALL ECR1D(IULLFA,'PMU0',PRDG_MU0,KLON,NPROMA)
      !
      ! -------------------------------------------------
      ! Close SCM file.
      ! -------------------------------------------------
      !
CALL FLUSH(IULLFA)
CALL LFAFER(IULLFA)

!-----------------------------------------------------------------
END ASSOCIATE
END ASSOCIATE
IF (LHOOK) CALL DR_HOOK('WRITEPROFILE',1,ZHOOK_HANDLE)
END SUBROUTINE WRITEPROFILE
