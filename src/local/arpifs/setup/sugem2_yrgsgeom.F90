SUBROUTINE SUGEM2_YRGSGEOM (YDGEOMETRY, PZRCORI, PZRCORIC, PZGEMU, PZGSQM2, PZGELAM, &
& PZGELAT, PZGECLO, PZGESLO, PZGM, PZGOMVRL, PZGOMVRM, PZGNORDL, PZGNORDM, PZGNORDLCL, &
& PZGNORDMCL, PZGNORDMCM, PZGAW, KIGPLAT, KIUNIQUEGP)

USE GEOMETRY_MOD, ONLY : GEOMETRY
USE PARKIND1 , ONLY : JPIM, JPRB, JPRD
USE YOMHOOK  , ONLY : LHOOK, DR_HOOK

IMPLICIT NONE

TYPE (GEOMETRY),     INTENT (IN) :: YDGEOMETRY
REAL (KIND=JPRB),    INTENT (IN) :: PZRCORI   (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZRCORIC  (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGEMU    (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGSQM2   (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGELAM   (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGELAT   (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGECLO   (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGESLO   (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGM      (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGOMVRL  (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGOMVRM  (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGNORDL  (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGNORDM  (YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGNORDLCL(YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGNORDMCL(YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGNORDMCM(YDGEOMETRY%YRGEM%NGPTOT)
REAL (KIND=JPRB),    INTENT (IN) :: PZGAW     (YDGEOMETRY%YRGEM%NGPTOT)
INTEGER (KIND=JPIM), INTENT (IN) :: KIGPLAT   (YDGEOMETRY%YRGEM%NGPTOT)
INTEGER (KIND=JPIM), INTENT (IN) :: KIUNIQUEGP(YDGEOMETRY%YRGEM%NGPTOT)

INTEGER (KIND=JPIM) :: IBL, IEND, JKGLO

REAL(KIND=JPRB) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK('SUGEM2_YRGSGEOM',0,ZHOOK_HANDLE)

ASSOCIATE (NGPTOT => YDGEOMETRY%YRGEM%NGPTOT, NPROMA => YDGEOMETRY%YRDIM%NPROMA, &
         & NGPBLKS => YDGEOMETRY%YRDIM%NGPBLKS)

! Allocate YRGSGEOM_NB:
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%RCORI(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%RCORIC(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GEMU(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GSQM2(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GELAM(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GELAT(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GECLO(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GESLO(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GM(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GMAPPA(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GOMVRL(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GOMVRM(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GNORDL(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GNORDM(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GNORDLCL(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GNORDMCL(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GNORDMCM(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%GAW(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%NGPLAT(NGPTOT))
ALLOCATE(YDGEOMETRY%YRGSGEOM_NB%NUNIQUEGP(NGPTOT))

! Allocate natively NPROMA-blocked copy of geometry
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%RCORI(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%RCORIC(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GEMU(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GSQM2(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GELAM(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GELAT(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GECLO(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GESLO(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GM(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GMAPPA(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GOMVRL(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GOMVRM(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GNORDL(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GNORDM(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GNORDLCL(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GNORDMCL(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GNORDMCM(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%GAW(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%NGPLAT(NPROMA,NGPBLKS))
ALLOCATE(YDGEOMETRY%YRGSGEOM_B%NUNIQUEGP(NPROMA,NGPBLKS))

! Allocate YRGSGEOM:
ALLOCATE(YDGEOMETRY%YRGSGEOM(NGPBLKS))

! Copy items to non-blocked form of YRGSGEOM
YDGEOMETRY%YRGSGEOM_NB%RCORI    (:)=PZRCORI   (:)
YDGEOMETRY%YRGSGEOM_NB%RCORIC   (:)=PZRCORIC  (:)
YDGEOMETRY%YRGSGEOM_NB%GEMU     (:)=PZGEMU    (:)
YDGEOMETRY%YRGSGEOM_NB%GSQM2    (:)=PZGSQM2   (:)
YDGEOMETRY%YRGSGEOM_NB%GELAM    (:)=PZGELAM   (:)
YDGEOMETRY%YRGSGEOM_NB%GELAT    (:)=PZGELAT   (:)
YDGEOMETRY%YRGSGEOM_NB%GECLO    (:)=PZGECLO   (:)
YDGEOMETRY%YRGSGEOM_NB%GESLO    (:)=PZGESLO   (:)
YDGEOMETRY%YRGSGEOM_NB%GM       (:)=PZGM      (:)
YDGEOMETRY%YRGSGEOM_NB%GMAPPA   (:)=YDGEOMETRY%YRGEM%RSTRET*YDGEOMETRY%YRGEM%RSTRET
YDGEOMETRY%YRGSGEOM_NB%GOMVRL   (:)=PZGOMVRL  (:)
YDGEOMETRY%YRGSGEOM_NB%GOMVRM   (:)=PZGOMVRM  (:)
YDGEOMETRY%YRGSGEOM_NB%GNORDL   (:)=PZGNORDL  (:)
YDGEOMETRY%YRGSGEOM_NB%GNORDM   (:)=PZGNORDM  (:)
YDGEOMETRY%YRGSGEOM_NB%GNORDLCL (:)=PZGNORDLCL(:)
YDGEOMETRY%YRGSGEOM_NB%GNORDMCL (:)=PZGNORDMCL(:)
YDGEOMETRY%YRGSGEOM_NB%GNORDMCM (:)=PZGNORDMCM(:)
YDGEOMETRY%YRGSGEOM_NB%GAW      (:)=PZGAW     (:)
YDGEOMETRY%YRGSGEOM_NB%NGPLAT   (:)=KIGPLAT   (:)
YDGEOMETRY%YRGSGEOM_NB%NUNIQUEGP(:)=KIUNIQUEGP(:)

! Point to items initialised above
DO JKGLO=1,NGPTOT,NPROMA
  IEND=MIN(NPROMA,NGPTOT-JKGLO+1)
  IBL=(JKGLO-1)/NPROMA+1
  YDGEOMETRY%YRGSGEOM(IBL)%RCORI    =>YDGEOMETRY%YRGSGEOM_NB%RCORI    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%RCORIC   =>YDGEOMETRY%YRGSGEOM_NB%RCORIC   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GEMU     =>YDGEOMETRY%YRGSGEOM_NB%GEMU     (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GSQM2    =>YDGEOMETRY%YRGSGEOM_NB%GSQM2    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GELAM    =>YDGEOMETRY%YRGSGEOM_NB%GELAM    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GELAT    =>YDGEOMETRY%YRGSGEOM_NB%GELAT    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GECLO    =>YDGEOMETRY%YRGSGEOM_NB%GECLO    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GESLO    =>YDGEOMETRY%YRGSGEOM_NB%GESLO    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GM       =>YDGEOMETRY%YRGSGEOM_NB%GM       (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GMAPPA   =>YDGEOMETRY%YRGSGEOM_NB%GMAPPA   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GOMVRL   =>YDGEOMETRY%YRGSGEOM_NB%GOMVRL   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GOMVRM   =>YDGEOMETRY%YRGSGEOM_NB%GOMVRM   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GNORDL   =>YDGEOMETRY%YRGSGEOM_NB%GNORDL   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GNORDM   =>YDGEOMETRY%YRGSGEOM_NB%GNORDM   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GNORDLCL =>YDGEOMETRY%YRGSGEOM_NB%GNORDLCL (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GNORDMCL =>YDGEOMETRY%YRGSGEOM_NB%GNORDMCL (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GNORDMCM =>YDGEOMETRY%YRGSGEOM_NB%GNORDMCM (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%GAW      =>YDGEOMETRY%YRGSGEOM_NB%GAW      (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%NGPLAT   =>YDGEOMETRY%YRGSGEOM_NB%NGPLAT   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM(IBL)%NUNIQUEGP=>YDGEOMETRY%YRGSGEOM_NB%NUNIQUEGP(JKGLO:JKGLO+IEND-1)
ENDDO

! Copy blocks into native NPROMA-allocated arrays
DO JKGLO=1,NGPTOT,NPROMA
  IEND=MIN(NPROMA,NGPTOT-JKGLO+1)
  IBL=(JKGLO-1)/NPROMA+1

  YDGEOMETRY%YRGSGEOM_B%RCORI(1:IEND,IBL)     = YDGEOMETRY%YRGSGEOM_NB%RCORI    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%RCORIC(1:IEND,IBL)    = YDGEOMETRY%YRGSGEOM_NB%RCORIC   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GEMU(1:IEND,IBL)      = YDGEOMETRY%YRGSGEOM_NB%GEMU     (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GSQM2(1:IEND,IBL)     = YDGEOMETRY%YRGSGEOM_NB%GSQM2    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GELAM(1:IEND,IBL)     = YDGEOMETRY%YRGSGEOM_NB%GELAM    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GELAT(1:IEND,IBL)     = YDGEOMETRY%YRGSGEOM_NB%GELAT    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GECLO(1:IEND,IBL)     = YDGEOMETRY%YRGSGEOM_NB%GECLO    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GESLO(1:IEND,IBL)     = YDGEOMETRY%YRGSGEOM_NB%GESLO    (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GM(1:IEND,IBL)        = YDGEOMETRY%YRGSGEOM_NB%GM       (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GMAPPA(1:IEND,IBL)    = YDGEOMETRY%YRGSGEOM_NB%GMAPPA   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GOMVRL(1:IEND,IBL)    = YDGEOMETRY%YRGSGEOM_NB%GOMVRL   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GOMVRM(1:IEND,IBL)    = YDGEOMETRY%YRGSGEOM_NB%GOMVRM   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GNORDL(1:IEND,IBL)    = YDGEOMETRY%YRGSGEOM_NB%GNORDL   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GNORDM(1:IEND,IBL)    = YDGEOMETRY%YRGSGEOM_NB%GNORDM   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GNORDLCL(1:IEND,IBL)  = YDGEOMETRY%YRGSGEOM_NB%GNORDLCL (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GNORDMCL(1:IEND,IBL)  = YDGEOMETRY%YRGSGEOM_NB%GNORDMCL (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GNORDMCM(1:IEND,IBL)  = YDGEOMETRY%YRGSGEOM_NB%GNORDMCM (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%GAW(1:IEND,IBL)       = YDGEOMETRY%YRGSGEOM_NB%GAW      (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%NGPLAT(1:IEND,IBL)    = YDGEOMETRY%YRGSGEOM_NB%NGPLAT   (JKGLO:JKGLO+IEND-1)
  YDGEOMETRY%YRGSGEOM_B%NUNIQUEGP(1:IEND,IBL) = YDGEOMETRY%YRGSGEOM_NB%NUNIQUEGP(JKGLO:JKGLO+IEND-1)
ENDDO

END ASSOCIATE

IF (LHOOK) CALL DR_HOOK('SUGEM2_YRGSGEOM',1,ZHOOK_HANDLE)

END SUBROUTINE SUGEM2_YRGSGEOM

