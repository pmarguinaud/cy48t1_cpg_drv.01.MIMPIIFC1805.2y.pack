SUBROUTINE SUGFL1(YDMODEL,KGFLCONF)

!     ----------------------------------------------------------------------
!**** *SUGFL1 * - Setting up GFL environment: part 1

!     Purpose.
!     --------
!      Initialization of YOM_YGFL, part 1.
!      Reads NAMGFL.
!      Does checkings on Y[X]_NL attributes.
!      If NCHEM>0 NAMCHEM is read too.

!**   Interface.
!     ----------
!        *CALL* *SUGFL1*

!        Explicit arguments :
!        --------------------
!           KGFLCONF : default configuration of GFL attributes

!        Implicit arguments :
!        --------------------

!     Method.
!     -------

!     Externals.
!     ----------

!     Reference.
!     ----------
!        ECMWF Research Department documentation of the IFS

!     Author.
!     -------
!      Mats Hamrud and Philippe Courtier  *ECMWF*
!      Original : 87-10-15
!      Code in SUDIM1 until 2011
!      Creation of SUGFL1 in Nov 2011.

!     Modifications.
!     --------------
!      K. YESSAD (Nov 2011) former GFL SUDIM1 code put in new SUGFL1
!      A. Inness  23 Mar 2012 Changes for CHEM fields
!      M. Diamantakis Feb-2013: Changes to support mass fixers
!      F. Vana & M. Kharoutdinov 09-Feb-2015 CRM fields
!      S. Remy 28 Jan 2015 add biomass burning emissions injection heights
!      F. Vana 20-Sep-2015 Better security for CRM usage.
!      S. Massart Dec. 2015: add linear carbon monoxide chemical scheme
!      S.-J. Lock Feb. 2017: LSPPTGFL - switch for SPPT perturbations to chemistry/aerosol tendencies
!      R. El Khatib 18-Jan-2018 optional argument KGFLCONF
!      S. Remy (Apr 2017): LVOLC_ALTI added
!      M Ahlgrimm 2017-05-11 cloud heterogeneity FSD
!      S. Remy (Nov 2017): LAERSOA added
!      K. Lonitz Apr. 2018: increased NGFL_PHYS to 9
!      M. Michou 2018-09 : add initialisation of key to ARPEGE-Climat chemistry scheme
!      P. Bechtold Feb. 2019: EDR Parameter added
!      R. El Khatib 18-Mar-2020 bugfix : give a default value to CHEM_SCHEME
!     ----------------------------------------------------------------------

USE TYPE_MODEL  , ONLY : MODEL
USE PARKIND1    , ONLY : JPIM, JPRB
USE YOMHOOK     , ONLY : LHOOK, DR_HOOK
USE YOMLUN      , ONLY : NULNAM, NULOUT
USE YOMDYNA     , ONLY : LSLDIA
USE YOM_YGFL    , ONLY : JPCHEM_ASSIM, JPGHG_ASSIM, TYPE_GFL_NAML
USE YOMANEB     , ONLY : NGRBCHEM, NGRBGHGASSIM
USE CRMDIMS     , ONLY : CRMBUFSIZE
USE YOE_AERODIAG, ONLY : TYPE_AERO_WVL_DIAG
USE ARPCLIM_CHEM_MODULE
#if defined(__PGI)
USE PAR_GFL
USE YOE_AERODIAG, ONLY : NPAERAOT, NPAERLISI_VAR, NPAERLISI_WVL, NPAERLISI
#endif
USE YOMCOMPO,     ONLY : AERO_SCHEME_OP_OBS

!     ------------------------------------------------------------------

IMPLICIT NONE

TYPE(MODEL),INTENT(INOUT), TARGET :: YDMODEL
INTEGER(KIND=JPIM), INTENT(IN), OPTIONAL :: KGFLCONF

INTEGER(KIND=JPIM) :: JGFL
REAL(KIND=JPRB) :: ZHOOK_HANDLE

!     ------------------------------------------------------------------
LOGICAL, POINTER :: LCHEM_DIA, LCHEM_DDFLX, LCOMPO_DDFLX_DIR, LCHEM_TROPO, &
 & LAEROSFC, LCO2SFC, LGHG_ACCO2, LFIRE, LINJ, LINJ_CHEM, LINJ_GHG, &
 & LCH4SFC, LCHEM_ACNOX, LCHEM_LIGHT, LCHEM_DIAC, LCHEM_STMA, LCHEM_BASCOE_JON, &
 & LCHEM_ANAO3, LCHEM_ANACH4, LCHEM_JOUT, LCHEM_0NOX, LCHEM_HTAP, LCHEM_O3RAD, LCHEM_WDFR, LCHEM_DVOL, &
 & LCHEM_CONVSCAV, LCHEM_CSHAPE, LCHEM_AEROI, LCHEM_LCOMESO, LCHEM_LCOCSTCLIM, LCHEM_LCOLIMIT, &
 & LCOMPO_DCBB, LCOMPO_DCDD, LCOMPO_DCVOC, LCOMPO_DCANT, LVOLC_ALTI, LANT_HIGH, & 
 & LAERNITRATE, LAERSOA, LCHEM_REVCHEM, LAERRESUSPENSION, LAERNUCL, LCHEM_ARPCLIM

#include "namcompo.nam.h"
 
CHARACTER(LEN=20) :: CHEM_SCHEME, CHEM_LCOVERS, AERO_SCHEME
INTEGER(KIND=JPIM), POINTER :: NCHEM_LCOCOEF, KCHEM_SOLVE, KCHEM_YEARPI, KCHEM_NOXADV 
REAL(KIND=JPRB), POINTER :: RCHEM_LCOTAUTOP, RCHEM_LCOCLIMTOP, RCHEM_LCOCOEFA1
REAL(KIND=JPRB), POINTER :: RCH4CONST

! definition of ASIS method parameters in namchem:
CHARACTER(LEN=5), POINTER   :: CSOLMET_ASIS
INTEGER(KIND=JPIM), POINTER :: M_soliter_ASIS
REAL(KIND=JPRB), POINTER    :: solcv_ASIS,RTOL_ASIS,ATOL_ASIS
INTEGER(KIND=JPIM), POINTER :: N_F_RTOL_ASIS,N_F_ATOL_ASIS

#include "namchem.nam.h"

!     ------------------------------------------------------------------

#if defined(__PGI)
!PGI compiler bug workaround. Namelist members cannot be pointers to derived types because the read fails or segfaults
TYPE(TYPE_GFL_NAML) :: &
 & YGHG_NL(JPGHG), YCHEM_NL(JPCHEM), YAERO_NL(JPAERO), YERA40_NL(JPERA40), &
 & YNOGW_NL(JPNOGW), YEDRP_NL(JPEDRP), YSLDIA_NL(JPSLDIA), YAERAOT_NL(NPAERAOT), &
 & YAERLISI_NL(NPAERLISI_WVL,NPAERLISI_VAR), YAEROCLIM_NL(JPAEROCLIM), &
 & YAEROUT_NL(JPAEROUT), YUVP_NL(JPUVP), YFORC_NL(JPFORC), &
 & YEZDIAG_NL(JPEZDIAG), YCRM_NL(JPCRM), YLIMA_NL(JPLIMA), &
 & YEXT_NL(JPGFL-JPNAMED_GFL-JPGHG-JPFORC-JPEZDIAG-JPAERO-JPERA40-JPNOGW-JPEDRP-JPSLDIA-&
 & JPCH4S-JPAEROUT-JPAEROCLIM-NPAERAOT-NPAERLISI-JPUVP-JPCHEM-JPPHYS-JPCRM-JPLIMA)
#else
TYPE(TYPE_GFL_NAML), POINTER :: &
 & YGHG_NL(:), YCHEM_NL(:), YAERO_NL(:), YERA40_NL(:), YNOGW_NL(:), YSLDIA_NL(:), &
 & YAERAOT_NL(:), YAERLISI_NL(:,:), YAEROCLIM_NL(:), YAEROUT_NL(:), YUVP_NL(:),  &
 & YFORC_NL(:), YEZDIAG_NL(:), YEXT_NL(:), YCRM_NL(:), YLIMA_NL(:), YEDRP_NL(:)
#endif

! If you just wrap the #if around the first line of the statement to avoid duplicating
! the list of variables, then "git ifsnorms" bails out entirely when trying to
! parse any branch touching this file. See IGT-133.
#if defined(__PGI)
TYPE(TYPE_GFL_NAML) :: &
 & YQ_NL, YI_NL, YL_NL, &
 & YLCONV_NL, YICONV_NL, YRCONV_NL, YSCONV_NL, YIRAD_NL, YLRAD_NL, &
 & YS_NL, YR_NL, YG_NL, YH_NL, YTKE_NL, YTTE_NL, YA_NL, YO3_NL, YSRC_NL, &
 & YMXL_NL, YSHTUR_NL, YFQTUR_NL, YFSTUR_NL, YCPF_NL, YSPF_NL, YCVGQ_NL, YQVA_NL, &
 & YLRCH4_NL, YRKTH_NL, YRKTQV_NL, YRKTQC_NL,YRSPEC_NL, &
 & YSDSAT_NL, YCVV_NL, &
 & YUOM_NL, YUAL_NL, YDOM_NL, YDAL_NL, YUEN_NL, YUNEBH_NL, &
 & YEFB1_NL, YEFB2_NL, YEFB3_NL, YPHYCTY_NL, YFSD_NL
#else
TYPE(TYPE_GFL_NAML), POINTER :: &
 & YQ_NL, YI_NL, YL_NL, &
 & YLCONV_NL, YICONV_NL, YRCONV_NL, YSCONV_NL, YIRAD_NL, YLRAD_NL, &
 & YS_NL, YR_NL, YG_NL, YH_NL, YTKE_NL, YTTE_NL, YA_NL, YO3_NL, YSRC_NL, &
 & YMXL_NL, YSHTUR_NL, YFQTUR_NL, YFSTUR_NL, YCPF_NL, YSPF_NL, YCVGQ_NL, YQVA_NL, &
 & YLRCH4_NL, YRKTH_NL, YRKTQV_NL, YRKTQC_NL,YRSPEC_NL, &
 & YSDSAT_NL, YCVV_NL, &
 & YUOM_NL, YUAL_NL, YDOM_NL, YDAL_NL, YUEN_NL, YUNEBH_NL, &
 & YEFB1_NL, YEFB2_NL, YEFB3_NL, YPHYCTY_NL, YFSD_NL
#endif

#if defined(__PGI)
TYPE(TYPE_AERO_WVL_DIAG) :: YAERO_WVL_DIAG_NL(20)
#else
TYPE(TYPE_AERO_WVL_DIAG), POINTER :: YAERO_WVL_DIAG_NL(:)
#endif
INTEGER(KIND=JPIM), POINTER :: NGFL_EXT, NGHG, NAERO, NCHEM, &
 & NACTAERO, NERA40, NOPTMFBC, NOPTMFPR, NOPTVFE, NOPTNEGFIX, NMFDIAGLEV, &
 & NGFL_FORC, NGFL_EZDIAG, NSLDIA, NAEROUT, NAEROCLIM, NUVP, NCRM, NLIMA, &
 & NAERO_WVL_DIAG, NAERO_WVL_DIAG_TYPES, NEDRP
LOGICAL, POINTER :: LAERCHEM, LTRCMFIX, LTRCMFIX_PS, LTRCMFBC, LTRCMFPR, LTRCMFMG, LEXTRADF, &
 & LAERAOT, LAERLISI, LAEROUT, LUVPOUT, LAEROCLIM, &
 & LTRCMFP, LTRCMFA_DIF, LTRCMFA_VER, LTRCMFA_LAP, LQM3DCONS, LSPPTGFL

#include "namgfl.nam.h"

!     ------------------------------------------------------------------

#include "posnam.intfb.h"
#include "suctrl_gflattr.intfb.h"
#include "sudefo_gflattr.intfb.h"
#include "su_aerw.intfb.h"


!     ------------------------------------------------------------------

IF (LHOOK) CALL DR_HOOK('SUGFL1',0,ZHOOK_HANDLE)
ASSOCIATE(YGFL=>YDMODEL%YRML_GCONF%YGFL,YDEPHY=>YDMODEL%YRML_PHY_EC%YREPHY, &
 & YDCOMPO=>YDMODEL%YRML_CHEM%YRCOMPO,YDCHEM=>YDMODEL%YRML_CHEM%YRCHEM)
ASSOCIATE(NCHEM_ASSIM=>YGFL%NCHEM_ASSIM, NCHEM_DV=>YGFL%NCHEM_DV,&
 & NCHEM_FLX=>YGFL%NCHEM_FLX, NCHEM_FLXO=>YGFL%NCHEM_FLXO, NCHEM_TC=>YGFL%NCHEM_TC, &
 & NCHEM_SCV=>YGFL%NCHEM_SCV, NGEMS=>YGFL%NGEMS, &
 & NSLDIAGP=>YGFL%NSLDIAGP,NGHG_ASSIM=>YGFL%NGHG_ASSIM)

! Associate pointers for variables in namelist NAMCOMPO
LCHEM_DIA        => YDCOMPO%LCHEM_DIA
LCHEM_DDFLX      => YDCOMPO%LCHEM_DDFLX
LCOMPO_DDFLX_DIR => YDCOMPO%LCOMPO_DDFLX_DIR
LAEROSFC         => YDCOMPO%LAEROSFC
LCO2SFC          => YDCOMPO%LCO2SFC
LFIRE            => YDCOMPO%LFIRE
LINJ             => YDCOMPO%LINJ
LINJ_CHEM        => YDCOMPO%LINJ_CHEM
LINJ_GHG         => YDCOMPO%LINJ_GHG
LCH4SFC          => YDCOMPO%LCH4SFC
LCHEM_TROPO      => YDCOMPO%LCHEM_TROPO
LGHG_ACCO2       => YDCOMPO%LGHG_ACCO2
LCOMPO_DCDD      => YDCOMPO%LCOMPO_DCDD
LCOMPO_DCBB      => YDCOMPO%LCOMPO_DCBB
LCOMPO_DCVOC     => YDCOMPO%LCOMPO_DCVOC
LCOMPO_DCANT     => YDCOMPO%LCOMPO_DCANT
LVOLC_ALTI       => YDCOMPO%LVOLC_ALTI
LANT_HIGH        => YDCOMPO%LANT_HIGH
LAERNITRATE      => YDCOMPO%LAERNITRATE
LAERRESUSPENSION      => YDCOMPO%LAERRESUSPENSION
LAERSOA          => YDCOMPO%LAERSOA
LAERNUCL      => YDCOMPO%LAERNUCL

! Associate pointers for variables in namelist NAMCHEM
LCHEM_ACNOX      => YDCHEM%LCHEM_ACNOX
LCHEM_LIGHT      => YDCHEM%LCHEM_LIGHT
LCHEM_DIAC       => YDCHEM%LCHEM_DIAC
KCHEM_NOXADV     => YDCHEM%KCHEM_NOXADV
LCHEM_STMA       => YDCHEM%LCHEM_STMA
LCHEM_ANAO3      => YDCHEM%LCHEM_ANAO3
LCHEM_ANACH4     => YDCHEM%LCHEM_ANACH4
LCHEM_JOUT       => YDCHEM%LCHEM_JOUT
LCHEM_BASCOE_JON => YDCHEM%LCHEM_BASCOE_JON
LCHEM_0NOX       => YDCHEM%LCHEM_0NOX
LCHEM_HTAP       => YDCHEM%LCHEM_HTAP
RCH4CONST        => YDCHEM%RCH4CONST
LCHEM_O3RAD      => YDCHEM%LCHEM_O3RAD
LCHEM_AEROI      => YDCHEM%LCHEM_AEROI
LCHEM_WDFR       => YDCHEM%LCHEM_WDFR
LCHEM_CONVSCAV   => YDCHEM%LCHEM_CONVSCAV
LCHEM_CSHAPE     => YDCHEM%LCHEM_CSHAPE
KCHEM_SOLVE      => YDCHEM%KCHEM_SOLVE
LCHEM_REVCHEM    => YDCHEM%LCHEM_REVCHEM
KCHEM_YEARPI     => YDCHEM%KCHEM_YEARPI
NCHEM_LCOCOEF    => YDCHEM%NCHEM_LCOCOEF
LCHEM_LCOMESO    => YDCHEM%LCHEM_LCOMESO
LCHEM_LCOCSTCLIM => YDCHEM%LCHEM_LCOCSTCLIM
RCHEM_LCOTAUTOP  => YDCHEM%RCHEM_LCOTAUTOP
RCHEM_LCOCLIMTOP => YDCHEM%RCHEM_LCOCLIMTOP
LCHEM_LCOLIMIT   => YDCHEM%LCHEM_LCOLIMIT
RCHEM_LCOCOEFA1  => YDCHEM%RCHEM_LCOCOEFA1
LCHEM_ARPCLIM    => YDCHEM%LCHEM_ARPCLIM
LCHEM_DVOL       => YDCHEM%LCHEM_DVOL

! definition of ASIS method parameters in namchem:
CSOLMET_ASIS => YDCHEM%CSOLMET_ASIS 
M_soliter_ASIS => YDCHEM%M_soliter_ASIS 
solcv_ASIS => YDCHEM%solcv_ASIS 
RTOL_ASIS => YDCHEM%RTOL_ASIS 
N_F_RTOL_ASIS => YDCHEM%N_F_RTOL_ASIS 
ATOL_ASIS => YDCHEM%ATOL_ASIS 
N_F_ATOL_ASIS => YDCHEM%N_F_ATOL_ASIS 

! Associate pointers for variables in namelist NAMGFL
#if defined(__PGI)
#else
YQ_NL          => YGFL%YQ_NL
YI_NL          => YGFL%YI_NL
YL_NL          => YGFL%YL_NL
YLCONV_NL      => YGFL%YLCONV_NL
YICONV_NL      => YGFL%YICONV_NL
YRCONV_NL      => YGFL%YRCONV_NL
YSCONV_NL      => YGFL%YSCONV_NL
YIRAD_NL       => YGFL%YIRAD_NL
YLRAD_NL       => YGFL%YLRAD_NL
YS_NL          => YGFL%YS_NL
YR_NL          => YGFL%YR_NL
YG_NL          => YGFL%YG_NL
YH_NL          => YGFL%YH_NL
YTKE_NL        => YGFL%YTKE_NL
YTTE_NL        => YGFL%YTTE_NL
YEFB1_NL       => YGFL%YEFB1_NL
YEFB2_NL       => YGFL%YEFB2_NL
YEFB3_NL       => YGFL%YEFB3_NL
YA_NL          => YGFL%YA_NL
YO3_NL         => YGFL%YO3_NL
YSRC_NL        => YGFL%YSRC_NL
YMXL_NL        => YGFL%YMXL_NL
YSHTUR_NL      => YGFL%YSHTUR_NL
YFQTUR_NL      => YGFL%YFQTUR_NL
YFSTUR_NL      => YGFL%YFSTUR_NL
YCPF_NL        => YGFL%YCPF_NL
YSPF_NL        => YGFL%YSPF_NL
YCVGQ_NL       => YGFL%YCVGQ_NL
YQVA_NL        => YGFL%YQVA_NL
YGHG_NL        => YGFL%YGHG_NL
YCHEM_NL       => YGFL%YCHEM_NL
YAERO_NL       => YGFL%YAERO_NL
YERA40_NL      => YGFL%YERA40_NL
YNOGW_NL       => YGFL%YNOGW_NL
YEDRP_NL       => YGFL%YEDRP_NL
YPHYCTY_NL     => YGFL%YPHYCTY_NL
YSLDIA_NL      => YGFL%YSLDIA_NL
YLRCH4_NL      => YGFL%YLRCH4_NL
YAERAOT_NL     => YGFL%YAERAOT_NL
YAERLISI_NL    => YGFL%YAERLISI_NL
YAEROUT_NL     => YGFL%YAEROUT_NL
YAEROCLIM_NL   => YGFL%YAEROCLIM_NL
YUVP_NL        => YGFL%YUVP_NL
YRKTH_NL       => YGFL%YRKTH_NL
YRSPEC_NL      => YGFL%YRSPEC_NL
YRKTQV_NL      => YGFL%YRKTQV_NL
YRKTQC_NL      => YGFL%YRKTQC_NL
YSDSAT_NL      => YGFL%YSDSAT_NL
YCVV_NL        => YGFL%YCVV_NL
YFORC_NL       => YGFL%YFORC_NL
YEZDIAG_NL     => YGFL%YEZDIAG_NL
YEXT_NL        => YGFL%YEXT_NL
YCRM_NL        => YGFL%YCRM_NL
YFSD_NL        => YGFL%YFSD_NL
YUOM_NL        => YGFL%YUOM_NL
YUAL_NL        => YGFL%YUAL_NL
YDOM_NL        => YGFL%YDOM_NL
YDAL_NL        => YGFL%YDAL_NL
YUEN_NL        => YGFL%YUEN_NL
YUNEBH_NL      => YGFL%YUNEBH_NL
YDOM_NL        => YGFL%YDOM_NL
YAERO_WVL_DIAG_NL => YGFL%YAERO_WVL_DIAG_NL
YLIMA_NL       => YGFL%YLIMA_NL
#endif
NGFL_EXT       => YGFL%NGFL_EXT
NGHG           => YGFL%NGHG
NAERO          => YGFL%NAERO
NCRM           => YGFL%NCRM
NCHEM          => YGFL%NCHEM
NACTAERO       => YGFL%NACTAERO
NERA40         => YGFL%NERA40
NEDRP          => YGFL%NEDRP
NOPTMFBC       => YGFL%NOPTMFBC
NOPTMFPR       => YGFL%NOPTMFPR
NOPTVFE        => YGFL%NOPTVFE
NOPTNEGFIX     => YGFL%NOPTNEGFIX
NMFDIAGLEV     => YGFL%NMFDIAGLEV
NGFL_FORC      => YGFL%NGFL_FORC
NGFL_EZDIAG    => YGFL%NGFL_EZDIAG 
NSLDIA         => YGFL%NSLDIA
NAEROUT        => YGFL%NAEROUT
NAEROCLIM      => YGFL%NAEROCLIM
NUVP           => YGFL%NUVP
NAERO_WVL_DIAG => YGFL%NAERO_WVL_DIAG
NAERO_WVL_DIAG_TYPES => YGFL%NAERO_WVL_DIAG_TYPES
LAERCHEM       => YGFL%LAERCHEM
LTRCMFIX       => YGFL%LTRCMFIX
LTRCMFIX_PS    => YGFL%LTRCMFIX_PS
LTRCMFBC       => YGFL%LTRCMFBC
LTRCMFPR       => YGFL%LTRCMFPR
LTRCMFMG       => YGFL%LTRCMFMG
LTRCMFP        => YGFL%LTRCMFP
LTRCMFA_DIF    => YGFL%LTRCMFA_DIF
LTRCMFA_VER    => YGFL%LTRCMFA_VER
LTRCMFA_LAP    => YGFL%LTRCMFA_LAP
LEXTRADF       => YGFL%LEXTRADF
LAERAOT        => YGFL%LAERAOT
LAERLISI       => YGFL%LAERLISI
LAEROUT        => YGFL%LAEROUT
LAEROCLIM      => YGFL%LAEROCLIM
LUVPOUT        => YGFL%LUVPOUT  
LQM3DCONS      => YGFL%LQM3DCONS
LSPPTGFL       => YGFL%LSPPTGFL
NLIMA          => YGFL%NLIMA

!     ------------------------------------------------------------------

!*       1. SET DEFAULT VALUES.
!           -------------------

!        1.1  Set implicit default values for GFL dimensions

NERA40=0
IF ( LSLDIA ) THEN
  NSLDIA=7
  NSLDIAGP=1
ELSE
  NSLDIA=0
  NSLDIAGP=0
ENDIF
NGHG=0
NAERO=0
IF (YDEPHY%LSPCRM) THEN
  NCRM=CRMBUFSIZE
ELSE
  NCRM=0
ENDIF
NACTAERO=0
NAEROUT=0
NAEROCLIM=0
NUVP=0
NGFL_FORC=0
NGFL_EZDIAG=0
NGFL_EXT=0
NCHEM=0
NCHEM_ASSIM=0
NGHG_ASSIM=0
NCHEM_FLX=0
NCHEM_FLXO=0
NCHEM_DV=0
NCHEM_SCV=0
NCHEM_TC=0
NLIMA=0

!        1.2  Set implicit default values for logical variables other than GFL attributes
LAERAOT=.FALSE.
LAERLISI=.FALSE.
LAEROUT=.FALSE.
LAEROCLIM=.FALSE.
LUVPOUT=.FALSE.
LTRCMFIX=.FALSE.
LTRCMFIX_PS=.FALSE.
LTRCMFBC=.FALSE.
LEXTRADF=.FALSE.
LTRCMFPR=.FALSE.
LTRCMFMG=.FALSE.
LTRCMFP=.FALSE.
LTRCMFA_DIF=.FALSE.
LTRCMFA_VER=.FALSE.
LTRCMFA_LAP=.FALSE.
LSPPTGFL=.FALSE.
NOPTMFBC=1
NOPTMFPR=1
NOPTNEGFIX=1
NOPTVFE=0
NMFDIAGLEV=0

!        1.3  Set implicit default values for GFL attributes
!             All the GFL attributes defaults computed before reading the
!             namelist NAMGFL SHOULD be defined in SUDEFO_GFLATTR

CALL SUDEFO_GFLATTR(YDMODEL,KGFLCONF)

!     ------------------------------------------------------------------

!*       2. READ NAMELIST.
!           --------------

#if defined(__PGI)
!-- Set local variables to defaults
YQ_NL          = YGFL%YQ_NL
YI_NL          = YGFL%YI_NL
YL_NL          = YGFL%YL_NL
YLCONV_NL      = YGFL%YLCONV_NL
YICONV_NL      = YGFL%YICONV_NL
YRCONV_NL      = YGFL%YRCONV_NL
YSCONV_NL      = YGFL%YSCONV_NL
YIRAD_NL       = YGFL%YIRAD_NL
YLRAD_NL       = YGFL%YLRAD_NL
YS_NL          = YGFL%YS_NL
YR_NL          = YGFL%YR_NL
YG_NL          = YGFL%YG_NL
YH_NL          = YGFL%YH_NL
YTKE_NL        = YGFL%YTKE_NL
YTTE_NL        = YGFL%YTTE_NL
YEFB1_NL       = YGFL%YEFB1_NL
YEFB2_NL       = YGFL%YEFB2_NL
YEFB3_NL       = YGFL%YEFB3_NL
YA_NL          = YGFL%YA_NL
YO3_NL         = YGFL%YO3_NL
YSRC_NL        = YGFL%YSRC_NL
YMXL_NL        = YGFL%YMXL_NL
YSHTUR_NL      = YGFL%YSHTUR_NL
YFQTUR_NL      = YGFL%YFQTUR_NL
YFSTUR_NL      = YGFL%YFSTUR_NL
YCPF_NL        = YGFL%YCPF_NL
YSPF_NL        = YGFL%YSPF_NL
YCVGQ_NL       = YGFL%YCVGQ_NL
YQVA_NL        = YGFL%YQVA_NL
YGHG_NL        = YGFL%YGHG_NL
YCHEM_NL       = YGFL%YCHEM_NL
YAERO_NL       = YGFL%YAERO_NL
YERA40_NL      = YGFL%YERA40_NL
YNOGW_NL       = YGFL%YNOGW_NL
YEDRP_NL       = YGFL%YEDRP_NL
YSLDIA_NL      = YGFL%YSLDIA_NL
YLRCH4_NL      = YGFL%YLRCH4_NL
YAERAOT_NL     = YGFL%YAERAOT_NL
YAERLISI_NL    = YGFL%YAERLISI_NL
YAEROUT_NL     = YGFL%YAEROUT_NL
YAEROCLIM_NL   = YGFL%YAEROCLIM_NL
YUVP_NL        = YGFL%YUVP_NL
YRKTH_NL       = YGFL%YRKTH_NL
YRSPEC_NL      = YGFL%YRSPEC_NL
YRKTQV_NL      = YGFL%YRKTQV_NL
YRKTQC_NL      = YGFL%YRKTQC_NL
YSDSAT_NL      = YGFL%YSDSAT_NL
YCVV_NL        = YGFL%YCVV_NL
YFORC_NL       = YGFL%YFORC_NL
YEZDIAG_NL     = YGFL%YEZDIAG_NL
YEXT_NL        = YGFL%YEXT_NL
YCRM_NL        = YGFL%YCRM_NL
YUOM_NL        = YGFL%YUOM_NL
YUAL_NL        = YGFL%YUAL_NL
YDOM_NL        = YGFL%YDOM_NL
YDAL_NL        = YGFL%YDAL_NL
YUEN_NL        = YGFL%YUEN_NL
YUNEBH_NL      = YGFL%YUNEBH_NL
YDOM_NL        = YGFL%YDOM_NL
YAERO_WVL_DIAG_NL = YGFL%YAERO_WVL_DIAG_NL
YLIMA_NL       = YGFL%YLIMA_NL
#endif
CALL POSNAM(NULNAM,'NAMGFL')
READ(NULNAM,NAMGFL)
#if defined(__PGI)
!-- A temporary PGI bug fix : namelist read fails in PGI 17.1 => hardcoding (see fort.4 &NAMGFL-namelist)
YGFL%YQ_NL          = YQ_NL
YGFL%YI_NL          = YI_NL
YGFL%YL_NL          = YL_NL
YGFL%YLCONV_NL      = YLCONV_NL
YGFL%YICONV_NL      = YICONV_NL
YGFL%YRCONV_NL      = YRCONV_NL
YGFL%YSCONV_NL      = YSCONV_NL
YGFL%YIRAD_NL       = YIRAD_NL
YGFL%YLRAD_NL       = YLRAD_NL
YGFL%YS_NL          = YS_NL
YGFL%YR_NL          = YR_NL
YGFL%YG_NL          = YG_NL
YGFL%YH_NL          = YH_NL
YGFL%YTKE_NL        = YTKE_NL
YGFL%YTTE_NL        = YTTE_NL
YGFL%YEFB1_NL       = YEFB1_NL
YGFL%YEFB2_NL       = YEFB2_NL
YGFL%YEFB3_NL       = YEFB3_NL
YGFL%YA_NL          = YA_NL
YGFL%YO3_NL         = YO3_NL
YGFL%YSRC_NL        = YSRC_NL
YGFL%YMXL_NL        = YMXL_NL
YGFL%YSHTUR_NL      = YSHTUR_NL
YGFL%YFQTUR_NL      = YFQTUR_NL
YGFL%YFSTUR_NL      = YFSTUR_NL
YGFL%YCPF_NL        = YCPF_NL
YGFL%YSPF_NL        = YSPF_NL
YGFL%YCVGQ_NL       = YCVGQ_NL
YGFL%YQVA_NL        = YQVA_NL
YGFL%YGHG_NL        = YGHG_NL
YGFL%YCHEM_NL       = YCHEM_NL
YGFL%YAERO_NL       = YAERO_NL
YGFL%YERA40_NL      = YERA40_NL
YGFL%YNOGW_NL       = YNOGW_NL
YGFL%YEDRP_NL       = YEDRP_NL
YGFL%YSLDIA_NL      = YSLDIA_NL
YGFL%YLRCH4_NL      = YLRCH4_NL
YGFL%YAERAOT_NL     = YAERAOT_NL
YGFL%YAERLISI_NL    = YAERLISI_NL
YGFL%YAEROUT_NL     = YAEROUT_NL
YGFL%YAEROCLIM_NL   = YAEROCLIM_NL
YGFL%YUVP_NL        = YUVP_NL
YGFL%YRKTH_NL       = YRKTH_NL
YGFL%YRSPEC_NL      = YRSPEC_NL
YGFL%YRKTQV_NL      = YRKTQV_NL
YGFL%YRKTQC_NL      = YRKTQC_NL
YGFL%YSDSAT_NL      = YSDSAT_NL
YGFL%YCVV_NL        = YCVV_NL
YGFL%YFORC_NL       = YFORC_NL
YGFL%YEZDIAG_NL     = YEZDIAG_NL
YGFL%YEXT_NL        = YEXT_NL
YGFL%YCRM_NL        = YCRM_NL
YGFL%YUOM_NL        = YUOM_NL
YGFL%YUAL_NL        = YUAL_NL
YGFL%YDOM_NL        = YDOM_NL
YGFL%YDAL_NL        = YDAL_NL
YGFL%YUEN_NL        = YUEN_NL
YGFL%YUNEBH_NL      = YUNEBH_NL
YGFL%YDOM_NL        = YDOM_NL
YGFL%YAERO_WVL_DIAG_NL = YAERO_WVL_DIAG_NL
YGFL%YLIMA_NL       = YLIMA_NL
#endif

LTRCMFIX=LTRCMFP.OR.LTRCMFMG.OR.LTRCMFBC.OR.LTRCMFPR.OR.LTRCMFA_DIF.OR.&
   &     LTRCMFA_VER.OR.LTRCMFA_LAP

!Switch for SPPT perturbations of CHEM tendencies
!**NOTE: These are ONLY active if SPPT (LSPSDT) is also active
LSPPTGFL=LSPPTGFL.AND.(NCHEM+NGHG+NAERO>0)

!     ------------------------------------------------------------------

!*       3. CHECKINGS.
!           ----------

CALL SUCTRL_GFLATTR(YDMODEL%YRML_PHY_EC%YREPHY,YDMODEL%YRML_GCONF, &
 & YDMODEL%YRML_PHY_MF%YRARPHY,YDMODEL%YRML_PHY_MF%YRPHY, YDMODEL%YRML_PHY_MF%YRSIMPHL)

!     ------------------------------------------------------------------

!*       6. SOME PRINTINGS
!           --------------
WRITE(NULOUT,'('' NGFL_EXT = '',I4,'' NLIMA = '',I4)') NGFL_EXT, NLIMA

IF (LTRCMFIX) THEN
  IF (LTRCMFBC) THEN
    WRITE(NULOUT,*) 'BERMEJO & CONDE MASS FIXING SCHEME IS ON'
  ELSEIF (LTRCMFPR) THEN
    WRITE(NULOUT,*) 'PRIESTLEY MASS FIXING SCHEME IS ON'
  ELSEIF (LTRCMFMG) THEN
    WRITE(NULOUT,*) 'MAC GREGOR MASS FIXING SCHEME IS ON'
  ELSEIF (LTRCMFP) THEN
    WRITE(NULOUT,*) 'PROPORTIONAL MASS FIXING SCHEME IS ON'
  ENDIF
  IF ( NOPTVFE == 1 )&
   &  WRITE(NULOUT,*) 'VERTICAL FE IS IN USE IN TOTAL MASS BUDGET CALCULATIONS'
ENDIF

WRITE(NULOUT,'(A,L2,A,L2,A,L2,A,L2,A,L2,A,L2)')&
  & '  LTRCMFP=',LTRCMFP,&
  & '  LTRCMFBC=',LTRCMFBC,&
  & '  LTRCMFPR=',LTRCMFPR,&
  & '  LTRCMFMG=',LTRCMFMG,&
  & '  LTRCMFA_DIF=',LTRCMFA_DIF,&
  & '  LTRCMFIX_PS=',LTRCMFIX_PS

!     ------------------------------------------------------------------

!*       7. ADDITIONAL SETTINGS FOR COMPOSITION AND CHEMISTRY NAMELIST"
!           -------------------------------------------------------

! this may be put in separate routine 
! 
! Composition namelist 
 
LCHEM_DIA=.FALSE.
LCHEM_DDFLX=.FALSE.
LCOMPO_DDFLX_DIR=.FALSE.
LCHEM_TROPO=.FALSE.
LINJ=.FALSE.
LINJ_CHEM=.FALSE.
LINJ_GHG=.FALSE.
LAEROSFC=.FALSE.
LCO2SFC=.FALSE.
LCH4SFC=.FALSE.
LFIRE=.FALSE.
LGHG_ACCO2=.FALSE.
LCOMPO_DCDD=.TRUE.
LCOMPO_DCBB=.TRUE.
LCOMPO_DCVOC=.TRUE.
LCOMPO_DCANT=.FALSE.
LVOLC_ALTI=.FALSE.
LANT_HIGH=.FALSE.
LAERNITRATE=.FALSE.
LAERRESUSPENSION=.FALSE.
LAERSOA=.FALSE.
LAERNUCL=.TRUE.
!
AERO_SCHEME="aer"
!
WRITE(NULOUT,*) ' BEFORE READ NAMCOMP ' 
IF (NCHEM+NGHG+NAERO > 0 ) THEN 
  CALL POSNAM(NULNAM,'NAMCOMPO')
  READ(NULNAM,NAMCOMPO)

  AERO_SCHEME_OP_OBS = AERO_SCHEME

  WRITE(NULOUT,'(15(A,L2))')&
  & '  LCHEM_DIA=',LCHEM_DIA,&
  & '  LCHEM_DDFLX=',LCHEM_DDFLX,&
  & '  LCOMPO_DDFLX_DIR=',LCOMPO_DDFLX_DIR,&
  & '  LCHEM_TROPO=',LCHEM_TROPO,&
  & '  LINJ=',LINJ,&
  & '  LINJ_CHEM=',LINJ_CHEM,&
  & '  LINJ_GHG=',LINJ_GHG,&
  & '  LAEROSFC=',LAEROSFC,&
  & '  LCO2SFC=',LCO2SFC,&
  & '  LFIRE=',LFIRE,&
  & '  LGHG_ACCO2=',LGHG_ACCO2,&
  & '  LCOMPO_DCDD=',LCOMPO_DCDD,&
  & '  LCOMPO_DCBB=',LCOMPO_DCBB,&
  & '  LCOMPO_DCVOC=',LCOMPO_DCVOC,&
  & '  LCOMPO_DCANT=',LCOMPO_DCANT,&
  & '  LVOLC_ALTI=',LVOLC_ALTI,&
  & '  LANT_HIGH=',LANT_HIGH,&
  & '  LAERNITRATE=',LAERNITRATE, &
  & '  LAERRESUSPENSION=',LAERRESUSPENSION, &
  & '  LAERSOA=',LAERSOA, &
  & '  LAERNUCL=',LAERNUCL
  WRITE(NULOUT,'(A,A10)') &
  & '  AERO_SCHEME=',AERO_SCHEME

  ! check if chemistry is activated if LAERNITRATE
  IF (NCHEM == 0 .AND. LAERNITRATE) THEN
     CALL ABOR1('SUGFL1: LAERNITRATE requires chemistry')
  ENDIF

  ! check if aerosol or GHG present if we need to distinguish fires
  IF (LFIRE .AND. NACTAERO == 0 .AND. NGHG == 0 .AND. NCHEM /= 0) THEN
    IF (LCOMPO_DCBB) CALL ABOR1('SUGFL1: LCOMPO_DCBB for CHEM needs AER or GHG')
    IF (LINJ_CHEM) CALL ABOR1('SUGFL1: LINJ_CHEM needs AER or GHG')
  ENDIF

  YDCOMPO%AERO_SCHEME  = AERO_SCHEME

! array position for air craft emissions and tropopause height
! (these won't get set in chem_init if NCHEM is zero)
  IF (LCHEM_DIA .AND. NCHEM == 0) THEN 
       YDCHEM%IEXTR_FREE(1,5) = NGHG + NACTAERO + 1
       YDCHEM%IEXTR_FREE(1,6) = NGHG + NACTAERO + 2  
  ENDIF
ELSE
  LCHEM_DIA=.FALSE.
ENDIF 

NGRBCHEM = -999
NGRBGHGASSIM = -999

! GHG namelist

IF(NGHG > 0 ) THEN
  DO JGFL = 1, NGHG
    IF (YGHG_NL(JGFL)%LASSIM       ) THEN
      NGHG_ASSIM=NGHG_ASSIM + 1
      IF (NGHG_ASSIM > JPGHG_ASSIM) CALL ABOR1('SUDIM1: Too many assimilated GHG fields. Increase JPGHG_ASSIM.')
      NGRBGHGASSIM(NGHG_ASSIM) = YGHG_NL(JGFL)%IGRBCODE
    ENDIF
  ENDDO
ENDIF

! CHEM namelist 
IF(NCHEM > 0 ) THEN
  DO JGFL = 1, NCHEM
    IF (YCHEM_NL(JGFL)%IGRIBDV  > 0 ) NCHEM_DV=NCHEM_DV + 1
    IF (YCHEM_NL(JGFL)%IGRIBSFC > 0 ) NCHEM_FLX=NCHEM_FLX + 1
    IF (YCHEM_NL(JGFL)%IGRBFLXO > 0 ) NCHEM_FLXO=NCHEM_FLXO + 1
    IF (YCHEM_NL(JGFL)%IGRIBTC  > 0 ) NCHEM_TC=NCHEM_TC + 1
    IF (YCHEM_NL(JGFL)%HENRYA   > 0 ) NCHEM_SCV=NCHEM_SCV + 1
    IF (YCHEM_NL(JGFL)%LASSIM       ) THEN
      NCHEM_ASSIM=NCHEM_ASSIM + 1
      IF (NCHEM_ASSIM >JPCHEM_ASSIM) CALL ABOR1('SUDIM1: Too many assimilated CHEM fields. Increase JPCHEM_ASSIM.')
      NGRBCHEM(NCHEM_ASSIM) = YCHEM_NL(JGFL)%IGRBCODE
    ENDIF
  ENDDO
  WRITE(NULOUT,*) 'NCHEM_DV=',NCHEM_DV,' NCHEM_FLX=',NCHEM_FLX,' NCHEM_FLXO=',&
   & NCHEM_FLXO,' NCHEM_TC=',NCHEM_TC,' NCHEM_SCV=',NCHEM_SCV,' NCHEM_ASSIM=',&
   & NCHEM_ASSIM
  LCHEM_LIGHT=.FALSE.
  LCHEM_ACNOX=.FALSE.
  LCHEM_DIAC=.FALSE.
  LCHEM_JOUT=.FALSE.
  LCHEM_BASCOE_JON=.FALSE.
  KCHEM_NOXADV=0_JPIM
  LCHEM_STMA=.FALSE.
  LCHEM_ANAO3=.FALSE.
  LCHEM_ANACH4=.FALSE.
  LCHEM_0NOX=.FALSE.
  LCHEM_HTAP=.FALSE.
  LCHEM_O3RAD=.FALSE.
  LCHEM_AEROI=.FALSE.
  LCHEM_WDFR=.TRUE.
  LCHEM_CONVSCAV=.FALSE.
  LCHEM_CSHAPE=.FALSE.
  LCHEM_DVOL=.FALSE.
  KCHEM_SOLVE=1
  LCHEM_REVCHEM=.FALSE.
  KCHEM_YEARPI=2000
 
  RCH4CONST=-9999.9_JPRB

  NCHEM_LCOCOEF=5
  LCHEM_LCOLIMIT=.FALSE.
  LCHEM_LCOMESO=.TRUE.
  LCHEM_LCOCSTCLIM=.TRUE.
  RCHEM_LCOCLIMTOP=6.E-07_JPRB
  RCHEM_LCOTAUTOP=7._JPRB
  RCHEM_LCOCOEFA1=1._JPRB
  CHEM_LCOVERS='_V1.2'

  ! default values for ASIS method parameters in namchem:
  CSOLMET_ASIS='GMRES'   ! GMRES is normally the most efficient method (better than GSEID and DGESV)
  M_soliter_ASIS=15      ! 10 is normally sufficient for GMRES and solcv=1e-14; 20 is recommended for GSEID

  SOLCV_ASIS=1.E-14_JPRB ! 1e-14 is correct, 1e-15 is better for some species (BrOx and ClOx)
  RTOL_ASIS=0.025        ! 0.025 is a good compromise
  N_F_RTOL_ASIS=2
  ATOL_ASIS=1E+4_JPRB
  !N_F_ATOL_ASIS=1        ! 1 is recommended (ATOL=1e-13*air density,  ATOL_ASIS in fact not used)
  N_F_ATOL_ASIS=11        ! 1 is recommended (ATOL=1e-13*air density,  ATOL_ASIS in fact not used)

  LCHEM_ARPCLIM=.FALSE.

  CHEM_SCHEME='arpclim_repro'

  CALL POSNAM(NULNAM,'NAMCHEM')
  READ(NULNAM,NAMCHEM)
  
  IF (LCHEM_LIGHT) THEN
    YDEPHY%NLIMODE = 4_JPIM
    WRITE(NULOUT,'(A,I4)') ' NOxLIGHTNING MODE = ', YDEPHY%NLIMODE
  ENDIF

  ! To workaround a PGI compiler bug, CHEM_SCHEME is not a pointer into YDCHEM.
  YDCHEM%CHEM_SCHEME  = CHEM_SCHEME
  YDCHEM%CHEM_LCOVERS = CHEM_LCOVERS

  WRITE(NULOUT,*) ' SUGFL1: printing NAMCHEM keys:'
  WRITE(NULOUT,'(A,L2,A,L2,A,L2,A,L2,A,L2,A,L2)')&
   & '  LCHEM_LIGHT=',LCHEM_LIGHT,&
   & '  LCHEM_ACNOX=',LCHEM_ACNOX,&
!   & '  LCHEM_DIA=',LCHEM_DIA, &
   & '  LCHEM_DIAC=',LCHEM_DIAC,&
   & '  LCHEM_BASCOE_JON=',LCHEM_BASCOE_JON,&
   & '  LCHEM_JOUT=',LCHEM_JOUT
  WRITE(NULOUT,'(A,I2,A,L2,A,L2,A,L2,A,L2,A,I2,A,L2,A,I6,A,L2,A,L2,A,L2,A,L2,A,L2,A,L2)')&
   & '  KCHEM_NOXADV=',KCHEM_NOXADV,&
   & '  LCHEM_STMA=',LCHEM_STMA,&
   & '  LCHEM_ANAO3=',LCHEM_ANAO3,&
   & '  LCHEM_0NOX=',LCHEM_0NOX,&
   & '  LCHEM_HTAP=',LCHEM_HTAP,&
   & '  KCHEM_SOLVE=',KCHEM_SOLVE,&
   & '  LCHEM_REVCHEM=',LCHEM_REVCHEM,&
   & '  KCHEM_YEARPI=',KCHEM_YEARPI,&
   & '  LCHEM_O3RAD=',LCHEM_O3RAD,&
   & '  LCHEM_CSHAPE=',LCHEM_CSHAPE,&
   & '  LCHEM_WDFR=',LCHEM_WDFR,&  
   & '  LCHEM_AEROI=',LCHEM_AEROI,&
   & '  LCHEM_DVOL=',LCHEM_DVOL, & 
   & '  LCHEM_ARPCLIM=',LCHEM_ARPCLIM

  IF (TRIM(YDCHEM%CHEM_SCHEME) == "linco" ) THEN 
    WRITE(NULOUT,'(A,I2,A,L2,A,L2,A,L2,A,f10.3,A,f10.3,A,f10.3)')&
     & '  NCHEM_LCOCOEF=',NCHEM_LCOCOEF,&
     & '  LCHEM_LCOLIMIT=',LCHEM_LCOLIMIT,&
     & '  LCHEM_LCOMESO=',LCHEM_LCOMESO,&
     & '  LCHEM_LCOCSTCLIM=',LCHEM_LCOCSTCLIM,&
     & '  RCHEM_LCOCLIMTOP=',RCHEM_LCOCLIMTOP,&
     & '  RCHEM_LCOTAUTOP=',RCHEM_LCOTAUTOP,&
     & '  RCHEM_LCOCOEFA1=',RCHEM_LCOCOEFA1
  ENDIF

  IF (LCHEM_HTAP)  WRITE(NULOUT,'(A,f10.3)') ' CONST CH4 in PPB VMR ', RCH4CONST*1.0E9_JPRB 

  IF (LCHEM_AEROI .AND. NACTAERO == 0 ) CALL ABOR1('SUGFL1: LCHEM_AEROI requires active aerosol ')

  IF (LCHEM_DVOL .AND. .NOT. LCOMPO_DDFLX_DIR ) CALL ABOR1('SUGFL1: LCHEM_DVOL requires   LCOMPO_DDFLX_DIR = true ')

ELSE

  LCHEM_LIGHT=.FALSE.
  LCHEM_ACNOX=.FALSE.
  LCHEM_DIAC=.FALSE.
  LCHEM_JOUT=.FALSE.
  LCHEM_BASCOE_JON=.FALSE.
  KCHEM_NOXADV=0_JPIM
  LCHEM_STMA=.FALSE.
  LCHEM_ANAO3=.FALSE.
  LCHEM_ANACH4=.FALSE.
  LCHEM_0NOX=.FALSE.
  LCHEM_HTAP=.FALSE.
  LCHEM_CONVSCAV=.FALSE.
  LCHEM_CSHAPE=.FALSE.
  LCHEM_WDFR=.FALSE.
  LCHEM_O3RAD=.FALSE.
  LCHEM_AEROI=.FALSE.
  LCHEM_DVOL=.FALSE.
  KCHEM_SOLVE=0
  LCHEM_REVCHEM=.FALSE.
  KCHEM_YEARPI=2000
  RCH4CONST=-9999.9_JPRB
  LCHEM_ARPCLIM=.FALSE.
  
  WRITE(NULOUT,*) ' SUGFL1: all NAMCHEM keys are set to F '

ENDIF

! AER namelist 
IF (NACTAERO > 0) THEN
  ! Set up aerosol, requires calling "early" if progostic aerosols in use
  CALL SU_AERW(YDMODEL)
ELSE
  ! otherwise just ensure this isn't a dangling pointer
  ALLOCATE(YDMODEL%YRML_PHY_RAD%YREAERATM%YAERO_DESC(1))
ENDIF

!     ------------------------------------------------------------------

!*       8. COMPUTE THE TOTAL NUMBER OF "GEMS" FIELDS IN CONTROL VECTOR.
!           ------------------------------------------

NGEMS=NGHG_ASSIM+NAERO+NCHEM_ASSIM


!     ------------------------------------------------------------------

END ASSOCIATE
END ASSOCIATE
IF (LHOOK) CALL DR_HOOK('SUGFL1',1,ZHOOK_HANDLE)
END SUBROUTINE SUGFL1

